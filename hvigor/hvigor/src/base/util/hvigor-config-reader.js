"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HvigorConfigReader=exports.defaultOptions=void 0;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),process_1=__importDefault(require("process")),const_js_1=require("../../common/const/const.js"),path_const_js_1=require("../../common/const/path-const.js"),hvigor_config_loader_js_1=require("../../common/util/hvigor-config-loader.js"),json5_reader_js_1=require("./json5-reader.js");exports.defaultOptions={maxOldSpaceSize:8192,exposeGC:!0};class HvigorConfigReader extends json5_reader_js_1.Json5Reader{static getHvigorConfig(){const e=path_1.default.resolve(path_const_js_1.HVIGOR_PROJECT_WRAPPER_HOME,const_js_1.DEFAULT_HVIGOR_CONFIG_JSON_FILE_NAME);if(!fs_1.default.existsSync(e))return;const o=this.getJson5Obj(e),t=path_1.default.resolve(path_const_js_1.HVIGOR_USER_HOME,const_js_1.DEFAULT_HVIGOR_CONFIG_JSON_FILE_NAME);let s;return fs_1.default.existsSync(t)&&(s=this.getJson5Obj(t),o.properties={...s.properties,...o.properties}),o}static getPropertiesConfigValue(e){return hvigor_config_loader_js_1.HvigorConfigLoader.getInstance().getPropertiesConfigValue(e)}static getMaxOldSpaceSize(){var e,o,t,s;const r=process_1.default.argv.find((e=>e.startsWith("--max-old-space-size="))),i=Number(null!==(e=null==r?void 0:r.slice((null==r?void 0:r.indexOf("="))+1))&&void 0!==e?e:""),a=null===(t=null===(o=HvigorConfigReader.getHvigorConfig())||void 0===o?void 0:o.nodeOptions)||void 0===t?void 0:t.maxOldSpaceSize,n=process_1.default.execArgv.find((e=>e.startsWith("--max-old-space-size="))),_=Number(null!==(s=null==n?void 0:n.slice((null==n?void 0:n.indexOf("="))+1))&&void 0!==s?s:""),d=exports.defaultOptions.maxOldSpaceSize;return i||a||_||d}static getNodeParamFromProcessArgv(){const e=[],o=process_1.default.argv.find((e=>e.startsWith(this.maxOldSpaceSizeParamPrefix)));return o&&e.push(o),e}}exports.HvigorConfigReader=HvigorConfigReader,HvigorConfigReader.maxOldSpaceSizeParamPrefix="--max-old-space-size=";