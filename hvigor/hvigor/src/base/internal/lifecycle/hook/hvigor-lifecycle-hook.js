"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HvigorLifecycleHook=void 0;const hook_const_js_1=require("../../../../common/const/hook-const.js"),hvigor_core_js_1=require("../../../external/core/hvigor-core.js"),hvigor_log_js_1=require("../../../log/hvigor-log.js"),_log=hvigor_log_js_1.HvigorLogger.getLogger("HvigorLifecycleHook");class HvigorLifecycleHook{constructor(){this.configEvaluatedFnList=[],this.nodesInitializedFnList=[],this.beforeNodeEvaluateFnList=[],this.afterNodeEvaluateFnList=[],this.nodesEvaluatedFnList=[],this.taskGraphResolvedFnList=[],this.buildFinishedFnList=[],this.onWatchWorkerMessageFnList=[],this.strategies={[hook_const_js_1.HookType.configEvaluated]:async s=>{await this.runFn(this.configEvaluatedFnList,s)},[hook_const_js_1.HookType.nodesInitialized]:async s=>{await this.runFn(this.nodesInitializedFnList,s)},[hook_const_js_1.HookType.beforeNodeEvaluate]:async s=>{await this.runFn(this.beforeNodeEvaluateFnList,s)},[hook_const_js_1.HookType.afterNodeEvaluate]:async s=>{await this.runFn(this.afterNodeEvaluateFnList,s)},[hook_const_js_1.HookType.nodesEvaluated]:async s=>{await this.runFn(this.nodesEvaluatedFnList,s)},[hook_const_js_1.HookType.taskGraphResolved]:async s=>{await this.runFn(this.taskGraphResolvedFnList,s)},[hook_const_js_1.HookType.buildFinished]:async s=>{await this.runFn(this.buildFinishedFnList,s)},[hook_const_js_1.HookType.onWatchWorkerMessage]:async s=>{await this.runFn(this.onWatchWorkerMessageFnList,s)}}}static getInstance(){return HvigorLifecycleHook.instance||(HvigorLifecycleHook.instance=new HvigorLifecycleHook),HvigorLifecycleHook.instance}async runFn(s,t){for(const o of s)o&&await o.bind(this)(t)}async runHook(s,t,o){const e=null==o?void 0:o.createSubEvent(`"${hook_const_js_1.HookType[s]}" hook function`,"").start();try{await this.strategies[s].bind(this)(t),null==e||e.stop().setLog()}catch(s){s instanceof Error&&(null==e||e.stop().setLog(),_log.errorExit(s))}}configEvaluated(s){this.configEvaluatedFnList.push(s)}nodesInitialized(s){this.nodesInitializedFnList.push(s)}beforeNodeEvaluate(s){this.beforeNodeEvaluateFnList.push(s)}afterNodeEvaluate(s){this.afterNodeEvaluateFnList.push(s)}nodesEvaluated(s){this.nodesEvaluatedFnList.push(s)}taskGraphResolved(s){this.taskGraphResolvedFnList.push(s)}buildFinished(s){this.buildFinishedFnList.push(s)}onWatchWorkerMessage(s){this.onWatchWorkerMessageFnList.push(s)}clear(){this.configEvaluatedFnList=[],this.nodesInitializedFnList=[],this.beforeNodeEvaluateFnList=[],this.afterNodeEvaluateFnList=[],this.nodesEvaluatedFnList=[],this.taskGraphResolvedFnList=[],this.buildFinishedFnList=[],this.onWatchWorkerMessageFnList=[],hvigor_core_js_1.hvigorCore.clearHvigorInternalHookList()}}exports.HvigorLifecycleHook=HvigorLifecycleHook;