"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.projectBuildProfileLoader=void 0;const wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),common_const_js_1=require("../../../const/common-const.js"),abstract_build_profile_loader_js_1=require("./abstract-build-profile-loader.js"),class_type_const_js_1=require("@ohos/hvigor/src/base/common/options/class-type-const.js");class ProjectBuildProfileLoader extends abstract_build_profile_loader_js_1.AbstractBuildProfileLoader{constructor(){super(...arguments),this.logger=hvigor_1.HvigorLogger.getLogger(ProjectBuildProfileLoader.name)}getBuildProfile(){return this.getBuildProfileJson5Obj(hvigor_1.hvigor.getRootNode().getNodeName(),!0,class_type_const_js_1.ClassTypeConst.HVIGOR_PROJECT)}setBuildProfileJson5Obj(e,o,r=!0){super.setBuildProfileJson5ObjCheck(e,o,common_const_js_1.BuildProfileSchemaFileConst.PROJECT_BUILD_PROFILE_SCHEMA_PATH,class_type_const_js_1.ClassTypeConst.HVIGOR_PROJECT)}initializeReplace(e){return this.replaceTargets(e)}replaceTargets(e){const o=(0,wdk_1.cloneDeep)(e);return hvigor_1.hvigor.getRootNode().subNodes((e=>{var r;if(!o.modules.some((o=>o.name===e.getNodeName()))){const t=null===(r=hvigor_1.hvigorConfig.getNodeDescriptorByName(e.getNodeName()))||void 0===r?void 0:r.srcPath;o.modules.push({name:e.getNodeName(),srcPath:null!=t?t:e.getNodePath()})}const t=e.getExtraOption("targets");if(t){o.modules.forEach((o=>{o.name===e.getNodeName()&&(o.targets=t)}))}})),o.modules=o.modules.filter((e=>hvigor_1.hvigor.getAllNodes().some((o=>o.getNodeName()===e.name)))),o}checkBuildProfile(e,o){if(!e.app.products||!o.app.products||e.app.products.length!==o.app.products.length)return void this.logger.errorMessageExit("Cannot add or delete products.");const r=e.app.products,t=o.app.products;r.forEach((e=>{const o=t.find((o=>o.name===e.name));o?o.runtimeOS!==e.runtimeOS&&this.logger.errorMessageExit(`Cannot change the runtimeOS of product '${e.name}'. Expected '${e.runtimeOS}', found '${o.runtimeOS}'.`):this.logger.errorMessageExit(`Cannot rename products. Keep the name  '${e.name}' unchanged.`)}))}}exports.projectBuildProfileLoader=new ProjectBuildProfileLoader;