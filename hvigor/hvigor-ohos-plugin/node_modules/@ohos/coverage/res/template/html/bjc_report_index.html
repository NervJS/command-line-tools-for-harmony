<!doctype html>
<html lang="en">

<head>
  <!-- Import style -->
  <link rel="stylesheet" href="{{relativeHomeRes}}index.css" />
  <!-- Import Vue 3 -->
  <script src="{{relativeHomeRes}}vue.global.prod.js"></script>
  <!-- Import component library -->
  <script src="{{relativeHomeRes}}index.full.min.js"></script>
  <title>Coverage</title>
</head>

<body>
  <div id="app" class="common-layout">
    <el-container>
      <el-header>
        <el-row>
          <span>All Files Coverage</span>
          <el-divider />
        </el-row>
      </el-header>
      <el-main>
        <el-row>
          <el-col :span="8">
            <div class="statistic-card">
              <el-statistic :precision="2" :value="tableData.summary.functions.pct">
                <template #title>
                  <div style="display: inline-flex; align-items: center">
                    Functions
                  </div>
                </template>
                <template #suffix>%</template>
              </el-statistic>
              <div class="statistic-footer">
                <div class="footer-item">
                  <span>{{tableData.summary.functions.covered}}/{{tableData.summary.functions.total}}</span>
                </div>
              </div>
            </div>
          </el-col>

          <el-col :span="8">
            <div class="statistic-card">
              <el-statistic :precision="2" :value="tableData.summary.branches.pct">
                <template #title>
                  <div style="display: inline-flex; align-items: center">
                    Branches
                  </div>
                </template>
                <template #suffix>%</template>
              </el-statistic>
              <div class="statistic-footer">
                <div class="footer-item">
                  <span>{{tableData.summary.branches.covered}}/{{tableData.summary.branches.total}}</span>
                </div>
              </div>
            </div>
          </el-col>

          <el-col :span="8">
            <div class="statistic-card">
              <el-statistic :precision="2" :value="tableData.summary.lines.pct">
                <template #title>
                  <div style="display: inline-flex; align-items: center">
                    Lines
                  </div>
                </template>
                <template #suffix>%</template>
              </el-statistic>
              <div class="statistic-footer">
                <div class="footer-item">
                  <span>{{tableData.summary.lines.covered}}/{{tableData.summary.lines.total}}</span>
                </div>
              </div>
            </div>
          </el-col>
        </el-row>
        <el-row>
          <el-divider />
        </el-row>

        <el-table :data="tableData.files" :default-sort="{ prop: 'file', order: 'ascending' }" :row-class-name="tableRowClassName" border
          style="width: 100%">
          <el-table-column sortable prop="path" label="File" width="600">
            <template #default="scope"> <el-link type="primary"
                :href="scope.row.link">{{scope.row.path}}</el-link></template>
          </el-table-column>
          <el-table-column sortable prop="summary.functions.pct" label="Functions"></el-table-column>
          <el-table-column prop="summary.functions.total,summary.functions.covered" label="">
            <template #default="scope">{{scope.row.summary.functions.covered}}/{{scope.row.summary.functions.total}}</template>
          </el-table-column>
          <el-table-column sortable prop="summary.branches.pct" label="Branches"></el-table-column>
          <el-table-column prop="summary.branches.total,summary.branches.covered" label="">
            <template #default="scope">{{scope.row.summary.branches.covered}}/{{scope.row.summary.branches.total}}</template>
          </el-table-column>
          <el-table-column sortable prop="summary.lines.pct" label="Lines"></el-table-column>
          <el-table-column prop="summary.lines.total,summary.lines.covered" label="">
            <template #default="scope">{{scope.row.summary.lines.covered}}/{{scope.row.summary.lines.total}}</template>
          </el-table-column>
        </el-table>
      </el-main>
      <el-footer align="middle" class="footer">
        Code coverage generated by <el-link href="https://github.com/SMAT-Lab/bjc" type="primary" target="_blank">bjc</el-link> at {{tableData.date}}
      </el-footer>
    </el-container>
  </div>
</body>

<script>
  const App = {
    data() {
      return {
        tableData: {{data}},
        tableRowClassName: ({row, rowIndex}) => {
          if (row.summary.lines.pct > 70) {
            return 'high-row'
          } else if (row.summary.lines.pct > 33) {
            return 'medium-row'
          }
          return 'low-row'
        }
      };
    }
  };

  const app = Vue.createApp(App);
  app.use(ElementPlus);
  app.mount("#app");
</script>

<style scoped>
  .el-statistic {
    --el-statistic-content-font-size: 28px;
  }

  .statistic-card {
    height: 100%;
    padding: 20px;
    border-radius: 4px;
    background-color: var(--el-bg-color-overlay);
  }

  .statistic-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    font-size: 12px;
    color: var(--el-text-color-regular);
    margin-top: 16px;
  }

  .statistic-footer .footer-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .statistic-footer .footer-item span:last-child {
    display: inline-flex;
    align-items: center;
    margin-left: 4px;
  }

  .el-container {
    min-height: 100vh;
    height: 100%;
  }

  .footer {
    font-size: small;
  }

  .el-table .low-row {
    --el-table-tr-bg-color: var(--el-color-error-light-9);
  }

  .el-table .medium-row {
    --el-table-tr-bg-color: var(--el-color-warning-light-9);
  }
  .el-table .high-row {
    --el-table-tr-bg-color: var(--el-color-success-light-9);
  }
</style>

</html>