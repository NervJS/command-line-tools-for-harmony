"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ThirdPartyErrorAdaptor=void 0;const hvigor_common_1=require("@ohos/hvigor-common"),abstract_adaptor_js_1=require("../abstract-adaptor.js"),constant_js_1=require("../constant.js"),third_party_error_js_1=require("../errors/third-party-error.js"),type_js_1=require("../type.js"),utils_js_1=require("../utils.js");class ThirdPartyErrorAdaptor extends abstract_adaptor_js_1.ErrorAdaptor{constructor(r,t="checkMessage"){if(super(),this._thirdPartyError=new third_party_error_js_1.ThirdPartyError(this.getErrorCodeJsonPath(),{field:t,value:r}),"checkMessage"===t)this.errorMessage=r,this.analyze(r);else if("none"===t){const t=r;this._thirdPartyError.code=t.code,this._thirdPartyError.message=t.message,this._thirdPartyError.solutions=t.solutions,this._thirdPartyError.toolName=t.toolName}}analyze(r){if(!r.includes(ThirdPartyErrorAdaptor.SOLUTIONS))return;const t=r.split(ThirdPartyErrorAdaptor.SOLUTIONS);this._thirdPartyError.message=t[0].trimEnd(),this._thirdPartyError.solutions=t[1].split(">").map((r=>r.trimEnd().trim())).filter((r=>r.length>0)),this._thirdPartyError.message.includes("Failed to resolve OhmUrl")&&(this._thirdPartyError.moreInfo={cn:"https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-faqs#section16345217154214",en:"https://developer.huawei.com/consumer/en/doc/harmonyos-guides/ide-hvigor-faqs#section16345217154214"}),this.checkEs2abc()}checkEs2abc(){const r=this._thirdPartyError.solutions;if(r&&r[(null==r?void 0:r.length)-1].includes("The size of programs is expected to be")){const t=r[(null==r?void 0:r.length)-1],o=t.indexOf("The size of programs is expected");r[(null==r?void 0:r.length)-1]=`${t.substring(0,o)}\n\n${t.substring(o)}`,this._thirdPartyError.solutions=r}}getErrorMessage(){var r,t,o;return{timestamp:this._thirdPartyError.timestamp,id:this._thirdPartyError.id,code:this._thirdPartyError.code,moreInfo:null===(r=this._thirdPartyError.moreInfo)||void 0===r?void 0:r[(0,hvigor_common_1.getOsLanguage)()],stack:this._thirdPartyError.stack,message:null!==(o=null!==(t=this._thirdPartyError.message)&&void 0!==t?t:this.errorMessage)&&void 0!==o?o:constant_js_1.ERROR_NOT_MATCH,solutions:this._thirdPartyError.solutions,checkMessage:this._thirdPartyError.checkMessage}}getErrorCodeJsonPath(r){return r?[(0,utils_js_1.getErrorInfoFilePath)(r)]:ThirdPartyErrorAdaptor.otherErrorCode.map((r=>(0,utils_js_1.getErrorInfoFilePath)(r)))}}exports.ThirdPartyErrorAdaptor=ThirdPartyErrorAdaptor,ThirdPartyErrorAdaptor.SOLUTIONS="Solutions:",ThirdPartyErrorAdaptor.otherErrorCode=[type_js_1.ToolErrorCode.TEC_23,type_js_1.ToolErrorCode.TEC_24];