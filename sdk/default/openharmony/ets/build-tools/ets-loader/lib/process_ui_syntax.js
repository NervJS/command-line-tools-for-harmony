"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.builderTypeParameter=void 0,exports.collectExtend=collectExtend,exports.contextGlobal=void 0,exports.createStartGetAccessRecording=createStartGetAccessRecording,exports.globalBuilderParamAssignment=globalBuilderParamAssignment,exports.initializeMYIDS=initializeMYIDS,exports.isAnimateToOrImmediately=isAnimateToOrImmediately,exports.isDynamic=isDynamic,exports.isExtendFunction=isExtendFunction,exports.isOriginalExtend=isOriginalExtend,exports.isResource=isResource,exports.processAnimateToOrImmediately=processAnimateToOrImmediately,exports.processResourceData=processResourceData,exports.processUISyntax=processUISyntax,exports.resetLog=resetLog,exports.resetProcessUiSyntax=resetProcessUiSyntax,exports.transformLog=exports.resourceFileName=void 0,exports.validatorCard=validatorCard;var _typescript=_interopRequireDefault(require("typescript")),_path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs")),_pre_define=require("./pre_define"),_utils=require("./utils"),_process_module_files=require("./process_module_files"),_validate_ui_syntax=require("./validate_ui_syntax"),_process_component_class=require("./process_component_class"),_process_import=_interopRequireWildcard(require("./process_import")),_process_component_build=require("./process_component_build"),_component_map=require("./component_map"),_main=require("../main"),_process_component_member=require("./process_component_member"),_process_custom_component=require("./process_custom_component"),_process_decorator=require("./fast_build/ark_compiler/process_decorator"),_utils2=require("./fast_build/ark_compiler/utils"),_api_check_utils=require("./fast_build/system_api/api_check_utils"),_constant_define=_interopRequireDefault(require("./constant_define")),_process_struct_componentV=_interopRequireDefault(require("./process_struct_componentV2")),_create_ast_node_utils=_interopRequireDefault(require("./create_ast_node_utils")),_process_sendable=require("./process_sendable"),_process_module_package=require("./process_module_package");function _getRequireWildcardCache(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(_getRequireWildcardCache=function(e){return e?r:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var r,a,o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((a=i?Object.getOwnPropertyDescriptor(e,r):null)&&(a.get||a.set)?Object.defineProperty(o,r,a):o[r]=e[r]);return o.default=e,t&&t.set(e,o),o}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}let transformLog=new _create_ast_node_utils.default.FileLog;exports.transformLog=transformLog;let contextGlobal,resourceFileName=(exports.contextGlobal=contextGlobal,"");exports.resourceFileName=resourceFileName;const builderTypeParameter={params:[]};function processUISyntax(f,u=!1,y=null,m=""){var e=this;let E;return function(i){var o=this;_newArrowCheck(this,e),exports.contextGlobal=contextGlobal=i;let n,c,s=!1,p=!1;return function(e){var r=this;if(_newArrowCheck(this,o),(0,_utils.startTimeStatisticsLocation)(y?y.processUISyntaxTime:void 0),n=_path.default.resolve(_path.default.dirname(e.fileName)),exports.resourceFileName=resourceFileName=_path.default.resolve(e.fileName),c=_path.default.resolve(""!==m?m:e.fileName),process.env.compiler!==_pre_define.BUILD_ON&&"rollup"!==process.env.compileTool)return(0,_utils.stopTimeStatisticsLocation)(y?y.processUISyntaxTime:void 0),e;{if(_utils.storedFileInfo.transformCacheFiles[c]={mtimeMs:_fs.default.existsSync(c)?_fs.default.statSync(c).mtimeMs:0,children:[]},preprocessIdAttrs((transformLog.sourceFile=e).fileName),!u&&("moduleJson"!==process.env.compileMode&&_path.default.resolve(e.fileName)===_path.default.resolve(_main.projectConfig.projectPath,"app.ets")||/\.ts$/.test(e.fileName)))return e=_typescript.default.visitEachChild(e,d,i),e=_typescript.default.factory.updateSourceFile(e,insertImportModuleNode(Array.from(e.statements),s)),_main.projectConfig.compileMode===_pre_define.ESMODULE&&!0===_main.projectConfig.processTs&&"rollup"!==process.env.compileTool&&(t=_typescript.default.getTypeExportImportAndConstEnumTransformer(i)(e),(0,_process_module_files.writeFileSyncByNode)(t,_main.projectConfig,void 0)),t=_typescript.default.visitEachChild(e,_,i),(0,_utils.stopTimeStatisticsLocation)(y?y.processUISyntaxTime:void 0),t;var t=++_utils.componentInfo.id;e=createEntryNode(e=_typescript.default.visitEachChild(e,l,i),i,E,t),_component_map.GLOBAL_STYLE_FUNCTION.forEach(function(e,t){_newArrowCheck(this,r),_component_map.BUILDIN_STYLE_NAMES.delete(t)}.bind(this)),_component_map.GLOBAL_STYLE_FUNCTION.clear();const a=Array.from(e.statements);_main.partialUpdateConfig.partialUpdateMode||generateId(a,e),_component_map.INTERFACE_NODE_SET.forEach(function(e){_newArrowCheck(this,r),a.unshift(e)}.bind(this)),_main.partialUpdateConfig.partialUpdateMode&&p&&(_utils.storedFileInfo.hasLocalBuilderInFile&&a.unshift((0,_process_component_class.checkContextStack)()),a.unshift((0,_process_component_class.checkFinalizeConstruction)())),createNavigationInit(resourceFileName,a),insertImportModuleNode(a,s),e=_typescript.default.factory.updateSourceFile(e,a),_component_map.INTERFACE_NODE_SET.clear(),_main.projectConfig.compileMode===_pre_define.ESMODULE&&!0===_main.projectConfig.processTs&&"rollup"!==process.env.compileTool&&(t=_typescript.default.getTypeExportImportAndConstEnumTransformer(i)(e),(0,_process_module_files.writeFileSyncByNode)(t,_main.projectConfig,void 0));t=_typescript.default.visitEachChild(e,_,i);return(0,_utils.stopTimeStatisticsLocation)(y?y.processUISyntaxTime:void 0),t}}.bind(this);function l(e){var t,r,a,o=this;return"esmodule"===_main.projectConfig.compileMode&&"rollup"===process.env.compileTool&&_typescript.default.isImportDeclaration(e)?((0,_utils.startTimeStatisticsLocation)(y?y.processImportTime:void 0),(0,_process_import.processImportModule)(e,c,transformLog.errors),(0,_utils.stopTimeStatisticsLocation)(y?y.processImportTime:void 0)):"esmodule"===_main.projectConfig.compileMode&&"rollup"===process.env.compileTool||!(_typescript.default.isImportDeclaration(e)||_typescript.default.isImportEqualsDeclaration(e)||_typescript.default.isExportDeclaration(e)&&e.moduleSpecifier&&_typescript.default.isStringLiteral(e.moduleSpecifier))||(0,_process_import.default)(e,n,transformLog.errors),_typescript.default.isStructDeclaration(e)?(p=!0,_validate_ui_syntax.componentCollection.currentClassName=e.name.getText(),_validate_ui_syntax.componentCollection.entryComponent===_validate_ui_syntax.componentCollection.currentClassName&&function(e){var t=this,r=_typescript.default.getAllDecorators(e);e&&r&&r.length&&r.forEach(function(e){_newArrowCheck(this,t),e.expression&&_typescript.default.isCallExpression(e.expression)&&_typescript.default.isIdentifier(e.expression.expression)&&"Entry"===e.expression.expression.escapedText.toString()&&e.expression.arguments&&e.expression.arguments.length&&_typescript.default.isIdentifier(e.expression.arguments[0])&&(E=e.expression.arguments[0])}.bind(this)),E}(e),(0,_utils.startTimeStatisticsLocation)(y?y.processComponentClassTime:void 0),e=_process_struct_componentV.default.getOrCreateStructInfo(_validate_ui_syntax.componentCollection.currentClassName).isComponentV2?_process_struct_componentV.default.processStructComponentV2(e,transformLog.errors,i):(0,_process_component_class.processComponentClass)(e,i,transformLog.errors,f),(0,_utils.stopTimeStatisticsLocation)(y?y.processComponentClassTime:void 0),_validate_ui_syntax.componentCollection.currentClassName=null,_component_map.INNER_STYLE_FUNCTION.forEach(function(e,t){_newArrowCheck(this,o),_component_map.BUILDIN_STYLE_NAMES.delete(t)}.bind(this)),_component_map.INNER_STYLE_FUNCTION.clear()):_typescript.default.isFunctionDeclaration(e)?(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_EXTEND_DECORATOR,null,transformLog.errors)?(e=processExtend(e,transformLog.errors,_pre_define.COMPONENT_EXTEND_DECORATOR))&&e.illegalDecorators&&(e.illegalDecorators=void 0):(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_BUILDER_DECORATOR)&&e.name&&e.body&&_typescript.default.isBlock(e.body)?(_utils.storedFileInfo.processBuilder=!0,_utils.storedFileInfo.processGlobalBuilder=!0,_component_map.CUSTOM_BUILDER_METHOD.add(e.name.getText()),builderTypeParameter.params=(0,_utils.getPossibleBuilderTypeParameter)(e.parameters),(a=_typescript.default.factory.createNodeArray(Array.from(e.parameters))).push((0,_process_component_class.createParentParameter)()),_main.projectConfig.optLazyForEach&&a.push(initializeMYIDS()),_utils.storedFileInfo.builderLikeCollection=_component_map.CUSTOM_BUILDER_METHOD,(0,_process_component_build.parseGlobalBuilderParams)(e.parameters,t={firstParam:null}),r=(0,_process_component_build.processComponentBlock)(e.body,!1,transformLog.errors,!1,!0,e.name.getText(),void 0,!0,t,!0),e=_typescript.default.factory.updateFunctionDeclaration(e,_typescript.default.getModifiers(e),e.asteriskToken,e.name,e.typeParameters,a,e.type,r),t.firstParam=null,e&&e.illegalDecorators&&(e.illegalDecorators=void 0),builderTypeParameter.params=[],e=(0,_process_component_class.processBuildMember)(e,i,transformLog.errors,!0),_utils.storedFileInfo.processBuilder=!1,_utils.storedFileInfo.processGlobalBuilder=!1):(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_STYLES_DECORATOR)?0===e.parameters.length?e=void 0:transformLog.errors.push({type:_utils.LogType.ERROR,message:"@Styles can't have parameters.",pos:e.getStart()}):(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_CONCURRENT_DECORATOR)?(e=processConcurrent(e))&&e.illegalDecorators&&(e.illegalDecorators=void 0):(0,_utils2.hasArkDecorator)(e,_pre_define.COMPONENT_SENDABLE_DECORATOR)?(e=(0,_process_sendable.processSendableFunction)(e))&&e.illegalDecorators&&(e.illegalDecorators=void 0):(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_ANIMATABLE_EXTEND_DECORATOR,null,transformLog.errors)&&(e=processExtend(e,transformLog.errors,_pre_define.COMPONENT_ANIMATABLE_EXTEND_DECORATOR))&&e.illegalDecorators&&(e.illegalDecorators=void 0):isResource(e)?(s=!0,e=processResourceData(e,m)):isWorker(e)?e=processWorker(e):isAnimateToOrImmediately(e)?e=processAnimateToOrImmediately(e):isCustomDialogController(e)?e=createCustomDialogController(e.parent,e,transformLog.errors):(a=e).kind===_typescript.default.SyntaxKind.TypeReference&&a.typeName?.kind===_typescript.default.SyntaxKind.Identifier&&"ESObject"===a.typeName.escapedText?e=_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword):_typescript.default.isDecorator(e)?e=(0,_process_decorator.processDecorator)(e):!function(e){if(_typescript.default.isCallExpression(e)&&e.expression&&_typescript.default.isIdentifier(e.expression)&&e.expression.escapedText.toString()===_pre_define.WRAPBUILDER_FUNCTION)return 1;return}(e)?_typescript.default.isClassDeclaration(e)?(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_SENDABLE_DECORATOR)&&(_main.projectConfig.compileHar&&!_main.projectConfig.useTsHar&&transformLog.errors.push({type:_utils.LogType.WARN,message:'If you use @Sendable in js har, an exception will occur during runtime.\nPlease use @Sendable in ts har. You can configure {"name": "UseTsHar", "value": "true"} in the "metadata" in the module.json5 file in har.',pos:e.getStart()}),e=(0,_process_sendable.processSendableClass)(e)):_typescript.default.isTypeAliasDeclaration(e)&&(0,_utils2.hasArkDecorator)(e,_pre_define.COMPONENT_SENDABLE_DECORATOR)&&(e=(0,_process_sendable.processSendableType)(e))&&e.illegalDecorators&&(e.illegalDecorators=void 0):e.arguments&&e.arguments[0]&&(!_typescript.default.isIdentifier(e.arguments[0])||_typescript.default.isIdentifier(e.arguments[0])&&!_component_map.CUSTOM_BUILDER_METHOD.has(e.arguments[0].escapedText.toString()))&&transformLog.errors.push({type:_utils.LogType.ERROR,message:"wrapBuilder's parameter should be @Builder function.",pos:e.getStart()}),_typescript.default.visitEachChild(e,l,i)}function d(e){return _typescript.default.isImportDeclaration(e)?(0,_api_check_utils.validateModuleSpecifier)(e.moduleSpecifier,transformLog.errors):isResource(e)?(s=!0,e=processResourceData(e,m)):_typescript.default.isTypeReferenceNode(e)&&(0,_api_check_utils.checkTypeReference)(e,transformLog),_typescript.default.visitEachChild(e,d,i)}function _(e){return _typescript.default.visitEachChild(e,_,i)}}.bind(this)}function globalBuilderParamAssignment(){var e=_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.PUV2_VIEW_BASE),_typescript.default.factory.createIdentifier(_pre_define.CONTEXT_STACK));return _typescript.default.factory.createVariableStatement(void 0,_typescript.default.factory.createVariableDeclarationList([_typescript.default.factory.createVariableDeclaration(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_PARENT),void 0,void 0,_typescript.default.factory.createConditionalExpression(_typescript.default.factory.createBinaryExpression(e,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.AmpersandAmpersandToken),_typescript.default.factory.createPropertyAccessExpression(e,_typescript.default.factory.createIdentifier(_pre_define.LENGTH))),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.QuestionToken),_typescript.default.factory.createElementAccessExpression(e,_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(e,_typescript.default.factory.createIdentifier(_pre_define.LENGTH)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.MinusToken),_typescript.default.factory.createNumericLiteral("1"))),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.ColonToken),_typescript.default.factory.createNull()))],_typescript.default.NodeFlags.Const))}function createNavigationInit(e,t){var r=this,a=(0,_utils.getStoredFileInfo)();if(a.routerInfo.has(e)){a=a.routerInfo.get(e);const o=[];a.forEach(function(e){_newArrowCheck(this,r),_component_map.GLOBAL_CUSTOM_BUILDER_METHOD.has(e.buildFunction)?o.push(createNavigationRegister(e)):transformLog.errors.push({type:_utils.LogType.ERROR,message:`The buildFunction '${e.buildFunction}' configured in the routerMap json file does not exist.`})}.bind(this)),t.push(_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createParenthesizedExpression(_typescript.default.factory.createFunctionExpression(void 0,void 0,void 0,void 0,[],void 0,_typescript.default.factory.createBlock([_typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createTypeOfExpression(_typescript.default.factory.createIdentifier(_constant_define.default.NAVIGATION_BUILDER_REGISTER)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsEqualsEqualsToken),_typescript.default.factory.createStringLiteral(_pre_define.FUNCTION)),_typescript.default.factory.createBlock(o,!0),void 0)],!0))),void 0,[])))}}function createNavigationRegister(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createIdentifier(_constant_define.default.NAVIGATION_BUILDER_REGISTER),void 0,[_typescript.default.factory.createStringLiteral(e.name),_typescript.default.factory.createCallExpression(_typescript.default.factory.createIdentifier(_pre_define.WRAPBUILDER_FUNCTION),void 0,[_typescript.default.factory.createIdentifier(e.buildFunction)])]))}function initializeMYIDS(){return _typescript.default.factory.createParameterDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.MY_IDS),void 0,void 0,_typescript.default.factory.createArrayLiteralExpression([],!1))}function generateId(e,t){e.unshift(_typescript.default.factory.createVariableStatement(void 0,_typescript.default.factory.createVariableDeclarationList([_typescript.default.factory.createVariableDeclaration(_typescript.default.factory.createIdentifier(_pre_define._GENERATE_ID),void 0,_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.NumberKeyword),_typescript.default.factory.createNumericLiteral("0"))],_typescript.default.NodeFlags.Let)),_typescript.default.factory.createFunctionDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.GENERATE_ID),void 0,[],_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.StringKeyword),_typescript.default.factory.createBlock([_typescript.default.factory.createReturnStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createStringLiteral(_path.default.basename(t.fileName,_pre_define.EXTNAME_ETS)+"_"),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.PlusToken),_typescript.default.factory.createPrefixUnaryExpression(_typescript.default.SyntaxKind.PlusPlusToken,_typescript.default.factory.createIdentifier(_pre_define._GENERATE_ID))))],!0)))}function preprocessIdAttrs(e){for(var[t,r]of _component_map.ID_ATTRS)e===r.get("path")&&_component_map.ID_ATTRS.delete(t)}function isCustomDialogController(e){var t=e.parent;return!e.parent&&e.original&&(e.parent=e.original.parent),!!(_typescript.default.isNewExpression(e)&&e.expression&&_typescript.default.isIdentifier(e.expression)&&e.expression.escapedText.toString()===_pre_define.SET_CONTROLLER_CTR_TYPE)||(e.parent=t,!1)}function createCustomDialogController(r,e,a){var t,o=this;return e.arguments&&1===e.arguments.length&&_typescript.default.isObjectLiteralExpression(e.arguments[0])&&e.arguments[0].properties?(t=e.arguments[0].properties.map(function(e){_newArrowCheck(this,o);var t=isCustomDialogControllerPropertyAssignment(e,a);return e=null!==t?processCustomDialogControllerPropertyAssignment(r,e,t):e}.bind(this)),_typescript.default.factory.createNewExpression(e.expression,e.typeArguments,[_typescript.default.factory.createObjectLiteralExpression(t,!0),_typescript.default.factory.createThis()])):e}function isCustomDialogControllerPropertyAssignment(e,t){if(_typescript.default.isPropertyAssignment(e)&&_typescript.default.isIdentifier(e.name)&&e.name.getText()===_pre_define.CUSTOM_DIALOG_CONTROLLER_BUILDER)if(e.initializer){var r=(0,_process_component_build.getName)(e.initializer);if(_validate_ui_syntax.componentCollection.customDialogs.has(r))return r}else validateCustomDialogControllerBuilderInit(e,t);return null}function validateCustomDialogControllerBuilderInit(e,t){t.push({type:_utils.LogType.ERROR,message:"The builder should be initialized with a @CustomDialog Component.",pos:e.getStart()})}function processCustomDialogControllerPropertyAssignment(e,t,r){if(_typescript.default.isCallExpression(t.initializer))return _typescript.default.factory.updatePropertyAssignment(t,t.name,processCustomDialogControllerBuilder(e,t.initializer,r))}function processCustomDialogControllerBuilder(e,t,r){r=(0,_process_component_member.createCustomComponentNewExpression)(t,r,!1,!1,!0);return createCustomComponentBuilderArrowFunction(t,e,_typescript.default.factory.createIdentifier(_pre_define.JS_DIALOG),r)}function createCustomComponentBuilderArrowFunction(e,t,r,a){let o;return _typescript.default.isBinaryExpression(t)?o=t.left:(_typescript.default.isVariableDeclaration(t)||_typescript.default.isPropertyDeclaration(t))&&(o=_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),t.name)),_typescript.default.factory.createArrowFunction(void 0,void 0,[],void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock([_typescript.default.factory.createVariableStatement(void 0,_typescript.default.factory.createVariableDeclarationList([_typescript.default.factory.createVariableDeclaration(r,void 0,void 0,a)],_typescript.default.NodeFlags.Let)),_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(r,_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_METHOD)),void 0,o?[o]:void 0)),_typescript.default.factory.createExpressionStatement((0,_process_component_member.createViewCreate)(r)),_main.partialUpdateConfig.partialUpdateMode?(0,_process_custom_component.assignComponentParams)(e):void 0,_main.partialUpdateConfig.partialUpdateMode?(0,_process_custom_component.assignmentFunction)(r.escapedText.toString()):void 0],!0))}function isResource(e){return _typescript.default.isCallExpression(e)&&_typescript.default.isIdentifier(e.expression)&&(e.expression.escapedText.toString()===_pre_define.RESOURCE||e.expression.escapedText.toString()===_pre_define.RESOURCE_RAWFILE)&&0<e.arguments.length}function isAnimateToOrImmediately(e){return _typescript.default.isCallExpression(e)&&_typescript.default.isIdentifier(e.expression)&&_pre_define.ATTRIBUTE_ANIMATETO_SET.has(e.expression.escapedText.toString())}function processResourceData(e,t,r={isAcceleratePreview:!1,log:[]}){var a,o;return _typescript.default.isStringLiteral(e.arguments[0])?(o=(a=e.arguments[0].text.trim().split(".")).length&&/^\[.*\]$/g.test(a[0]),e.expression.getText()===_pre_define.RESOURCE_RAWFILE?(isResourcefile(e,r,o),a&&a[0]&&o?createResourceParam(-1,_pre_define.RESOURCE_TYPE.rawfile,[e.arguments[0]],a[0],!0):createResourceParam(0,_pre_define.RESOURCE_TYPE.rawfile,[e.arguments[0]],"",!1)):getResourceDataNode(e,r,a,o,t)):e.expression.getText()===_pre_define.RESOURCE&&e.arguments&&e.arguments.length?(resourcePreviewMessage(r),createResourceParamWithVariable(e,-1,-1)):e.expression.getText()===_pre_define.RESOURCE_RAWFILE&&e.arguments&&e.arguments.length?(resourcePreviewMessage(r),createResourceParamWithVariable(e,-1,_pre_define.RESOURCE_TYPE.rawfile)):e}function resourcePreviewMessage(e){e.isAcceleratePreview&&e.log.push({type:_utils.LogType.ERROR,message:"not support AcceleratePreview"})}function getResourceDataNode(t,r,a,o,e){let i;if(preCheckResourceData(a,_main.resources,t.arguments[0].getStart(),r,o,e)){let e=_pre_define.RESOURCE_TYPE[a[1]];return void 0!==e||r.isAcceleratePreview?(o?(i=-1,e=-1):i=_main.resources[a[0]][a[1]][a[2]],createResourceParam(i,e,_main.projectConfig.compileHar||o?Array.from(t.arguments):Array.from(t.arguments).slice(1),a.length&&a[0],o)):(transformLog.errors.push({type:_utils.LogType.ERROR,message:`The resource type ${a[1]} is not supported.`,pos:t.getStart()}),t)}return t}function isResourcefile(e,t,r){r||!process.env.rawFileResource||_utils.storedFileInfo.resourcesArr.has(e.arguments[0].text)||t.isAcceleratePreview||"moduleJson"!==process.env.compileMode||transformLog.errors.push({type:_utils.LogType.ERROR,message:`No such '${e.arguments[0].text}' resource in current module.`,pos:e.getStart()})}function addBundleAndModuleParam(e,t,r){_main.projectConfig.compileHar&&(_main.projectConfig.bundleName="__harDefaultBundleName__",_main.projectConfig.moduleName="__harDefaultModuleName__");var a=isDynamic(),t=createResourceModuleNode(t,r,a);!_main.projectConfig.bundleName&&""!==_main.projectConfig.bundleName||e.push(_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createStringLiteral(_pre_define.RESOURCE_NAME_BUNDLE),_main.projectConfig.resetBundleName||_main.projectConfig.allowEmptyBundleName?_typescript.default.factory.createStringLiteral(""):createBundleOrModuleNode(a,"bundleName"))),(_main.projectConfig.moduleName||""===_main.projectConfig.moduleName||t)&&e.push(_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createStringLiteral(_pre_define.RESOURCE_NAME_MODULE),r?t:createBundleOrModuleNode(a,"moduleName")))}function createResourceModuleNode(e,t,r){if(t)return e?(t=e.replace(/^\[|\]$/g,""),_typescript.default.factory.createStringLiteral(t)):r?_typescript.default.factory.createIdentifier("__MODULE_NAME__"):_main.projectConfig.moduleName?_typescript.default.factory.createStringLiteral(_main.projectConfig.moduleName):void 0}function createBundleOrModuleNode(e,t){return e?_typescript.default.factory.createIdentifier("bundleName"===t?"__BUNDLE_NAME__":"__MODULE_NAME__"):_typescript.default.factory.createStringLiteral("bundleName"===t?_main.projectConfig.bundleName:_main.projectConfig.moduleName)}function createResourceParamWithVariable(e,t,r){t=[_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createStringLiteral(_pre_define.RESOURCE_NAME_ID),_typescript.default.factory.createNumericLiteral(t)),_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createStringLiteral(_pre_define.RESOURCE_NAME_TYPE),_typescript.default.factory.createNumericLiteral(r)),_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createIdentifier(_pre_define.RESOURCE_NAME_PARAMS),_typescript.default.factory.createArrayLiteralExpression(Array.from(e.arguments),!1))],addBundleAndModuleParam(t,"",!0),r=_typescript.default.factory.createObjectLiteralExpression(t,!1);return r}function createResourceParam(e,t,r,a,o){_main.projectConfig.compileHar&&(e=-1);e=[_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createStringLiteral(_pre_define.RESOURCE_NAME_ID),_typescript.default.factory.createNumericLiteral(e)),_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createStringLiteral(_pre_define.RESOURCE_NAME_TYPE),_typescript.default.factory.createNumericLiteral(t)),_typescript.default.factory.createPropertyAssignment(_typescript.default.factory.createIdentifier(_pre_define.RESOURCE_NAME_PARAMS),_typescript.default.factory.createArrayLiteralExpression(r,!1))],addBundleAndModuleParam(e,a,o),t=_typescript.default.factory.createObjectLiteralExpression(e,!1);return t}function preCheckResourceData(e,t,r,a,o,i){return a.isAcceleratePreview?validateResourceData(e,t,r,a.log,!0,o,i):validateResourceData(e,t,r,transformLog.errors,!1,o,i)}function validateResourceData(e,t,r,a,o,i,n){return 3===e.length?(o||"rollup"!==process.env.compileTool||"moduleJson"!==process.env.compileMode||_utils.storedFileInfo.collectResourceInFile(e[1]+"_"+e[2],_path.default.resolve(n)),i?/^\[.*\]$/.test(e[0])&&_main.projectConfig.hspResourcesMap?(o=e[0].replace(/^\[/,"").replace(/\]$/,"").trim(),resourceCheck(e,t,r,a,!0,o,!1)):resourceCheck(e,t,r,a,!1,e[0],!0):resourceCheck(e,t,r,a,!1,e[0],!1)):(a.push({type:_utils.LogType.ERROR,message:"The input parameter is not supported.",pos:r}),!1)}function resourceCheck(e,t,r,a,o,i,n){o=o?_utils.LogType.WARN:_utils.LogType.ERROR;if(n||t[i])if(n||t[i][e[1]]){if(n||t[i][e[1]][e[2]])return!0;a.push({type:o,message:`Unknown resource name '${e[2]}'.`,pos:r})}else a.push({type:o,message:`Unknown resource type '${e[1]}'.`,pos:r});else a.push({type:o,message:`Unknown resource source '${i}'.`,pos:r});return!1}function isWorker(e){return _typescript.default.isNewExpression(e)&&_typescript.default.isPropertyAccessExpression(e.expression)&&_typescript.default.isIdentifier(e.expression.name)&&e.expression.name.escapedText.toString()===_pre_define.WORKER_OBJECT}function processWorker(e){var t,r;return e.arguments.length&&_typescript.default.isStringLiteral(e.arguments[0])?(t=Array.from(e.arguments),r=e.arguments[0].text,r=_typescript.default.factory.createStringLiteral(r.replace(/\.ts$/,".js")),t.splice(0,1,r),_typescript.default.factory.updateNewExpression(e,e.expression,e.typeArguments,t)):e}function processAnimateToOrImmediately(e){return _typescript.default.factory.updateCallExpression(e,_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.GLOBAL_CONTEXT),_typescript.default.factory.createIdentifier(e.expression.escapedText.toString())),e.typeArguments,e.arguments)}function processExtend(r,a,e){const o=isExtendFunction(r,{decoratorName:"",componentName:""},!0);if(o&&r.body&&r.body.statements.length){var i=[];let t;if(e===_pre_define.COMPONENT_EXTEND_DECORATOR){var n=r.body.statements[0].expression;isOriginalExtend(r.body)?(n=_typescript.default.factory.createExpressionStatement(processExtendBody(n)),(0,_process_component_build.bindComponentAttr)(n,_typescript.default.factory.createIdentifier(o),i,a)):t=_typescript.default.visitEachChild(r.body,function e(t){if(_typescript.default.isExpressionStatement(t)&&isDollarNode(t,o)){const r=_typescript.default.factory.createExpressionStatement(processExtendBody(t.expression,o)),a=[];return(0,_process_component_build.bindComponentAttr)(r,_typescript.default.factory.createIdentifier(o),a,[]),_typescript.default.factory.createBlock(a,!0)}return _typescript.default.visitEachChild(t,e,contextGlobal)},contextGlobal);let e;return r.name.getText().startsWith("__"+o+"__")?e=r.name.getText():(e="__"+o+"__"+r.name.getText(),collectExtend(_component_map.EXTEND_ATTRIBUTE,o,r.name.escapedText.toString())),_typescript.default.factory.updateFunctionDeclaration(r,_typescript.default.getModifiers(r),r.asteriskToken,_typescript.default.factory.createIdentifier(e),r.typeParameters,r.parameters,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.VoidKeyword),isOriginalExtend(r.body)?_typescript.default.factory.updateBlock(r.body,i):t)}if(e===_pre_define.COMPONENT_ANIMATABLE_EXTEND_DECORATOR)return(0,_process_component_build.bindComponentAttr)(r.body.statements[0],_typescript.default.factory.createIdentifier(o),i,a),_typescript.default.factory.updateFunctionDeclaration(r,_typescript.default.getModifiers(r),r.asteriskToken,r.name,r.typeParameters,[...r.parameters,...createAnimatableParameterNode()],_typescript.default.factory.createToken(_typescript.default.SyntaxKind.VoidKeyword),_typescript.default.factory.updateBlock(r.body,createAnimatableBody(o,r.name,r.parameters,i)))}}function createAnimatableParameterNode(){return[_typescript.default.factory.createParameterDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.ELMTID)),_typescript.default.factory.createParameterDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.ISINITIALRENDER)),_typescript.default.factory.createParameterDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_PARENT))]}function createAnimatableBody(e,t,r,a){var o=this;const i=[];return r.forEach(function(e){_newArrowCheck(this,o),e.name&&_typescript.default.isIdentifier(e.name)&&i.push(e.name)}.bind(this)),[_typescript.default.factory.createIfStatement(_typescript.default.factory.createIdentifier(_pre_define.ISINITIALRENDER),_typescript.default.factory.createBlock([createAnimatableProperty(e,t,r,i,a),...a],!0),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(e),_typescript.default.factory.createIdentifier(_pre_define.UPDATE_ANIMATABLE_PROPERTY)),void 0,[_typescript.default.factory.createStringLiteral(t.escapedText.toString()),...i]))]))]}function createAnimatableProperty(e,t,r,a,o){var i=_typescript.default.factory.createIdentifier(e);return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(i,_typescript.default.factory.createIdentifier(_pre_define.CREATE_ANIMATABLE_PROPERTY)),void 0,[_typescript.default.factory.createStringLiteral(t.escapedText.toString()),...a,_typescript.default.factory.createArrowFunction(void 0,void 0,r,void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock([(0,_process_component_build.createViewStackProcessorStatement)(_pre_define.STARTGETACCESSRECORDINGFOR,_pre_define.ELMTID),createAnimatableFrameNode(e),...o,(0,_process_component_build.createViewStackProcessorStatement)(_pre_define.STOPGETACCESSRECORDING),createAnimatableUpdateFunc()],!0))]))}function createAnimatableFrameNode(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.VIEW_STACK_PROCESSOR),_typescript.default.factory.createIdentifier(_pre_define.GET_AND_PUSH_FRAME_NODE)),void 0,[_typescript.default.factory.createStringLiteral(e),_typescript.default.factory.createIdentifier(_pre_define.ELMTID)]))}function createAnimatableUpdateFunc(){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_PARENT),_typescript.default.factory.createIdentifier(_pre_define.FINISH_UPDATE_FUNC)),void 0,[_typescript.default.factory.createIdentifier(_pre_define.ELMTID)]))}function processConcurrent(e){var t;return e.body?(t=[_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createStringLiteral("use concurrent")),...e.body.statements],_typescript.default.factory.updateFunctionDeclaration(e,_typescript.default.getModifiers(e),e.asteriskToken,e.name,e.typeParameters,e.parameters,e.type,_typescript.default.factory.updateBlock(e.body,t))):e}function isOriginalExtend(e){let t=e.statements[0];if(1===e.statements.length&&_typescript.default.isExpressionStatement(t)){for(;t.expression;)t=t.expression;if(_typescript.default.isIdentifier(t)&&t.pos&&t.end&&t.pos===t.end&&t.escapedText.toString().match(/Instance$/))return!0}return!1}function isDollarNode(e,t){let r=e;for(;r.expression;)r=r.expression;let a="$";return"rollup"===process.env.compileTool&&_utils.storedFileInfo.reUseProgram&&(a=t+"Instance"),!(!_typescript.default.isIdentifier(r)||r.getText()!==a)}function processExtendBody(e,t){switch(e.kind){case _typescript.default.SyntaxKind.CallExpression:return _typescript.default.factory.createCallExpression(processExtendBody(e.expression,t),void 0,e.arguments);case _typescript.default.SyntaxKind.PropertyAccessExpression:return _typescript.default.factory.createPropertyAccessExpression(processExtendBody(e.expression,t),e.name);case _typescript.default.SyntaxKind.Identifier:return t?_typescript.default.factory.createIdentifier(t):_typescript.default.factory.createIdentifier(e.escapedText.toString().replace(_pre_define.INSTANCE,""))}}function collectExtend(e,t,r){e.has(t)?e.get(t).add(r):e.set(t,new Set([r]))}function isExtendFunction(e,r,a=!1){var o=_typescript.default.getAllDecorators(e);if(o&&o.length)for(let e=0,t=o.length;e<t;e++)if(_typescript.default.isCallExpression(o[e].expression)&&(parseExtendNode(o[e].expression,r,a),_pre_define.CHECK_EXTEND_DECORATORS.includes(r.decoratorName))&&r.componentName)return r.componentName;return null}function parseExtendNode(e,t,r){_typescript.default.isIdentifier(e.expression)&&(t.decoratorName=e.expression.escapedText.toString(),r)&&_pre_define.CHECK_EXTEND_DECORATORS.includes(t.decoratorName)&&e.arguments&&1!==e.arguments.length&&transformLog.errors.push({type:_utils.LogType.ERROR,message:`@${t.decoratorName} should have one and only one parameter`,pos:e.getStart()}),e.arguments.length&&_typescript.default.isIdentifier(e.arguments[0])&&(t.componentName=e.arguments[0].escapedText.toString())}function createEntryNode(e,t,r,a){let o;var i;return _main.projectConfig&&_main.projectConfig.cardObj&&(o=_main.projectConfig.cardObj[resourceFileName]),0!==_validate_ui_syntax.componentCollection.previewComponent.length&&_main.projectConfig.isPreview?(i=createPreviewComponentFunction(_validate_ui_syntax.componentCollection.entryComponent,t,o,r,a),t.factory.updateSourceFile(e,[...e.statements,i])):_validate_ui_syntax.componentCollection.entryComponent?_main.partialUpdateConfig.partialUpdateMode?(i=createEntryFunction(_validate_ui_syntax.componentCollection.entryComponent,t,o,r,a))?t.factory.updateSourceFile(e,[...e.statements,...i]):t.factory.updateSourceFile(e,[...e.statements]):(i=createEntryFunction(_validate_ui_syntax.componentCollection.entryComponent,t,o,r,a),t.factory.updateSourceFile(e,[...e.statements,i])):e}function createEntryFunction(e,t,r,a,o){var o=[t.factory.createStringLiteral(o.toString()),t.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),t.factory.createObjectLiteralExpression([],!1)],[i,n]=addStorageParam(e),o=(i&&a&&o.push(a),[t.factory.createNewExpression(t.factory.createIdentifier(e),void 0,o)]);return addCardStringliteral(o,t,r),_main.partialUpdateConfig.partialUpdateMode?r?(n&&_typescript.default.isObjectLiteralExpression(n)&&transformLog.errors.push({type:_utils.LogType.ERROR,message:"@Entry doesn't support {} parameter in card",pos:_validate_ui_syntax.componentCollection.entryComponentPos}),[createStartGetAccessRecording(t),createLoadDocument(t,e,r,i,a),createStopGetAccessRecording(t)]):createLoadPageConditionalJudgMent(t,e,r,i,n):t.factory.createExpressionStatement(t.factory.createCallExpression(t.factory.createIdentifier(r?_pre_define.CARD_ENTRY_FUNCTION_NAME:_pre_define.PAGE_ENTRY_FUNCTION_NAME),void 0,o))}function createLoadPageConditionalJudgMent(t,r,a,o,i,n=void 0,c=!1){var s=this;let p=!1;const l=new _utils.EntryOptionValue;if(i)return _typescript.default.isObjectLiteralExpression(i)?(p=!0,i.properties&&(i.properties.forEach(function(e){_newArrowCheck(this,s),_typescript.default.isPropertyAssignment(e)&&e.name&&_typescript.default.isIdentifier(e.name)&&(l[e.name.escapedText.toString()]=e.initializer)}.bind(this)),l.useSharedStorage)&&(l.storage=(0,_utils.createGetShared)(l))):p=!1,generateLoadDocumentEntrance(p,l.routeName,l.storage,c,t,r,a,i,n);{let e;if(10<_main.projectConfig.minAPIVersion){if(_validate_ui_syntax.componentCollection.entryComponent===r&&_validate_ui_syntax.componentCollection.localSharedStorage)return[judgeRouteNameAndStorageForIdentifier(t,r,a,p,_validate_ui_syntax.componentCollection.localSharedStorage,void 0,void 0,n)];c=[t.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),t.factory.createObjectLiteralExpression([],!1)],n=[t.factory.createNewExpression(t.factory.createIdentifier(r),void 0,c)];e=[createRegisterNamedRoute(t,n,!1,void 0,!1)]}else e=[createStartGetAccessRecording(t),createLoadDocument(t,r,a,o,i),createStopGetAccessRecording(t)];return e}}function generateLoadDocumentEntrance(e,t,r,a,o,i,n,c,s){return e?t&&!r?a?[...assignRouteNameAndStorage(t),...createLoadDocumentWithRoute(o,i,n,e,c,t,r,!0,!1,!1,s)]:[_typescript.default.factory.createBlock([...assignRouteNameAndStorage(t),...createLoadDocumentWithRoute(o,i,n,e,c,t,r,!0,!1,!1,s)])]:t||r?!t&&r?a?[...assignRouteNameAndStorage(t),...createLoadDocumentWithRoute(o,i,n,e,c,t,r,!1,!0,!0,s)]:[_typescript.default.factory.createBlock([...assignRouteNameAndStorage(t),...createLoadDocumentWithRoute(o,i,n,e,c,t,r,!1,!0,!0,s)])]:a?[...assignRouteNameAndStorage(t),judgeRouteNameAndStorage(o,i,n,e,c,t,r,s)]:[_typescript.default.factory.createBlock([...assignRouteNameAndStorage(t),judgeRouteNameAndStorage(o,i,n,e,c,t,r,s)])]:a?[...assignRouteNameAndStorage(t),...createLoadDocumentWithRoute(o,i,n,e,c,t,r,!1,!1,!0,s)]:[_typescript.default.factory.createBlock([...assignRouteNameAndStorage(t),...createLoadDocumentWithRoute(o,i,n,e,c,t,r,!1,!1,!0,s)])]:[judgeRouteNameAndStorage(o,i,n,e,c,t,r,s)]}function judgeRouteNameAndStorage(e,t,r,a,o,i,n,c=void 0){return(a?judgeRouteNameAndStorageForObj:judgeRouteNameAndStorageForIdentifier)(e,t,r,a,o,i,n,c)}function judgeRouteNameAndStorageForObj(e,t,r,a,o,i,n,c=void 0){return _typescript.default.factory.createIfStatement(judgeRouteAndStorageForObject(!0),_typescript.default.factory.createBlock([...createLoadDocumentWithRoute(e,t,r,a,o,i,n,!0,!0,!1,c)],!0),_typescript.default.factory.createBlock([...createLoadDocumentWithRoute(e,t,r,a,o,i,n,!1,!1,!0,c)],!0))}function judgeRouteNameAndStorageForIdentifier(e,t,r,a,o,i,n,c=void 0){return _typescript.default.factory.createIfStatement(judgeRouteAndStorageForIdentifier(o,!0,!0),_typescript.default.factory.createBlock([...createLoadDocumentWithRoute(e,t,r,a,o,i,n,!0,!0,!1,c)],!0),_typescript.default.factory.createIfStatement(judgeRouteAndStorageForIdentifier(o,!0,!1),_typescript.default.factory.createBlock([...createLoadDocumentWithRoute(e,t,r,a,o,i,n,!0,!1,!1,c)],!0),_typescript.default.factory.createIfStatement(judgeRouteAndStorageForIdentifier(o,!1,!0),_typescript.default.factory.createBlock([...createLoadDocumentWithRoute(e,t,r,a,o,i,n,!1,!0,!0,c)],!0),_typescript.default.factory.createIfStatement((0,_utils.judgeUseSharedStorageForExpresion)(o),_typescript.default.factory.createBlock([...createSharedStorageWithRoute(e,t,r,o,!0,c)],!0),_typescript.default.factory.createBlock([...createLoadDocumentWithRoute(e,t,r,!1,o,null,null,!1,!1,!0,c)],!0)))))}function judgeRouteAndStorageForObject(e){return _typescript.default.factory.createBinaryExpression(_typescript.default.factory.createIdentifier(_pre_define.ROUTENAME_NODE),_typescript.default.factory.createToken(e?_typescript.default.SyntaxKind.ExclamationEqualsToken:_typescript.default.SyntaxKind.EqualsEqualsToken),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED))}function judgeRouteAndStorageForIdentifier(e,t,r){return _typescript.default.factory.createBinaryExpression(_typescript.default.factory.createBinaryExpression(e,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.AmpersandAmpersandToken),_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(e,_typescript.default.factory.createIdentifier(_pre_define.ROUTE_NAME)),_typescript.default.factory.createToken(t?_typescript.default.SyntaxKind.ExclamationEqualsToken:_typescript.default.SyntaxKind.EqualsEqualsToken),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED))),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.AmpersandAmpersandToken),_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(e,_typescript.default.factory.createIdentifier(_pre_define.STORAGE)),_typescript.default.factory.createToken(r?_typescript.default.SyntaxKind.ExclamationEqualsToken:_typescript.default.SyntaxKind.EqualsEqualsToken),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED)))}function assignRouteNameAndStorage(e){var t=[];return e&&t.push(_typescript.default.factory.createVariableStatement(void 0,_typescript.default.factory.createVariableDeclarationList([_typescript.default.factory.createVariableDeclaration(_typescript.default.factory.createIdentifier(_pre_define.ROUTENAME_NODE),void 0,void 0,e)],_typescript.default.NodeFlags.Let))),t}function createLoadDocumentWithRoute(e,t,r,a,o,i,n,c,s,p,l){var d=[e.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),e.factory.createObjectLiteralExpression([],!1)];return o&&(a?n&&d.push(n):d.push(null===i&&null===n?o:(0,_utils.createGetSharedForVariable)(o))),loadDocumentWithRoute(e,t,d,l,c,p,a,o,r)}function loadDocumentWithRoute(r,a,o,i,e,t,n,c,s){var p=this,l=[r.factory.createNewExpression(r.factory.createIdentifier(a),void 0,o)];return i&&(i=[],_validate_ui_syntax.componentCollection.previewComponent.forEach(function(e){_newArrowCheck(this,p);var t=r.factory.createNewExpression(r.factory.createIdentifier(e),void 0,e===a?o:o.slice(0,o.length-1));i.push(r.factory.createStringLiteral(e),t)}.bind(this))),e?[t?createStartGetAccessRecording(r):void 0,createRegisterNamedRoute(r,l,n,c,e),t?createStopGetAccessRecording(r):void 0]:10<_main.projectConfig.minAPIVersion?[createRegisterNamedRoute(r,l,n,c,e)]:[t?createStartGetAccessRecording(r):void 0,r.factory.createExpressionStatement(r.factory.createCallExpression(r.factory.createIdentifier(s?_pre_define.CARD_ENTRY_FUNCTION_NAME:_pre_define.PAGE_ENTRY_FUNCTION_NAME),void 0,l)),t?createStopGetAccessRecording(r):void 0]}function createRegisterNamedRoute(e,t,r,a,o){return e.factory.createExpressionStatement(e.factory.createCallExpression(e.factory.createIdentifier(_pre_define.REGISTER_NAMED_ROUTE),void 0,[e.factory.createArrowFunction(void 0,void 0,[],void 0,e.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),t[0]),o?r?_typescript.default.factory.createIdentifier(_pre_define.ROUTENAME_NODE):e.factory.createPropertyAccessExpression(a,e.factory.createIdentifier(_pre_define.ROUTE_NAME)):_typescript.default.factory.createStringLiteral(""),e.factory.createObjectLiteralExpression([(0,_process_module_package.routerBundleOrModule)(e,_pre_define.RESOURCE_NAME_BUNDLE),(0,_process_module_package.routerBundleOrModule)(e,_pre_define.RESOURCE_NAME_MODULE),(0,_process_module_package.routerOrNavPathWrite)(e,_pre_define.PAGE_PATH,_main.projectConfig.projectPath,_main.projectConfig.projectRootPath),(0,_process_module_package.routerOrNavPathWrite)(e,_pre_define.PAGE_FULL_PATH,_main.projectConfig.projectRootPath),e.factory.createPropertyAssignment(e.factory.createIdentifier(_pre_define.INTEGRATED_HSP),e.factory.createStringLiteral((0,_process_module_package.integratedHspType)())),(0,_process_module_package.routerModuleType)(e)],!1)]))}function createStartGetAccessRecording(e){return e.factory.createExpressionStatement(e.factory.createCallExpression(e.factory.createPropertyAccessExpression(e.factory.createIdentifier(_pre_define.VIEWSTACKPROCESSOR),e.factory.createIdentifier(_pre_define.STARTGETACCESSRECORDINGFOR)),void 0,[e.factory.createCallExpression(e.factory.createPropertyAccessExpression(e.factory.createIdentifier(_pre_define.VIEWSTACKPROCESSOR),e.factory.createIdentifier(_pre_define.ALLOCATENEWELMETIDFORNEXTCOMPONENT)),void 0,[])]))}function createLoadDocument(e,t,r,a,o){var i=[e.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),e.factory.createObjectLiteralExpression([],!1)],a=(a&&o&&i.push(o),[e.factory.createNewExpression(e.factory.createIdentifier(t),void 0,i)]);return addCardStringliteral(a,e,r),e.factory.createExpressionStatement(e.factory.createCallExpression(e.factory.createIdentifier(r?_pre_define.CARD_ENTRY_FUNCTION_NAME:_pre_define.PAGE_ENTRY_FUNCTION_NAME),void 0,a))}function createStopGetAccessRecording(e){return e.factory.createExpressionStatement(e.factory.createCallExpression(e.factory.createPropertyAccessExpression(e.factory.createIdentifier(_pre_define.VIEWSTACKPROCESSOR),e.factory.createIdentifier(_pre_define.STOPGETACCESSRECORDING)),void 0,[]))}function addStorageParam(e){let t,r;var a=(_validate_ui_syntax.localStorageLinkCollection.get(e)||new Set).size+(_validate_ui_syntax.localStoragePropCollection.get(e)||new Set).size;return _validate_ui_syntax.componentCollection.entryComponent===e&&(_validate_ui_syntax.componentCollection.localStorageNode&&(r=_validate_ui_syntax.componentCollection.localStorageNode),_validate_ui_syntax.componentCollection.localStorageName&&(t=_validate_ui_syntax.componentCollection.localStorageName),!hasStorage())&&a&&transformLog.errors.push({type:_utils.LogType.WARN,message:"@Entry should have a parameter, like '@Entry (storage)'.",pos:_validate_ui_syntax.componentCollection.entryComponentPos}),[t,r]}function hasStorage(){return!!(_validate_ui_syntax.componentCollection.localStorageName||_validate_ui_syntax.componentCollection.localStorageNode||_validate_ui_syntax.componentCollection.localSharedStorage)}function createPreviewComponentFunction(e,r,t,a,o){var i=this;const n=_main.partialUpdateConfig.partialUpdateMode?[r.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),r.factory.createObjectLiteralExpression([],!1)]:[r.factory.createStringLiteral(o.toString()),r.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),r.factory.createObjectLiteralExpression([],!1)];var[o,c]=addStorageParam(e);c&&n.push(c);const s=[];_validate_ui_syntax.componentCollection.previewComponent.forEach(function(e){_newArrowCheck(this,i);var t=r.factory.createNewExpression(r.factory.createIdentifier(e),void 0,n);s.push(r.factory.createStringLiteral(e)),s.push(t)}.bind(this));var p=e?[r.factory.createNewExpression(r.factory.createIdentifier(e),void 0,n)]:[],e=(addCardStringliteral(p,r,t),r.factory.createIfStatement(r.factory.createCallExpression(r.factory.createIdentifier(_pre_define.GET_PREVIEW_FLAG_FUNCTION_NAME),void 0,[]),r.factory.createBlock([...storePreviewComponents(e,c,s),r.factory.createExpressionStatement(r.factory.createCallExpression(r.factory.createIdentifier(_pre_define.PREVIEW_COMPONENT_FUNCTION_NAME),void 0,[]))],!0),r.factory.createBlock(createPreviewElseBlock(e,r,t,o,c,p,s),!0)));return e}function storePreviewComponents(e,t,r){var a=this;let o=!1,i;if(!t)return[_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createIdentifier(_pre_define.STORE_PREVIEW_COMPONENTS),void 0,[_typescript.default.factory.createNumericLiteral(_validate_ui_syntax.componentCollection.previewComponent.length),...r]))];_typescript.default.isObjectLiteralExpression(t)?(o=!0,t.properties&&t.properties.forEach(function(e){_newArrowCheck(this,a),_typescript.default.isPropertyAssignment(e)&&e.name&&_typescript.default.isIdentifier(e.name)&&e.name.escapedText.toString()===_pre_define.STORAGE&&(i=e.initializer)}.bind(this))):o=!1;r=[_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),_typescript.default.factory.createObjectLiteralExpression([],!1)];return o?processObjectStorage(i,r,e,[]):[_typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(t,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.AmpersandAmpersandToken),_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(t,_typescript.default.factory.createIdentifier(_pre_define.STORAGE)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.ExclamationEqualsToken),_typescript.default.factory.createIdentifier("undefined"))),_typescript.default.factory.createBlock([returnStorePreview(t,!0,e)],!0),_typescript.default.factory.createBlock([returnStorePreview(t,!1,e)],!0))]}function processObjectStorage(e,r,a,o){var i=this;return e?(r.push(_typescript.default.factory.createIdentifier(_pre_define.STORAGE_NODE)),_validate_ui_syntax.componentCollection.previewComponent.forEach(function(e){_newArrowCheck(this,i);var t=_typescript.default.factory.createNewExpression(_typescript.default.factory.createIdentifier(e),void 0,e===a?r:r.slice(0,r.length-1));o.push(_typescript.default.factory.createStringLiteral(e)),o.push(t)}.bind(this)),[_typescript.default.factory.createVariableStatement(void 0,_typescript.default.factory.createVariableDeclarationList([_typescript.default.factory.createVariableDeclaration(_typescript.default.factory.createIdentifier(_pre_define.STORAGE_NODE),void 0,void 0,e)],_typescript.default.NodeFlags.Let)),_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createIdentifier(_pre_define.STORE_PREVIEW_COMPONENTS),void 0,[_typescript.default.factory.createNumericLiteral(_validate_ui_syntax.componentCollection.previewComponent.length),...o]))]):(_validate_ui_syntax.componentCollection.previewComponent.forEach(function(e){_newArrowCheck(this,i);var t=_typescript.default.factory.createNewExpression(_typescript.default.factory.createIdentifier(e),void 0,r);o.push(_typescript.default.factory.createStringLiteral(e)),o.push(t)}.bind(this)),[_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createIdentifier(_pre_define.STORE_PREVIEW_COMPONENTS),void 0,[_typescript.default.factory.createNumericLiteral(_validate_ui_syntax.componentCollection.previewComponent.length),...o]))])}function returnStorePreview(e,t,r){var a=this;const o=[_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),_typescript.default.factory.createObjectLiteralExpression([],!1)],i=[];return o.push(t?_typescript.default.factory.createPropertyAccessExpression(e,_typescript.default.factory.createIdentifier(_pre_define.STORAGE)):e),_validate_ui_syntax.componentCollection.previewComponent.forEach(function(e){_newArrowCheck(this,a);var t=_typescript.default.factory.createNewExpression(_typescript.default.factory.createIdentifier(e),void 0,e===r?o:o.slice(0,o.length-1));i.push(_typescript.default.factory.createStringLiteral(e)),i.push(t)}.bind(this)),_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createIdentifier(_pre_define.STORE_PREVIEW_COMPONENTS),void 0,[_typescript.default.factory.createNumericLiteral(_validate_ui_syntax.componentCollection.previewComponent.length),...i]))}function createPreviewElseBlock(e,t,r,a,o,i,n){if(e)return _main.partialUpdateConfig.partialUpdateMode?r?(o&&_typescript.default.isObjectLiteralExpression(o)&&transformLog.errors.push({type:_utils.LogType.ERROR,message:"@Entry doesn't support {} parameter in card",pos:_validate_ui_syntax.componentCollection.entryComponentPos}),[e?createStartGetAccessRecording(t):void 0,e?t.factory.createExpressionStatement(t.factory.createCallExpression(t.factory.createIdentifier(r?_pre_define.CARD_ENTRY_FUNCTION_NAME:_pre_define.PAGE_ENTRY_FUNCTION_NAME),void 0,i)):void 0,e?createStopGetAccessRecording(t):void 0]):createLoadPageConditionalJudgMent(t,e,r,a,o,n,!0):[t.factory.createExpressionStatement(t.factory.createCallExpression(t.factory.createIdentifier(_pre_define.STORE_PREVIEW_COMPONENTS),void 0,[t.factory.createNumericLiteral(_validate_ui_syntax.componentCollection.previewComponent.length),...n])),t.factory.createExpressionStatement(t.factory.createCallExpression(t.factory.createIdentifier(r?_pre_define.CARD_ENTRY_FUNCTION_NAME:_pre_define.PAGE_ENTRY_FUNCTION_NAME),void 0,i))]}function resetLog(){transformLog.errors=[]}function addCardStringliteral(e,t,r){var a=_main.projectConfig.allowEmptyBundleName?"":_main.projectConfig.bundleName;r&&e.push(t.factory.createStringLiteral(a+"/"+_main.projectConfig.moduleName+"/"+r))}function validatorCard(e,t,r,a=""){if(_main.projectConfig&&_main.projectConfig.cardObj&&resourceFileName&&_main.projectConfig.cardObj[resourceFileName]){var o={type:_utils.LogType.ERROR,message:"",pos:r};switch(t){case _pre_define.CARD_LOG_TYPE_COMPONENTS:o.message=`Card page cannot use the component ${a}.`;break;case _pre_define.CARD_LOG_TYPE_DECORATORS:o.message="Card page cannot use "+a;break;case _pre_define.CARD_LOG_TYPE_IMPORT:o.message="Card page cannot use import."}e.push(o)}}function resetProcessUiSyntax(){exports.transformLog=transformLog=new _create_ast_node_utils.default.FileLog,exports.contextGlobal=contextGlobal=void 0}function createSharedStorageWithRoute(e,t,r,a,o,i){return loadDocumentWithRoute(e,t,[_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),_typescript.default.factory.createObjectLiteralExpression([],!1),(0,_utils.createGetSharedForVariable)(a,!1)],i,!1,o,!1,a,r)}function insertImportModuleNode(e,t){return isDynamic()&&(t||_validate_ui_syntax.componentCollection.entryComponent)&&e.unshift(_create_ast_node_utils.default.createImportNodeForModuleInfo()),e}function isDynamic(){var e=_main.projectConfig.compileHar&&_main.projectConfig.byteCodeHar,t=!!_main.projectConfig.uiTransformOptimization;return t||e}exports.builderTypeParameter=builderTypeParameter;