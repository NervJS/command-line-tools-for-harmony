"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SRC_MAIN=void 0,exports.buildCachePath=buildCachePath,exports.cleanUpUtilsObjects=cleanUpUtilsObjects,exports.compileToolIsRollUp=compileToolIsRollUp,exports.createAndStartEvent=createAndStartEvent,exports.genAbcFileName=genAbcFileName,exports.genBuildPath=genBuildPath,exports.genMergeProtoFileName=genMergeProtoFileName,exports.genProtoFileName=genProtoFileName,exports.genSourceMapFileName=genSourceMapFileName,exports.generateSourceFilesToTemporary=generateSourceFilesToTemporary,exports.getArkBuildDir=getArkBuildDir,exports.getBuildBinDir=getBuildBinDir,exports.getBuildModeInLowerCase=getBuildModeInLowerCase,exports.getHookEventFactory=getHookEventFactory,exports.getNormalizedOhmUrlByAliasName=getNormalizedOhmUrlByAliasName,exports.getNormalizedOhmUrlByFilepath=getNormalizedOhmUrlByFilepath,exports.getOhmUrlByByteCodeHar=getOhmUrlByByteCodeHar,exports.getOhmUrlByExternalPackage=getOhmUrlByExternalPackage,exports.getOhmUrlByFilepath=getOhmUrlByFilepath,exports.getOhmUrlBySystemApiOrLibRequest=getOhmUrlBySystemApiOrLibRequest,exports.getPackageInfo=getPackageInfo,exports.isEs2Abc=isEs2Abc,exports.isOhModules=isOhModules,exports.isTs2Abc=isTs2Abc,exports.mangleDeclarationFileName=mangleDeclarationFileName,exports.packageCollection=exports.newSourceMaps=void 0,exports.removeDuplicateInfo=removeDuplicateInfo,exports.stopEvent=stopEvent,exports.transformModuleSpecifier=transformModuleSpecifier,exports.transformOhmurlToPkgName=transformOhmurlToPkgName,exports.transformOhmurlToRecordName=transformOhmurlToRecordName,exports.tryMangleFileName=tryMangleFileName,exports.writeArkguardObfuscatedSourceCode=writeArkguardObfuscatedSourceCode,exports.writeDeclarationFiles=writeDeclarationFiles,exports.writeFileSyncByString=writeFileSyncByString,exports.writeMinimizedSourceCode=writeMinimizedSourceCode,exports.writeObfuscatedSourceCode=writeObfuscatedSourceCode;var _path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs")),_terser=require("terser"),_arkguard=require("arkguard"),_ark_define=require("./fast_build/ark_compiler/common/ark_define"),_pre_define=require("./pre_define"),_utils=require("./utils"),_main=require("../main"),_ob_config_resolver=require("./fast_build/ark_compiler/common/ob_config_resolver"),_api_check_utils=require("./fast_build/system_api/api_check_utils"),_generate_sourcemap=require("./fast_build/ark_compiler/generate_sourcemap");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}const red="[31m",reset="[39m",SRC_MAIN="src/main";exports.SRC_MAIN=SRC_MAIN;let newSourceMaps={};exports.newSourceMaps=newSourceMaps;const packageCollection=new Map;function getNormalizedOhmUrlByFilepath(e,t,r,i,a){var{pkgName:i,pkgPath:o,isRecordName:n}=i;e.startsWith("\0")&&(e=e.replace("\0",""));let l=(0,_utils.toUnixPath)(e);l=l.substring(0,e.lastIndexOf("."));t=t.pkgContextInfo[i];return t&&o?(o=l.replace((0,_utils.toUnixPath)(o),""),o=t.bundleName+`&${i}${o}&`+t.version,n?o:`${t.isSO?"Y":"N"}&${t.moduleName}&`+o):(r.error(red,"ArkTS:ERROR Failed to resolve OhmUrl.\n"+`Error Message: Failed to get a resolved OhmUrl for "${e}" imported by "${a}".
`+`Solutions: > Check whether the "${i}" module which ${e} belongs to is correctly configured.`+"> Check the corresponding file name is correct(including case-sensitivity).",reset),e)}function getOhmUrlByFilepath(e,t,r,i,a){e.startsWith("\0")&&(e=e.replace("\0",""));let o=(0,_utils.toUnixPath)(e);o=o.substring(0,e.lastIndexOf("."));var n=getPackageInfo(t.aceModuleJsonPath),l=n[0],n=n[1],s=(0,_utils.toUnixPath)(t.modulePathMap[n]),c=(0,_utils.toUnixPath)((0,_utils.getProjectRootPath)(e,t,t?.rootPathSet)),u=o.replace(c,""),d=t.packageDir,p=u.match(/(\S+)\/src\/(?:main|ohosTest)\/(ets|js|mock)\/(\S+)/);return p&&-1===p[1].indexOf(d)?(p=processSrcMain(p,u),i&&n!==i?l+`/${n}@${i}/`+p:l+`/${n}/`+p):processPackageDir({projectFilePath:u,unixFilePath:o,packageDir:d,projectRootPath:c,moduleRootPath:s,projectConfig:t,namespace:i,logger:r,importerFile:a,originalFilePath:e})}function processSrcMain(e,t){let r=e[2],i=e[3];var a=/src\/(?:main|ohosTest)\/(ets|js)\//,e=e[1].search(a);return-1!==e&&(i=t.substring(e).replace(a,""),r=t.replace(i,"").match(a)[1]),r+"/"+i}function processPackageDir(e){const{projectFilePath:t,unixFilePath:r,packageDir:i,projectRootPath:a,moduleRootPath:o,projectConfig:n,namespace:l,logger:s,importerFile:c,originalFilePath:u}=e;if(-1!==t.indexOf(i)){if(compileToolIsRollUp()){e=(0,_utils.toUnixPath)(_path.default.join(a,i));if(-1!==r.indexOf(e))return r.replace(e,""+i).replace(new RegExp(i,"g"),_pre_define.PACKAGES);for(const f in n.modulePathMap){var d=n.modulePathMap[f],d=(0,_utils.toUnixPath)(_path.default.resolve(d,i));if(-1!==r.indexOf(d))return r.replace(d,i+"@"+f).replace(new RegExp(i,"g"),_pre_define.PACKAGES)}return s.error(red,"ArkTS:ERROR Failed to resolve OhmUrl.\n"+`Error Message: Failed to get a resolved OhmUrl for "${u}" imported by "${c}".
`+`Solutions: > Check whether the module which ${u} belongs to is correctly configured.`+"> Check the corresponding file name is correct(including case-sensitivity).",reset),u}e=(0,_utils.toUnixPath)(_path.default.join(a,i));if(-1!==r.indexOf(e))return r.replace(e,i+"/"+_pre_define.ONE).replace(new RegExp(i,"g"),_pre_define.PACKAGES);e=(0,_utils.toUnixPath)(_path.default.join(o,i));if(-1!==r.indexOf(e))return r.replace(e,i+"/"+_pre_define.ZERO).replace(new RegExp(i,"g"),_pre_define.PACKAGES)}var p,e=getPackageInfo(n.aceModuleJsonPath),h=e[0];const f=e[1];for(const _ in n.modulePathMap){const o=(0,_utils.toUnixPath)(n.modulePathMap[_]);if(-1!==r.indexOf(o+"/"))return p=r.replace(o+"/",""),l&&f!==l?`${h}/${f}@${l}/`+p:`${h}/${f}/`+p}return s.error(red,"ArkTS:ERROR Failed to resolve OhmUrl.\n"+`Error Message: Failed to get a resolved OhmUrl for "${u}" imported by "${c}".
`+`Solutions: > Check whether the module which ${u} belongs to is correctly configured.`+"> Check the corresponding file name is correct(including case-sensitivity).",reset),u}function getOhmUrlBySystemApiOrLibRequest(a,e,t,r,i=!1){var o=this,n=new RegExp(`@(${_main.sdkConfigPrefix})\\.(\\S+)`),l=/lib(\S+)\.so/;return n.test(a.trim())?a.replace(n,function(e,t,r){_newArrowCheck(this,o);let i="";return""!==(i=_main.extendSdkConfigs?(0,_api_check_utils.moduleRequestCallback)(a,e,t,r):i)?i:_pre_define.NATIVE_MODULE.has(e=t+"."+r)?"@native:"+e:t===_pre_define.ARKTS_MODULE_NAME?"@ohos:"+e:"@ohos:"+r}.bind(this)):l.test(a.trim())?i?(void 0===(n=e.pkgContextInfo[a])&&t?.error(red,`ArkTS:INTERNAL ERROR: Can not get pkgContextInfo of package '${a}' `+`which being imported by '${r}'`,reset),`@normalized:${n.isSO?"Y":"N"}&${n.moduleName}&${n.bundleName}&${a}&`+n.version):a.replace(l,function(e,t){return _newArrowCheck(this,o),`@app:${_main.projectConfig.bundleName}/${_main.projectConfig.moduleName}/`+t}.bind(this)):void 0}function genSourceMapFileName(e){let t=e;return t=e.endsWith(_pre_define.EXTNAME_TS)?e.replace(/\.ts$/,_pre_define.EXTNAME_TS_MAP):e.replace(/\.js$/,_pre_define.EXTNAME_JS_MAP)}function getBuildModeInLowerCase(e){return(compileToolIsRollUp()?e.buildMode:e.buildArkMode).toLowerCase()}function writeFileSyncByString(e,t,r,i){var a=(0,_utils.genTemporaryPath)(e,r.projectPath,process.env.cachePath,r,void 0);if(0!==a.length){if((0,_utils.mkdirsSync)(_path.default.dirname(a)),/\.js$/.test(e)){if(t=transformModuleSpecifier(e,t,r),"debug"===r.buildArkMode)return void _fs.default.writeFileSync(a,t);writeObfuscatedSourceCode({content:t,buildFilePath:a,relativeSourceFilePath:""},i,r)}/\.json$/.test(e)&&_fs.default.writeFileSync(a,t)}}function transformModuleSpecifier(r,e,i){var a=this;return e.replace(/(?:import|from)(?:\s*)['"]([^\.\/][^'"]+)['"]/g,function(e,t){return _newArrowCheck(this,a),replaceHarDependency(e,t,i)}.bind(this)).replace(/(?:import|from)(?:\s*)['"]((?:\.\/|\.\.\/)[^'"]+|(?:\.\/?|\.\.\/?))['"]/g,function(e,t){return _newArrowCheck(this,a),replaceRelativeDependency(e,t,(0,_utils.toUnixPath)(r),i)}.bind(this)).replace(/var (\S+) = globalThis.requireNativeModule\(['"](\S+)['"]\);/g,function(e,t,r){return _newArrowCheck(this,a),`import ${t} from '@native:${r}';`}.bind(this)).replace(/var (\S+) = globalThis.requireNapi\(['"](\S+)['"], true, ['"](\S+)['"]\);/g,function(e,t,r,i){return _newArrowCheck(this,a),`import ${t} from '@app:${i}/${r}';`}.bind(this)).replace(/var (\S+) = globalThis.requireNapi\(['"](\S+)['"]\);/g,function(e,t,r){return _newArrowCheck(this,a),`import ${t} from '@ohos:${r}';`}.bind(this))}function removeSuffix(e){return e.split(_path.default.sep).join("/").replace(/\.(?:d\.)?(ets|ts|mjs|cjs|js)$/,"")}function getNormalizedOhmUrlByAliasName(e,t,r,i){let a=e;var o=t.dependencyAliasMap,o=(o.has(e)&&(a=o.get(e)),t.pkgContextInfo[a]);o||r.error(red,`ArkTS:INTERNAL ERROR: Failed to find package '${a}'.
`+`Error Message: Failed to obtain package '${a}' from the package context information.`,reset);let n="";return n=i?(t=(0,_utils.toUnixPath)(i).replace(e,""),""+a+t):(o.entryPath||r.error(red,`ArkTS:INTERNAL ERROR: Failed to find entry file of '${a}'.
`+`Error Message: Failed to obtain the entry file information of '${a}' from the package context information.`,reset),removeSuffix(n=a+"/"+(0,_utils.toUnixPath)(o.entryPath))),`@normalized:${o.isSO?"Y":"N"}&${o.moduleName}&${o.bundleName}&${n}&`+o.version}function getOhmUrlByByteCodeHar(e,t,r){if(t.byteCodeHarInfo){var i=getAliasNameFromPackageMap(t.byteCodeHarInfo,e);if(i)return getNormalizedOhmUrlByAliasName(i,t,r);for(const a in t.byteCodeHarInfo)if(e.startsWith(a+"/"))return getNormalizedOhmUrlByAliasName(a,t,r,e)}}function getAliasNameFromPackageMap(e,t){var r=/^\/*$|^\\*$/;for(const a of Object.keys(e)){if(t===a)return a;if(t.length>a.length&&t.startsWith(a)){var i=t.replace(a,"");if(r.test(i))return a}}}function getOhmUrlByExternalPackage(e,t,r,i=!1){var a=Object.assign({},t.hspNameOhmMap,t.harNameOhmMap);if(0!==Object.keys(a).length){var o,n=getAliasNameFromPackageMap(a,e);if(n)return i?getNormalizedOhmUrlByAliasName(n,t,r):a[e];for(const l in a)if(e.startsWith(l+"/"))return i?getNormalizedOhmUrlByAliasName(l,t,r,e):(o=a[l].split("/",2).join("/").length,o=a[l].substring(0,o),0===e.indexOf(l+"/"+SRC_MAIN)?e.replace(l+"/"+SRC_MAIN,o):e.replace(l,o))}}function replaceHarDependency(e,t,r){var i=this;const a=getOhmUrlByExternalPackage(t,r);return void 0!==a?e.replace(/(['"])(?:\S+)['"]/,function(e,t){return _newArrowCheck(this,i),t+a+t}.bind(this)):e}function locateActualFilePathWithModuleRequest(e){var t;return!_fs.default.existsSync(e)||!_fs.default.statSync(e).isDirectory()||(t=e+(0,_utils.getExtensionIfUnfullySpecifiedFilepath)(e),_fs.default.existsSync(t)&&_fs.default.statSync(t).isFile())?e:_path.default.join(e,"index")}function replaceRelativeDependency(e,i,t,r){var a,o,n=this;return t&&r.compileMode===_pre_define.ESMODULE&&(i=i.replace(/\.(?:[cm]?js|[e]?ts|json)$/,""),e=e.replace(/(['"])(?:\S+)['"]/,function(e,t){_newArrowCheck(this,n);let r=(0,_utils.toUnixPath)(_path.default.normalize(i));return t+(r=i.startsWith("./")?"./"+r:r)+t}.bind(this)),t=locateActualFilePathWithModuleRequest(_path.default.resolve(_path.default.dirname(t),i)).match(/(\S+)(\/|\\)src(\/|\\)(?:main|ohosTest)(\/|\\)(ets|js)(\/|\\)(\S+)/))&&r.aceModuleJsonPath&&(a=t[1].search(/(\/|\\)node_modules(\/|\\)/),o=r.projectRootPath,-1!==a&&a!==o.search(/(\/|\\)node_modules(\/|\\)/)||(o=(a=getPackageInfo(r.aceModuleJsonPath))[0],r=a[1],i=`@bundle:${o}/${r}/${t[5]}/`+(0,_utils.toUnixPath)(t[7]),e=e.replace(/(['"])(?:\S+)['"]/,function(e,t){return _newArrowCheck(this,n),t+i+t}.bind(this)))),e}async function writeObfuscatedSourceCode(t,e,r,i={}){if(compileToolIsRollUp()&&r.arkObfuscator)(0,_arkguard.startFilesEvent)(t.buildFilePath),_arkguard.MemoryUtils.tryGC(),await writeArkguardObfuscatedSourceCode(t,e,r,i),_arkguard.MemoryUtils.tryGC(),(0,_arkguard.endFilesEvent)(t.buildFilePath,void 0,!0);else if((0,_utils.mkdirsSync)(_path.default.dirname(t.buildFilePath)),compileToolIsRollUp()){if(t.originSourceFilePath){i=(0,_utils.toUnixPath)(t.originSourceFilePath);let e=_utils.harFilesRecord.get(i);(e=e||{sourcePath:i}).sourceCachePath||(e.sourceCachePath=(0,_utils.toUnixPath)(t.buildFilePath)),_utils.harFilesRecord.set(i,e)}_fs.default.writeFileSync(t.buildFilePath,t.content)}else await writeMinimizedSourceCode(t.content,t.buildFilePath,e,r.compileHar)}async function writeArkguardObfuscatedSourceCode(t,r,e,i={}){var a=e.arkObfuscator,o=/\.d\.e?ts$/.test(t.buildFilePath),n=e.packageDir,l=e.projectRootPath,s=e.useNormalizedOHMUrl,c=e.localPackageSet,u=e.useTsHar,d=_generate_sourcemap.SourceMapGenerator.getInstance();let p=void 0;0<t.relativeSourceFilePath.length&&!o&&(h=d.isNewSourceMaps()?t.rollupModuleId:t.relativeSourceFilePath,p=d.getSpecifySourceMap(i,h));var h=(0,_ob_config_resolver.getNameCacheByPath)(t,o,l);let f;n={packageDir:n,projectRootPath:l,localPackageSet:c,useNormalized:s,useTsHar:u},l={buildFilePath:t.buildFilePath,relativeFilePath:t.relativeSourceFilePath};try{(0,_arkguard.startSingleFileEvent)(_arkguard.EventList.OBFUSCATE,_arkguard.performancePrinter.timeSumPrinter,l.buildFilePath),f=await a.obfuscate(t.content,l,p,h,t.originSourceFilePath,n),(0,_arkguard.endSingleFileEvent)(_arkguard.EventList.OBFUSCATE,_arkguard.performancePrinter.timeSumPrinter)}catch(e){r.error(red,`ArkTS:INTERNAL ERROR: Failed to obfuscate file '${t.relativeSourceFilePath}' with arkguard. `+e)}f.sourceMap&&!o&&(c=d.isNewSourceMaps()?t.rollupModuleId:t.relativeSourceFilePath,f.sourceMap.sources=[t.relativeSourceFilePath],d.fillSourceMapPackageInfo(t.rollupModuleId,f.sourceMap),d.updateSpecifySourceMap(i,c,f.sourceMap)),(0,_ob_config_resolver.setNewNameCache)(f.nameCache,o,t,e),(0,_ob_config_resolver.setUnobfuscationNames)(f.unobfuscationNameMap,t.relativeSourceFilePath,o);s=tryMangleFileName(t.buildFilePath,e,t.originSourceFilePath);s===t.buildFilePath||o||d.saveKeyMappingForObfFileName(t.rollupModuleId),(0,_ob_config_resolver.writeObfuscatedFile)(s,f.content??"")}function tryMangleFileName(e,t,r){r=(0,_utils.toUnixPath)(r);var i=(0,_utils.isPackageModulesFile)(r,t);let a=_utils.harFilesRecord.get(r);return a||(a={sourcePath:r},_utils.harFilesRecord.set(r,a)),t.obfuscationMergedObConfig?.options?.enableFileNameObfuscation&&!i?(r=(0,_ob_config_resolver.mangleFilePath)(e),/\.d\.e?ts$/.test(e)?a.obfuscatedDeclarationCachePath=r:a.obfuscatedSourceCachePath=r,e=r):/\.d\.e?ts$/.test(e)||(a.sourceCachePath=e),e}async function mangleDeclarationFileName(e,t,r){for(var[i,a]of _utils.harFilesRecord){var o;a.originalDeclarationCachePath&&a.originalDeclarationContent&&(o=a.originalDeclarationCachePath,o=(0,_ob_config_resolver.getRelativeSourcePath)(o,t.projectRootPath,r.get((0,_utils.toUnixPath)(o))),await writeObfuscatedSourceCode({content:a.originalDeclarationContent,buildFilePath:a.originalDeclarationCachePath,relativeSourceFilePath:o,originSourceFilePath:i},e,t,{}))}}async function writeMinimizedSourceCode(e,t,r,i=!1){let a;try{var o={compress:{join_vars:!1,sequences:0,directives:!1}};i||(o.format={semicolons:!1,beautify:!0,indent_level:2}),a=await(0,_terser.minify)(e,o)}catch{r.error(red,"ArkTS:INTERNAL ERROR: Failed to obfuscate source code for "+t,reset)}_fs.default.writeFileSync(t,a.code)}function writeDeclarationFiles(e){if(compileToolIsRollUp()&&e===_pre_define.ESMODULE)for(const t of _utils.harFilesRecord.values())t.originalDeclarationCachePath&&t.originalDeclarationContent&&((0,_utils.mkdirsSync)(_path.default.dirname(t.originalDeclarationCachePath)),_fs.default.writeFileSync(t.originalDeclarationCachePath,t.originalDeclarationContent))}function genBuildPath(t,e,r,i){if((t=(t=(0,_utils.toUnixPath)(t)).endsWith(_pre_define.EXTNAME_MJS)?t.replace(/\.mjs$/,_pre_define.EXTNAME_JS):t).endsWith(_pre_define.EXTNAME_CJS)&&(t=t.replace(/\.cjs$/,_pre_define.EXTNAME_JS)),e=(0,_utils.toUnixPath)(e),(0,_utils.isPackageModulesFile)(t,i)){var a,o=i.packageDir,n=(0,_utils.toUnixPath)(_path.default.join(i.projectRootPath,o));let e="";return e=-1===t.indexOf(n)?(a=(0,_utils.toUnixPath)(i.projectRootPath),a=(a=t.replace(a,"")).substring(a.indexOf(o)+o.length+1),_path.default.join(i.nodeModulesPath,_pre_define.ZERO,a)):t.replace(n,_path.default.join(i.nodeModulesPath,_pre_define.ONE))}return-1!==t.indexOf(e)?(o=t.replace(e,""),_path.default.join(r,o)):""}function getPackageInfo(e){var t,r;return packageCollection.has(e)?packageCollection.get(e):(t=(r=JSON.parse(_fs.default.readFileSync(e).toString())).app.bundleName,r=r.module.name,packageCollection.set(e,[t,r]),[t,r])}function generateSourceFilesToTemporary(e,t,r,i,a){let o=(0,_utils.genTemporaryPath)(e,i.projectPath,process.env.cachePath,i,void 0);var n;0!==o.length&&(0<genSourceMapFileName(o=o.endsWith(_pre_define.EXTNAME_ETS)?o.replace(/\.ets$/,_pre_define.EXTNAME_JS):o.replace(/\.ts$/,_pre_define.EXTNAME_JS)).length&&"debug"===i.buildArkMode&&(n=(0,_utils.toUnixPath)(e).replace((0,_utils.toUnixPath)(i.projectRootPath)+"/",""),r.sources=[n],r.file=_path.default.basename(r.file),delete r.sourcesContent,newSourceMaps[n]=r),t=transformModuleSpecifier(e,t,i),(0,_utils.mkdirsSync)(_path.default.dirname(o)),"debug"===i.buildArkMode?_fs.default.writeFileSync(o,t):writeObfuscatedSourceCode({content:t,buildFilePath:o,relativeSourceFilePath:""},a,i))}function genAbcFileName(e){let t=e;return t=e.endsWith(_pre_define.EXTNAME_TS)?e.replace(/\.ts$/,_pre_define.EXTNAME_ABC):e.replace(/\.js$/,_pre_define.EXTNAME_ABC)}function isOhModules(e){return e.packageDir===_ark_define.OH_MODULES}function isEs2Abc(e){return e.pandaMode===_pre_define.ES2ABC||"undefined"===e.pandaMode||void 0===e.pandaMode}function isTs2Abc(e){return e.pandaMode===_pre_define.TS2ABC}function genProtoFileName(e){return e.replace(/\.(?:[tj]s|json)$/,_pre_define.EXTNAME_PROTO_BIN)}function genMergeProtoFileName(e){e=e.split(_pre_define.TEMPORARY),e=e[e.length-1];return _path.default.join(process.env.cachePath,"protos",e)}function removeDuplicateInfo(e){var i=this;const a=Array();return e.forEach(function(t){var r=this,e=(_newArrowCheck(this,i),a.every(function(e){return _newArrowCheck(this,r),t.tempFilePath!==e.tempFilePath}.bind(this)));e&&a.push(t)}.bind(this)),e=a}function buildCachePath(e,t,r){t=void 0!==process.env.cachePath?_path.default.join(t.cachePath,e):_path.default.join(t.aceModuleBuild,e);return(0,_utils.validateFilePathLength)(t,r),t}function getArkBuildDir(e){return(0,_utils.isWindows)()?_path.default.join(e,"build-win"):(0,_utils.isMac)()?_path.default.join(e,"build-mac"):_path.default.join(e,"build")}function getBuildBinDir(e){return _path.default.join(getArkBuildDir(e),"bin")}function cleanUpUtilsObjects(){exports.newSourceMaps=newSourceMaps={},_arkguard.nameCacheMap.clear(),packageCollection.clear()}function getHookEventFactory(e,t,r){if("function"==typeof e.getHookEventFactory)return e.getHookEventFactory(t,r)}function createAndStartEvent(t,r,i=!1){if(void 0!==t){let e;return"function"==typeof(e="function"==typeof t.createSubEvent?t.createSubEvent(r):t.createEvent(r)).startAsyncEvent&&i?e.startAsyncEvent():e.start(),e}}function stopEvent(e,t=!1){void 0!==e&&("function"==typeof e.stopAsyncEvent&&t?e.stopAsyncEvent():e.stop())}function compileToolIsRollUp(){return"rollup"===process.env.compileTool}function transformOhmurlToRecordName(e){return e.split(_ark_define.SEPARATOR_BITWISE_AND).slice(2).join(_ark_define.SEPARATOR_BITWISE_AND)}function transformOhmurlToPkgName(e){var e=e.split(_ark_define.SEPARATOR_BITWISE_AND)[3],t=e.split(_ark_define.SEPARATOR_SLASH);return e.startsWith(_ark_define.SEPARATOR_AT)?t.slice(0,2).join(_ark_define.SEPARATOR_SLASH):t[0]}exports.packageCollection=packageCollection;