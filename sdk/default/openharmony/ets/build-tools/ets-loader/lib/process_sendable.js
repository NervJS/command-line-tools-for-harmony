"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.processSendableClass=processSendableClass,exports.processSendableFunction=processSendableFunction,exports.processSendableType=processSendableType;var _typescript=_interopRequireDefault(require("typescript")),_pre_define=require("./pre_define");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function transformOptionalMemberForSendable(e){var t=this;let r=e.type;return _typescript.default.isUnionTypeNode(r)?r.types.find(function(e){return _newArrowCheck(this,t),e.kind===_typescript.default.SyntaxKind.UndefinedKeyword}.bind(this))||(r=_typescript.default.factory.createUnionTypeNode([...r.types,_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.UndefinedKeyword)])):r=_typescript.default.factory.createUnionTypeNode([r,_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.UndefinedKeyword)]),_typescript.default.factory.createPropertyDeclaration(e.modifiers,e.name,void 0,r,e.initializer||_typescript.default.factory.createIdentifier("undefined"))}function removeSendableDecorator(e){var t=this;return _typescript.default.factory.createNodeArray(e.filter(function(e){return _newArrowCheck(this,t),e.getText().replace(/\(.*\)$/,"").trim()!==_pre_define.COMPONENT_SENDABLE_DECORATOR}.bind(this)))}function updateSendableConstructor(e){var t;return void 0===e.body?e:(t=[_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createStringLiteral("use sendable")),...e.body.statements],_typescript.default.factory.updateConstructorDeclaration(e,e.modifiers,e.parameters,_typescript.default.factory.updateBlock(e.body,t)))}function addConstructorForSendableClass(e,t){var r=[],a=[_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createStringLiteral("use sendable"))],t=(t&&(a.push(_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createSuper(),void 0,[_typescript.default.factory.createSpreadElement(_typescript.default.factory.createIdentifier(_pre_define.SUPER_ARGS))]))),r.push(_typescript.default.factory.createParameterDeclaration(void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.DotDotDotToken),_typescript.default.factory.createIdentifier(_pre_define.SUPER_ARGS),void 0,void 0,void 0))),_typescript.default.factory.createConstructorDeclaration(void 0,r,_typescript.default.factory.createBlock(a,!0)));return _typescript.default.factory.createNodeArray([t,...e||[]])}function processSendableClass(e){var t=this;let r=!1,a=e.members;var o=removeSendableDecorator(e.modifiers),n=e.heritageClauses?.some(function(e){return _newArrowCheck(this,t),e.token===_typescript.default.SyntaxKind.ExtendsKeyword}.bind(this))||!1;for(const i of e.members){if(_typescript.default.isPropertyDeclaration(i)&&i.questionToken){const c=i,s=transformOptionalMemberForSendable(i);a=_typescript.default.factory.createNodeArray(a.map(function(e){return _newArrowCheck(this,t),e===c?s:e}.bind(this)))}if(_typescript.default.isConstructorDeclaration(i)){r=!0;const p=i;a=_typescript.default.factory.createNodeArray(a.map(function(e){return _newArrowCheck(this,t),e===p?updateSendableConstructor(p):e}.bind(this)))}}return r||(a=addConstructorForSendableClass(a,n)),e=_typescript.default.factory.updateClassDeclaration(e,o,e.name,e.typeParameters,e.heritageClauses,a)}function processSendableFunction(e){var t;return e.body?(t=[_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createStringLiteral("use sendable")),...e.body.statements],_typescript.default.factory.updateFunctionDeclaration(e,_typescript.default.getModifiers(e),e.asteriskToken,e.name,e.typeParameters,e.parameters,e.type,_typescript.default.factory.updateBlock(e.body,t))):_typescript.default.factory.createFunctionDeclaration(void 0,e.asteriskToken,e.name,e.typeParameters,e.parameters,e.type,e.body)}function processSendableType(e){return _typescript.default.factory.createTypeAliasDeclaration(void 0,e.name,e.typeParameters,e.type)}