"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShouldEnableDebugLine=void 0,exports.etsTransform=etsTransform,exports.shouldEmitJsFlagById=shouldEmitJsFlagById;var _typescript=_interopRequireDefault(require("typescript")),_path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs")),_pluginutils=require("@rollup/pluginutils"),_magicString=_interopRequireDefault(require("magic-string")),_nodeEvents=_interopRequireDefault(require("node:events")),_module_source_file=require("../ark_compiler/module/module_source_file"),_utils=require("../../utils"),_validate_ui_syntax=require("../../validate_ui_syntax"),_process_ui_syntax=require("../../process_ui_syntax"),_main=require("../../../main"),_ets_checker=require("../../ets_checker"),_component_map=require("../../component_map"),_process_kit_import=require("../../process_kit_import"),_process_component_member=require("../../process_component_member"),_ob_config_resolver=require("../ark_compiler/common/ob_config_resolver"),_process_lazy_import=require("../../process_lazy_import"),_arkoalaPlugin=_interopRequireDefault(require("./arkoala-plugin")),_process_struct_componentV=_interopRequireDefault(require("../../process_struct_componentV2")),_log_message_collection=require("../../log_message_collection"),_utils2=require("../ark_compiler/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}const filter=(0,_pluginutils.createFilter)(/(?<!\.d)\.(ets|ts)$/),shouldEmitJsFlagMap=new Map;let shouldDisableCache=!1;const ShouldEnableDebugLine={enableDebugLine:!1};exports.ShouldEnableDebugLine=ShouldEnableDebugLine;let disableCacheOptions={bundleName:"default",entryModuleName:"default",runtimeOS:"default",resourceTableHash:"default",etsLoaderVersion:"default"};function etsTransform(){const a=new Map;let i;return{name:"etsTransform",transform:transform,moduleParsed(e){this.share.projectConfig.singleFileEmit&&this.share.projectConfig.needCoverageInsert&&(this.share.sourceFile=_module_source_file.ModuleSourceFile.getSourceFileById(e.id))},buildStart(){var e=new _utils.CompilationTimeStatistics(this.share,"etsTransform","buildStart");(0,_utils.startTimeStatisticsLocation)(e?e.etsTransformBuildStartTime:void 0),judgeCacheShouldDisabled.call(this),"moduleJson"===process.env.compileMode&&(i=this.cache.get("transformCacheFiles"),_utils.storedFileInfo.addGlobalCacheInfo(this.cache.get("resourceListCacheInfo"),this.cache.get("resourceToFileCacheInfo"),i),this.cache.get("lastResourcesArr")&&(_utils.storedFileInfo.lastResourcesSet=new Set([...this.cache.get("lastResourcesArr")])),process.env.rawFileResource)&&((0,_utils.resourcesRawfile)(process.env.rawFileResource,_utils.storedFileInfo.resourcesArr),this.share.rawfilechanged=(0,_utils.differenceResourcesRawfile)(_utils.storedFileInfo.lastResourcesSet,_utils.storedFileInfo.resourcesArr)),!!this.cache.get("enableDebugLine")!==_main.projectConfig.enableDebugLine&&(ShouldEnableDebugLine.enableDebugLine=!0),(0,_utils.stopTimeStatisticsLocation)(e?e.etsTransformBuildStartTime:void 0)},load(e){let t;var r=new _utils.CompilationTimeStatistics(this.share,"etsTransform","load");(0,_utils.startTimeStatisticsLocation)(r?r.etsTransformLoadTime:void 0),this.cache.get("fileCacheInfo")&&(t=this.cache.get("fileCacheInfo")[_path.default.resolve(e)]),_main.projectConfig.isPreview&&!_main.projectConfig.checkEntry&&e.match(/(?<!\.d)\.(ets)$/)&&(_main.abilityPagesFullPath.add(_path.default.resolve(e).toLowerCase()),_utils.storedFileInfo.judgeShouldHaveEntryFiles(_main.abilityPagesFullPath)),_utils.storedFileInfo.addFileCacheInfo(_path.default.resolve(e),t),_utils.storedFileInfo.setCurrentArkTsFile(),(0,_utils.stopTimeStatisticsLocation)(r?r.etsTransformLoadTime:void 0)},shouldInvalidCache(e){var t=_path.default.resolve(e.id);let r=shouldDisableCache||disableNonEntryFileCache(t)||ShouldEnableDebugLine.enableDebugLine;if("moduleJson"===process.env.compileMode&&(r=r||_utils.storedFileInfo.shouldInvalidFiles.has(t)||this.share.rawfilechanged,i)&&i[t]&&i[t].children.length)for(var o of i[t].children)if((_fs.default.existsSync(o.fileName)?_fs.default.statSync(o.fileName).mtimeMs:-1)!==o.mtimeMs){r=!0;break}return(r=r||checkRelateToConstEnum(e.id))||_utils.storedFileInfo.collectCachedFiles(t),r},buildEnd(){var e=Array.from(CreateProgramMoment.deleteFileCollect);_main.globalProgram.program.deleteProgramSourceFiles(e),CreateProgramMoment.resetDeleteFiles(),"true"===process.env.watchMode||_main.projectConfig.hotReload||_main.projectConfig.isPreview||(0,_ets_checker.resetEtsCheckTypeScript)()},afterBuildEnd(){var r=this;if(_main.projectConfig.compileHar&&!_main.projectConfig.byteCodeHar){for(var o of _ets_checker.allModuleIds.keys()){var i=this.getModuleInfo(o);if((i||o.match(/\.d\.e?ts$/))&&(o&&!o.match(new RegExp(_main.projectConfig.packageDir))&&!o.startsWith("\0")&&_path.default.resolve(o).startsWith(_main.projectConfig.moduleRootPath+_path.default.sep))){let e=o,t;t=e.match(/\.d\.e?ts$/)?(0,_utils.getBelongModuleInfo)(o,_main.projectConfig.modulePathMap,_main.projectConfig.projectRootPath):i.meta,this.share.arkProjectConfig?.obfuscationMergedObConfig?.options?.enableFileNameObfuscation&&(e=(0,_ob_config_resolver.mangleFilePath)(e));o=(0,_utils.genTemporaryPath)(e,_main.projectConfig.moduleRootPath,process.env.cachePath,_main.projectConfig,t),i=(0,_utils.genTemporaryPath)(e,_main.projectConfig.moduleRootPath,_main.projectConfig.buildPath,_main.projectConfig,t,!0);e.match(/\.e?ts$/)?setIncrementalFileInHar(o,i,a):a.set(o,i)}}a.forEach(function(e,t){_newArrowCheck(this,r),_fs.default.existsSync(t)&&(t=_fs.default.readFileSync(t,"utf-8"),(0,_utils.writeFileSync)(e,t))}.bind(this))}shouldDisableCache=!1,this.cache.set("disableCacheOptions",disableCacheOptions),this.cache.set("lastResourcesArr",[..._utils.storedFileInfo.resourcesArr]),_main.projectConfig.enableDebugLine?this.cache.set("enableDebugLine",!0):this.cache.set("enableDebugLine",!1),_utils.storedFileInfo.clearCollectedInfo(this.cache),this.cache.set("transformCacheFiles",_utils.storedFileInfo.transformCacheFiles)},cleanUp(){(0,_main.resetMain)(),(0,_component_map.resetComponentMap)(),(0,_ets_checker.resetEtsCheck)(),resetEtsTransform(),(0,_process_component_member.resetProcessComponentMember)(),(0,_process_ui_syntax.resetProcessUiSyntax)(),(0,_utils.resetUtils)(),(0,_validate_ui_syntax.resetValidateUiSyntax)(),(0,_ob_config_resolver.resetObfuscation)(),(0,_log_message_collection.resetlogMessageCollection)()}}}function shouldEmitJsFlagById(e){return shouldEmitJsFlagMap.get(e)}function disableNonEntryFileCache(e){return _utils.storedFileInfo.buildStart&&e.match(/(?<!\.d)\.(ets)$/)&&!_utils.storedFileInfo.wholeFileInfo[e].hasEntry&&_utils.storedFileInfo.shouldHaveEntry.includes(e)}function judgeCacheShouldDisabled(){for(const e in disableCacheOptions)this.cache.get("disableCacheOptions")&&this.share&&this.share.projectConfig&&this.share.projectConfig[e]&&this.cache.get("disableCacheOptions")[e]!==this.share.projectConfig[e]&&("resourceTableHash"===e&&"moduleJson"===process.env.compileMode?_utils.storedFileInfo.resourceTableChanged=!0:shouldDisableCache=(!_main.projectConfig.uiTransformOptimization||"bundleName"!==e||"moduleJson"!==process.env.compileMode)&&(shouldDisableCache||!0)),this.share&&this.share.projectConfig&&this.share.projectConfig[e]&&(disableCacheOptions[e]=this.share.projectConfig[e]),_utils.storedFileInfo.judgeShouldHaveEntryFiles(_main.abilityPagesFullPath)}function getCompilerHost(){var t=this,e=_typescript.default.createCompilerHost(_ets_checker.compilerOptions);return e.writeFile=function(){_newArrowCheck(this,t)}.bind(this),e.resolveModuleNames=_ets_checker.resolveModuleNames,e.getCurrentDirectory=function(){return _newArrowCheck(this,t),process.cwd()}.bind(this),e.getDefaultLibFileName=function(e){return _newArrowCheck(this,t),_typescript.default.getDefaultLibFilePath(e)}.bind(this),e.resolveTypeReferenceDirectives=_ets_checker.resolveTypeReferenceDirectives,e}let compilerHost=null;compilerHost=compilerHost||getCompilerHost();const arkoalaTsProgramCache=new WeakMap;function getArkoalaTsProgram(e){let t=arkoalaTsProgramCache.get(e);var r,o;return t||(r={},o={diagnostics:[],addDiagnostic(){return 0},removeDiagnostic(){},ts:_typescript.default,library:"typescript"},t=(0,_arkoalaPlugin.default)(e,compilerHost,r,o),arkoalaTsProgramCache.set(e,t)),t}async function transform(e,t){var r=this,o=new _utils.CompilationTimeStatistics(this.share,"etsTransform","transform");if(!filter(t))return null;_utils.storedFileInfo.collectTransformedFiles(_path.default.resolve(t));var i=this.share.getLogger("etsTransform");if("esmodule"!==_main.projectConfig.compileMode)return(c=_typescript.default.readConfigFile(_path.default.resolve(__dirname,"../../../tsconfig.json"),_typescript.default.sys.readFile).config.compilerOptions).moduleResolution="nodenext",c.module="es2020",m=jsBundlePreProcess(e,t,this.getModuleInfo(t).isEntry,i),m=_typescript.default.transpileModule(m,{compilerOptions:c,fileName:t,transformers:{before:[(0,_process_ui_syntax.processUISyntax)(null)]}}),resetCollection(),_process_ui_syntax.transformLog&&_process_ui_syntax.transformLog.errors.length&&!_main.projectConfig.ignoreWarning&&((0,_utils.emitLogInfo)(i,(0,_utils.getTransformLog)(_process_ui_syntax.transformLog),!0,t),(0,_process_ui_syntax.resetLog)()),{code:m.outputText,map:m.sourceMapText?JSON.parse(m.sourceMapText):new _magicString.default(e).generateMap()};let a=_main.globalProgram.program,s=a.getSourceFile(t);s?(_utils.storedFileInfo.reUseProgram||(_main.globalProgram.checker=_main.globalProgram.program.getTypeChecker(),_main.globalProgram.strictChecker=_main.globalProgram.program.getLinterTypeChecker()),_utils.storedFileInfo.reUseProgram=!0):(await processNoTargetSourceFile(t,e,o),_main.globalProgram.checker=a.getTypeChecker(),_main.globalProgram.strictChecker=a.getLinterTypeChecker(),s=a.getSourceFile(t),(_utils.storedFileInfo.reUseProgram=!1,_ets_checker.collectAllFiles)(a)),setPkgNameForFile(this.getModuleInfo(t)),(0,_utils.startTimeStatisticsLocation)(o?o.validateEtsTime:void 0),validateEts(e,t,this.getModuleInfo(t).isEntry,i,s),(0,_utils.stopTimeStatisticsLocation)(o?o.validateEtsTime:void 0);const n={outputText:"",sourceMapText:""};var l,c=function(e,t){_newArrowCheck(this,r),/.map$/.test(e)?n.sourceMapText=t:n.outputText=t}.bind(this),m=(a.getCompilerOptions().noEmit=!1,this.getModuleInfo(t).meta),u={autoLazyImport:this.share.projectConfig?.autoLazyImport??!1,reExportCheckMode:this.share.projectConfig?.reExportCheckMode??_process_lazy_import.reExportNoCheckMode},_=((0,_utils.startTimeStatisticsLocation)(o?o.shouldEmitJsTime:void 0),getShouldEmitJs(_main.projectConfig.shouldEmitJs,s,t));shouldEmitJsFlagMap.set(t,_),(0,_utils.stopTimeStatisticsLocation)(o?o.shouldEmitJsTime:void 0);let d=null;try{(0,_utils.startTimeStatisticsLocation)(o?o.tsProgramEmitTime:void 0),_main.projectConfig.useArkoala&&(a=getArkoalaTsProgram(a),s=a.getSourceFile(t)),_?((0,_utils.startTimeStatisticsLocation)(o?o.emitTime:void 0),a.emit(s,c,void 0,void 0,{before:[(0,_process_ui_syntax.processUISyntax)(null,!1,o,t),(0,_process_kit_import.processKitImport)(t,m,o,!0,u),(0,_ob_config_resolver.collectReservedNameForObf)(this.share.arkProjectConfig?.obfuscationMergedObConfig,(0,_utils2.shouldETSOrTSFileTransformToJSWithoutRemove)(t,_main.projectConfig,m))]}),(0,_utils.stopTimeStatisticsLocation)(o?o.emitTime:void 0)):((0,_utils.startTimeStatisticsLocation)(o?o.transformNodesTime:void 0),l=_main.globalProgram.checker.getEmitResolver(outFile(a.getCompilerOptions())?void 0:s,void 0),d=_typescript.default.transformNodes(l,a.getEmitHost?.(),_typescript.default.factory,a.getCompilerOptions(),[s],[(0,_process_ui_syntax.processUISyntax)(null,!1,o,t),(0,_process_kit_import.processKitImport)(t,m,o,!1,u),(0,_ob_config_resolver.collectReservedNameForObf)(this.share.arkProjectConfig?.obfuscationMergedObConfig,(0,_utils2.shouldETSOrTSFileTransformToJSWithoutRemove)(t,_main.projectConfig,m))],!1),(0,_utils.stopTimeStatisticsLocation)(o?o.transformNodesTime:void 0)),(0,_utils.stopTimeStatisticsLocation)(o?o.tsProgramEmitTime:void 0)}finally{a.getCompilerOptions().noEmit=!0}return resetCollection(),_process_struct_componentV.default.resetStructMapInEts(),(_process_ui_syntax.transformLog&&_process_ui_syntax.transformLog.errors.length||_process_kit_import.kitTransformLog&&_process_kit_import.kitTransformLog.errors.length)&&!_main.projectConfig.ignoreWarning&&((0,_utils.emitLogInfo)(i,[...(0,_utils.getTransformLog)(_process_kit_import.kitTransformLog),...(0,_utils.getTransformLog)(_process_ui_syntax.transformLog)],!0,t),(0,_process_ui_syntax.resetLog)(),(0,_process_kit_import.resetKitImportLog)()),_?{code:n.outputText,map:n.sourceMapText?JSON.parse(n.sourceMapText):new _magicString.default(e).generateMap(),meta:{shouldEmitJs:!0}}:printSourceFile(d.transformed[0],o)}async function processNoTargetSourceFile(e,t,r){var o,i=this;(0,_utils.startTimeStatisticsLocation)(r?r.noSourceFileRebuildProgramTime:void 0),_utils.storedFileInfo.isFirstBuild&&_utils.storedFileInfo.changeFiles.length&&(_utils.storedFileInfo.newTsProgram=_typescript.default.createProgram(_utils.storedFileInfo.changeFiles,_ets_checker.compilerOptions,compilerHost),_utils.storedFileInfo.isFirstBuild=!1),await CreateProgramMoment.block(e,t),CreateProgramMoment.release(e),_main.globalProgram.program.initProcessingFiles();for(const a of CreateProgramMoment.getRoots(e,t))_main.globalProgram.program.getSourceFile(a.id)||((o=_typescript.default.createSourceFile(a.id,a.code,_ets_checker.compilerOptions.target,!0,void 0,_ets_checker.compilerOptions)).originalFileName=o.fileName,o.resolvePath=a.id,o.path=a.id,_main.globalProgram.program.processImportedModules(o,!0),_main.globalProgram.program.setProgramSourceFiles(o),CreateProgramMoment.deleteFileCollect.add(o.fileName));e=_main.globalProgram.program.getProcessingFiles();e&&e.forEach(function(e){_newArrowCheck(this,i),_main.globalProgram.program.getSourceFiles().includes(e.fileName)||CreateProgramMoment.deleteFileCollect.add(e.fileName),_main.globalProgram.program.setProgramSourceFiles(e)}.bind(this)),_main.globalProgram.program.refreshTypeChecker(),(0,_utils.stopTimeStatisticsLocation)(r?r.noSourceFileRebuildProgramTime:void 0)}function printSourceFile(e,t){return e?((0,_utils.startTimeStatisticsLocation)(t?t.printNodeTime:void 0),e=_typescript.default.createPrinter({newLine:_typescript.default.NewLineKind.LineFeed}).printNode(_typescript.default.EmitHint.Unspecified,e,e),(0,_utils.stopTimeStatisticsLocation)(t?t.printNodeTime:void 0),e):null}function outFile(e){return e.outFile||e.out}function getShouldEmitJs(e,t,r){let o=!0,i=!1;if(_main.projectConfig.processTs){if(_main.projectConfig.complieHar){if(!_main.projectConfig.UseTsHar&&!_main.projectConfig.byteCodeHar)return o}else i=(0,_process_kit_import.checkHasKeepTs)(t);void 0!==e&&(o=e||_typescript.default.hasTsNoCheckOrTsIgnoreFlag(t)&&!i)}return o}function setPkgNameForFile(e){e&&e.meta&&e.meta.pkgName&&(_utils.storedFileInfo.getCurrentArkTsFile().pkgName=e.meta.pkgName)}function validateEts(e,t,r,o,i){/\.ets$/.test(t)&&(clearCollection(),r=r&&!_main.abilityPagesFullPath.has(_path.default.resolve(t).toLowerCase())?"?entry":"",(e=(0,_validate_ui_syntax.validateUISyntax)(e,e,t,r,i)).length)&&!_main.projectConfig.ignoreWarning&&(0,_utils.emitLogInfo)(o,e,!0,t)}function jsBundlePreProcess(e,t,r,o){var i;return/\.ets$/.test(t)?(clearCollection(),i=(0,_validate_ui_syntax.preprocessExtend)(e),i=(0,_validate_ui_syntax.preprocessNewExtend)(i),r=r&&!_main.abilityPagesFullPath.has(_path.default.resolve(t).toLowerCase())?"?entry":"",(r=(0,_validate_ui_syntax.validateUISyntax)(e,i,t,r)).length&&!_main.projectConfig.ignoreWarning&&(0,_utils.emitLogInfo)(o,r,!0,t),i):e}function clearCollection(){_validate_ui_syntax.componentCollection.customComponents.clear(),_component_map.CUSTOM_BUILDER_METHOD.clear(),_component_map.INNER_CUSTOM_LOCALBUILDER_METHOD.clear(),_component_map.GLOBAL_CUSTOM_BUILDER_METHOD.clear(),_component_map.INNER_CUSTOM_BUILDER_METHOD.clear(),_utils.storedFileInfo.getCurrentArkTsFile().compFromDETS.clear(),_utils.storedFileInfo.getCurrentArkTsFile().recycleComponents.clear()}function resetCollection(){_utils.componentInfo.id=0,_validate_ui_syntax.propertyCollection.clear(),_validate_ui_syntax.linkCollection.clear(),_component_map.EXTEND_ATTRIBUTE.clear(),(0,_validate_ui_syntax.resetComponentCollection)(),_utils.storedFileInfo.hasLocalBuilderInFile=!1}function resetEtsTransform(){ShouldEnableDebugLine.enableDebugLine=!1,_main.projectConfig.ignoreWarning=!1,_main.projectConfig.widgetCompile=!1,compilerHost=null,disableCacheOptions={bundleName:"default",entryModuleName:"default",runtimeOS:"default",resourceTableHash:"default",etsLoaderVersion:"default"}}function findArkoalaRoot(){var t=this;let e;if(process.env.ARKOALA_SDK_ROOT){if(!isDir(e=process.env.ARKOALA_SDK_ROOT))throw new Error("Arkoala SDK not found in "+e)}else{var r=_main.globalModulePaths.map(function(e){return _newArrowCheck(this,t),_path.default.join(e,"../../arkoala")}.bind(this));if(!(e=r.find(function(e){return _newArrowCheck(this,t),isDir(e)}.bind(this))??""))throw new Error("Arkoala SDK not found in "+r.join(";"))}return e}function isDir(e){try{return _fs.default.statSync(e).isDirectory()}catch(e){return!1}}function setIncrementalFileInHar(e,t,r){var o;e.match(/\.d.e?ts$/)?r.set(e,t):(o=_main.projectConfig.useTsHar?".ts":".js",r.set(e.replace(/\.ets$/,".d.ets").replace(/\.ts$/,".d.ts"),t.replace(/\.ets$/,".d.ets").replace(/\.ts$/,".d.ts")),r.set(e.replace(/\.e?ts$/,o),t.replace(/\.e?ts$/,o)))}function checkRelateToConstEnum(e){var t=_main.globalProgram.builderProgram,e=t?t.getSourceFile(e):void 0;return!!e&&!!t.isFileUpdateInConstEnumCache&&t.isFileUpdateInConstEnumCache(e)}class CreateProgramMoment{static init(){var e,r=this;CreateProgramMoment.promise||(e=_path.default.resolve(__dirname,"../../../declarations/common.d.ts"),CreateProgramMoment.roots.set(e,_fs.default.readFileSync(e,"utf-8")),CreateProgramMoment.emitter=new _nodeEvents.default.EventEmitter,CreateProgramMoment.promise=new Promise(function(e){var t=this;_newArrowCheck(this,r),CreateProgramMoment.emitter.on("checkPrefCreateProgramId",function(){_newArrowCheck(this,t),CreateProgramMoment.awaitFileCollect.size+CreateProgramMoment.moduleParsedFileCollect.size===CreateProgramMoment.transFileCollect.size&&e()}.bind(this))}.bind(this)))}static getPlugin(){return{name:"createProgramPlugin",load:{order:"pre",handler(e){CreateProgramMoment.transFileCollect.add(e)}},moduleParsed(e){CreateProgramMoment.moduleParsedFileCollect.add(e.id),CreateProgramMoment.emitter?.emit("checkPrefCreateProgramId")},cleanUp(){shouldEmitJsFlagMap.clear(),CreateProgramMoment.reset()}}}static async block(e,t){return CreateProgramMoment.init(),CreateProgramMoment.awaitFileCollect.add(e),CreateProgramMoment.roots.set(e,t),CreateProgramMoment.emitter.emit("checkPrefCreateProgramId"),CreateProgramMoment.promise}static release(e){CreateProgramMoment.awaitFileCollect.delete(e)}static reset(){CreateProgramMoment.transFileCollect.clear(),CreateProgramMoment.awaitFileCollect.clear(),CreateProgramMoment.moduleParsedFileCollect.clear(),CreateProgramMoment.promise=void 0,CreateProgramMoment.emitter=void 0,CreateProgramMoment.roots.clear()}static resetDeleteFiles(){CreateProgramMoment.deleteFileCollect.clear()}static getRoots(e,t){var r=[];for(const[e,t]of CreateProgramMoment.roots)r.push({id:e,code:t});return CreateProgramMoment.promise=void 0,CreateProgramMoment.emitter=void 0,CreateProgramMoment.roots.clear(),0===r.length?[{id:e,code:t}]:r}}_defineProperty(CreateProgramMoment,"transFileCollect",new Set),_defineProperty(CreateProgramMoment,"awaitFileCollect",new Set),_defineProperty(CreateProgramMoment,"deleteFileCollect",new Set),_defineProperty(CreateProgramMoment,"moduleParsedFileCollect",new Set),_defineProperty(CreateProgramMoment,"promise",void 0),_defineProperty(CreateProgramMoment,"emitter",void 0),_defineProperty(CreateProgramMoment,"roots",new Map),exports.createProgramPlugin=CreateProgramMoment.getPlugin;