"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkArkCompilerCacheInfo=checkArkCompilerCacheInfo,exports.shouldInvalidCache=shouldInvalidCache,exports.utCache=void 0;var _fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),_ark_define=require("./common/ark_define"),_pre_define=require("../../pre_define");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let disableCache=!1;function checkArkCompilerCacheInfo(e){disableCache=!1;var a=getMetaInfo(e.share.projectConfig,e.share.arkProjectConfig),r=e.cache.get(_ark_define.ARK_COMPILER_META_INFO);r&&a===r&&!isMockConfigModified(e)||(e.cache.set(_ark_define.IS_CACHE_INVALID,!0),disableCache=!0),e.cache.set(_ark_define.ARK_COMPILER_META_INFO,a)}function getMetaInfo(e,a){var r=[],o=e.compileSdkVersion||"null_compileSdkVersion",i=e.compatibleSdkVersion||"null_compatibleSdkVersion",t=e.compatibleSdkVersionStage||"null_compatibleSdkVersionStage",n=e.runtimeOS||"null_runtimeOS",s=e.etsLoaderPath||"null_sdkPath",l=e.etsLoaderVersion||"null_sdkVersion",c=e.etsLoaderReleaseType||"null_sdkReleaseType";return r.push(o,i,t,n,s,l,c),e.compileHar&&(o=a.useTsHar,r.push(o)),e.compileMode===_ark_define.ESMODULE&&(i=e.bundleName||"null_bundleName",t=e.allModuleNameHash||"null_allModuleNameHash",n=e.aotCompileMode||"null_aotCompileMode",s=e.apPath||"null_apPath",r.push(i,t,n,s)),r.join(":")}function isMockConfigModified(e){var a,r;return!(!e.share.projectConfig.isPreview&&!e.share.projectConfig.isOhosTest||!e.share.projectConfig.mockParams||!e.share.projectConfig.mockParams.mockConfigPath||(a=_path.default.resolve(e.share.projectConfig.cachePath,"./"+_pre_define.USER_DEFINE_MOCK_CONFIG),r=_path.default.resolve(e.share.projectConfig.cachePath,"./"+_pre_define.TRANSFORMED_MOCK_CONFIG),_fs.default.existsSync(a)&&_fs.default.existsSync(r)&&(r=require("json5").parse(_fs.default.readFileSync(e.share.projectConfig.mockParams.mockConfigPath,"utf-8")),e=require("json5").parse(_fs.default.readFileSync(a,"utf-8")),JSON.stringify(r)===JSON.stringify(e))))}function shouldInvalidCache(){return disableCache}const utCache={getMetaInfo:getMetaInfo};exports.utCache=utCache;