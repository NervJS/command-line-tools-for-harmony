"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cleanModuleMode=cleanModuleMode,exports.generateModuleAbc=generateModuleAbc;var _ark_define=require("./common/ark_define"),_module_build_mode=require("./module/module_build_mode"),_module_coldreload_mode=require("./module/module_coldreload_mode"),_module_hotfix_mode=require("./module/module_hotfix_mode"),_module_hotreload_mode=require("./module/module_hotreload_mode"),_module_preview_mode=require("./module/module_preview_mode"),_module_source_file=require("./module/module_source_file"),_ark_utils=require("../../ark_utils"),_generate_sourcemap=require("./generate_sourcemap");let moduleMode=null;async function generateModuleAbc(e){var o=(0,_ark_utils.getHookEventFactory)(this.share,"genAbc","buildEnd");e||this.share.projectConfig.compileMode===_ark_define.ESMODULE&&(this.share.projectConfig.singleFileEmit?_module_source_file.ModuleSourceFile.needProcessMock&&_module_source_file.ModuleSourceFile.generateMockConfigFile(this):await _module_source_file.ModuleSourceFile.processModuleSourceFiles(this,o),this.share.projectConfig.compileHar&&(_generate_sourcemap.SourceMapGenerator.getInstance().buildModuleSourceMapInfo(o),!this.share.projectConfig.byteCodeHar)||generateAbc(this,o))}function generateAbc(e,o){var d,o=(0,_ark_utils.createAndStartEvent)(o,"generate abc");moduleMode="true"!==e.share.projectConfig.watchMode?e.share.arkProjectConfig.coldReload?((d=new _module_coldreload_mode.ModuleColdreloadMode(e)).generateAbc(e,o),d):e.share.arkProjectConfig.hotReload?((d=new _module_hotreload_mode.ModuleHotreloadMode(e)).generateAbc(e,o),d):((d=new _module_build_mode.ModuleBuildMode(e)).generateAbc(e,o),d):e.share.arkProjectConfig.hotReload?((d=new _module_hotreload_mode.ModuleHotreloadMode(e)).generateAbc(e,o),d):e.share.arkProjectConfig.hotFix?((d=new _module_hotfix_mode.ModuleHotfixMode(e)).generateAbc(e,o),d):((d=new _module_preview_mode.ModulePreviewMode(e)).generateAbc(e,o),d),(0,_ark_utils.stopEvent)(o)}function cleanModuleMode(){moduleMode&&(moduleMode.triggerAsync=null,moduleMode.triggerEndSignal=null,moduleMode=null)}