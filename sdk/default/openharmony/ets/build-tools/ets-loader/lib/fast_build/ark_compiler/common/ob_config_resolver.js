"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IDENTIFIER_CACHE=void 0,Object.defineProperty(exports,"MergedConfig",{enumerable:!0,get:function(){return _arkguard.MergedConfig}}),Object.defineProperty(exports,"ObConfigResolver",{enumerable:!0,get:function(){return _arkguard.ObConfigResolver}}),Object.defineProperty(exports,"collectReservedNameForObf",{enumerable:!0,get:function(){return _arkguard.collectReservedNameForObf}}),Object.defineProperty(exports,"collectResevedFileNameInIDEConfig",{enumerable:!0,get:function(){return _arkguard.collectResevedFileNameInIDEConfig}}),Object.defineProperty(exports,"enableObfuscateFileName",{enumerable:!0,get:function(){return _arkguard.enableObfuscateFileName}}),Object.defineProperty(exports,"enableObfuscatedFilePathConfig",{enumerable:!0,get:function(){return _arkguard.enableObfuscatedFilePathConfig}}),Object.defineProperty(exports,"generateConsumerObConfigFile",{enumerable:!0,get:function(){return _arkguard.generateConsumerObConfigFile}}),exports.getNameCacheByPath=getNameCacheByPath,Object.defineProperty(exports,"getRelativeSourcePath",{enumerable:!0,get:function(){return _arkguard.getRelativeSourcePath}}),exports.handleKeepFilesAndGetDependencies=handleKeepFilesAndGetDependencies,Object.defineProperty(exports,"handleObfuscatedFilePath",{enumerable:!0,get:function(){return _arkguard.handleObfuscatedFilePath}}),Object.defineProperty(exports,"handleUniversalPathInObf",{enumerable:!0,get:function(){return _arkguard.handleUniversalPathInObf}}),Object.defineProperty(exports,"mangleFilePath",{enumerable:!0,get:function(){return _arkguard.mangleFilePath}}),Object.defineProperty(exports,"nameCacheMap",{enumerable:!0,get:function(){return _arkguard.nameCacheMap}}),exports.resetObfuscation=resetObfuscation,exports.setNewNameCache=setNewNameCache,exports.setUnobfuscationNames=setUnobfuscationNames,exports.sourceFileDependencies=void 0,exports.writeObfuscatedFile=writeObfuscatedFile,Object.defineProperty(exports,"writeObfuscationNameCache",{enumerable:!0,get:function(){return _arkguard.writeObfuscationNameCache}}),Object.defineProperty(exports,"writeUnobfuscationContent",{enumerable:!0,get:function(){return _arkguard.writeUnobfuscationContent}});var _fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),_arkguard=require("arkguard"),_utils=require("../../../utils"),_ets_checker=require("../../../ets_checker"),_utils2=require("../utils"),_module_source_file=require("../module/module_source_file");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,r){if(e!==r)throw new TypeError("Cannot instantiate an arrow function")}function resetObfuscation(){(0,_arkguard.clearGlobalCaches)(),_module_source_file.sourceFileBelongProject.clear(),_arkguard.ApiExtractor.mPropertySet?.clear(),_arkguard.ApiExtractor.mSystemExportSet?.clear(),_ets_checker.localPackageSet?.clear()}const sourceFileDependencies=new Map,IDENTIFIER_CACHE=(exports.sourceFileDependencies=sourceFileDependencies,"IdentifierCache");function collectAllKeepFiles(e,a){var n=this;const i=new Set,o=[];return e.forEach(function(e){_newArrowCheck(this,n),a.has(e)||(_fs.default.statSync(e).isDirectory()?o.push(e):i.add(e))}.bind(this)),0!==o.length&&_ets_checker.allSourceFilePaths.forEach(function(r){var t=this;_newArrowCheck(this,n),o.some(function(e){return _newArrowCheck(this,t),r.startsWith(e)}.bind(this))&&!a.has(r)&&i.add(r)}.bind(this)),i}function handleKeepFilesAndGetDependencies(e,r,t){var a;return void 0===e||0===e.keepSourceOfPaths.length?(sourceFileDependencies.clear(),new Set):(a=collectAllKeepFiles(e.keepSourceOfPaths,e.excludePathSet),r.setKeepSourceOfPaths(a),r=getFileNamesForScanningWhitelist(e,a,t),sourceFileDependencies.clear(),r)}function getFileNamesForScanningWhitelist(e,t,a){var n=this,i=new Set;if(e.options.enableExportObfuscation){let r=Array.from(t);for(;0<r.length;){var o=(0,_utils.toUnixPath)(r.pop());i.has(o)||(i.add(o),sourceFileDependencies.get(o)?.forEach(function(e){_newArrowCheck(this,n),e&&(e=(0,_utils.toUnixPath)(e.resolvedFileName),(0,_utils2.isCurrentProjectFiles)(e,a))&&r.push(e)}.bind(this)))}}return i}function getNameCacheByPath(e,r,t){var a=new Map;let n=e.relativeSourceFilePath;return r&&(n=(0,_arkguard.getRelativeSourcePath)(e.originSourceFilePath,t,_module_source_file.sourceFileBelongProject.get((0,_utils.toUnixPath)(e.originSourceFilePath)))),_arkguard.nameCacheMap&&(r=_arkguard.nameCacheMap.get(n)?.[IDENTIFIER_CACHE],(0,_arkguard.deleteLineInfoForNameString)(a,r)),a}function setNewNameCache(r,t,a,n){if(r&&!t){let e=a.relativeSourceFilePath;t=(0,_utils.isPackageModulesFile)(a.originSourceFilePath,n);n.obfuscationMergedObConfig?.options.enableFileNameObfuscation&&!t&&(e=(0,_arkguard.mangleFilePath)(a.relativeSourceFilePath)),r.obfName=e,_arkguard.nameCacheMap.set(a.relativeSourceFilePath,r)}}function setUnobfuscationNames(e,r,t){var a=this;if(e&&!t){let t={};e.forEach(function(e,r){_newArrowCheck(this,a);e=Array.from(e);t[r]=e}.bind(this)),_arkguard.unobfuscationNamesObj[r]=t}}function writeObfuscatedFile(e,r){(0,_arkguard.startSingleFileEvent)(_arkguard.EventList.WRITE_FILE,_arkguard.performancePrinter.timeSumPrinter),(0,_utils.mkdirsSync)(_path.default.dirname(e)),_fs.default.writeFileSync(e,r),(0,_arkguard.endSingleFileEvent)(_arkguard.EventList.WRITE_FILE,_arkguard.performancePrinter.timeSumPrinter,!1,!0)}exports.IDENTIFIER_CACHE=IDENTIFIER_CACHE;