"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.watchChangeFiles=watchChangeFiles;var _path=_interopRequireDefault(require("path")),_utils=require("../../utils"),_main=require("../../../main"),_ets_checker=require("../../ets_checker"),_rollupPluginEtsTypescript=require("../ets_ui/rollup-plugin-ets-typescript");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function watchChangeFiles(){function s(e,t){let s=[];(!_main.projectConfig.hotReload&&this.cache&&this.cache.has(e)?s=this.cache.get(e):s).push(t),this.cache.set(e,s)}return{name:"watchChangedFiles",watchChange(e,t){"update"===t.event&&s.call(this,"watchModifiedFiles",e),["create","delete"].includes(t.event)&&s.call(this,"watchRemovedFiles",e),_path.default.resolve(e)===_path.default.resolve(process.env.appResource)&&"moduleJson"===process.env.compileMode&&(_utils.storedFileInfo.resourceTableChanged=!0,_utils.storedFileInfo.resourceList.clear(),_main.resources.app={},(0,_main.readAppResource)(process.env.appResource),process.env.rawFileResource)&&((0,_utils.resourcesRawfile)(process.env.rawFileResource,_utils.storedFileInfo.resourcesArr),this.share.rawfilechanged=(0,_utils.differenceResourcesRawfile)(_utils.storedFileInfo.lastResourcesSet,_utils.storedFileInfo.resourcesArr)),_rollupPluginEtsTypescript.ShouldEnableDebugLine.enableDebugLine=!1},beforeBuild(){this.cache.set("watchChangedFilesCache","watchChangedFiles");var e=this.cache.get("watchModifiedFiles")||[],t=this.cache.get("watchRemovedFiles")||[];!_main.projectConfig.removeChangedFileListInSdk&&(0,_utils.shouldWriteChangedList)(e,t)&&(0,_utils.writeFileSync)(_main.projectConfig.changedFileList,JSON.stringify((0,_utils.getHotReloadFiles)(e,t,_ets_checker.hotReloadSupportFiles))),(0,_ets_checker.incrementWatchFile)(e,t),this.cache.get("lastWatchResourcesArr")&&(_utils.storedFileInfo.lastResourcesSet=new Set([...this.cache.get("lastWatchResourcesArr")]))}}}