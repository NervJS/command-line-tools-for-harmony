"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.builderParamObjectCollection=exports.builderParamInitialization=exports.IComponentSet=exports.ComponentCollection=void 0,exports.checkAllNode=checkAllNode,exports.classMethodCollection=void 0,exports.collectImportNames=collectImportNames,exports.enumCollection=exports.dollarCollection=exports.consumeCollection=exports.componentCollection=void 0,exports.getComponentSet=getComponentSet,exports.getLocalStorageCollection=getLocalStorageCollection,exports.getObservedPropertyCollection=getObservedPropertyCollection,exports.isCustomDialogClass=isCustomDialogClass,exports.isObservedClass=isObservedClass,exports.isSendableClassDeclaration=isSendableClassDeclaration,exports.originalImportNamesMap=exports.observedClassCollection=exports.objectLinkCollection=exports.localStoragePropCollection=exports.localStorageLinkCollection=exports.linkCollection=exports.isStaticViewCollection=void 0,exports.preprocessExtend=preprocessExtend,exports.preprocessNewExtend=preprocessNewExtend,exports.privateCollection=void 0,exports.processSystemApi=processSystemApi,exports.regularInitialization=exports.regularCollection=exports.provideInitialization=exports.provideCollection=exports.propertyCollection=exports.propInitialization=exports.propCollection=void 0,exports.resetComponentCollection=resetComponentCollection,exports.resetValidateUiSyntax=resetValidateUiSyntax,exports.sourceReplace=sourceReplace,exports.useOSFiles=exports.storagePropCollection=exports.storageLinkCollection=exports.stateInitialization=exports.stateCollection=exports.sourcemapNamesCollection=void 0,exports.validateUISyntax=validateUISyntax;var _typescript=_interopRequireDefault(require("typescript")),_path=_interopRequireDefault(require("path")),_pre_define=require("./pre_define"),_component_map=require("./component_map"),_utils=require("./utils"),_main=require("../main"),_process_ui_syntax=require("./process_ui_syntax"),_process_component_class=require("./process_component_class"),_process_component_member=require("./process_component_member"),_check_shared_module=require("./fast_build/ark_compiler/check_shared_module"),_constant_define=_interopRequireDefault(require("./constant_define")),_process_struct_componentV=_interopRequireDefault(require("./process_struct_componentV2")),_log_message_collection=require("./log_message_collection");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}class ComponentCollection{constructor(){_defineProperty(this,"localStorageName",null),_defineProperty(this,"localStorageNode",null),_defineProperty(this,"localSharedStorage",null),_defineProperty(this,"entryComponentPos",null),_defineProperty(this,"entryComponent",null),_defineProperty(this,"previewComponent",[]),_defineProperty(this,"customDialogs",new Set([])),_defineProperty(this,"customComponents",new Set([])),_defineProperty(this,"currentClassName",null)}}exports.ComponentCollection=ComponentCollection;class IComponentSet{constructor(){_defineProperty(this,"properties",new Set),_defineProperty(this,"regulars",new Set),_defineProperty(this,"states",new Set),_defineProperty(this,"links",new Set),_defineProperty(this,"props",new Set),_defineProperty(this,"storageProps",new Set),_defineProperty(this,"storageLinks",new Set),_defineProperty(this,"provides",new Set),_defineProperty(this,"consumes",new Set),_defineProperty(this,"objectLinks",new Set),_defineProperty(this,"localStorageLink",new Map),_defineProperty(this,"localStorageProp",new Map),_defineProperty(this,"builderParams",new Set),_defineProperty(this,"builderParamData",new Set),_defineProperty(this,"propData",new Set),_defineProperty(this,"regularInit",new Set),_defineProperty(this,"stateInit",new Set),_defineProperty(this,"provideInit",new Set),_defineProperty(this,"privateCollection",new Set)}}exports.IComponentSet=IComponentSet;let componentCollection=new ComponentCollection;exports.componentCollection=componentCollection;const observedClassCollection=new Set,enumCollection=(exports.observedClassCollection=observedClassCollection,new Set),classMethodCollection=(exports.enumCollection=enumCollection,new Map),dollarCollection=(exports.classMethodCollection=classMethodCollection,new Set),propertyCollection=(exports.dollarCollection=dollarCollection,new Map),stateCollection=(exports.propertyCollection=propertyCollection,new Map),linkCollection=(exports.stateCollection=stateCollection,new Map),propCollection=(exports.linkCollection=linkCollection,new Map),regularCollection=(exports.propCollection=propCollection,new Map),storagePropCollection=(exports.regularCollection=regularCollection,new Map),storageLinkCollection=(exports.storagePropCollection=storagePropCollection,new Map),provideCollection=(exports.storageLinkCollection=storageLinkCollection,new Map),consumeCollection=(exports.provideCollection=provideCollection,new Map),objectLinkCollection=(exports.consumeCollection=consumeCollection,new Map),builderParamObjectCollection=(exports.objectLinkCollection=objectLinkCollection,new Map),localStorageLinkCollection=(exports.builderParamObjectCollection=builderParamObjectCollection,new Map),localStoragePropCollection=(exports.localStorageLinkCollection=localStorageLinkCollection,new Map),builderParamInitialization=(exports.localStoragePropCollection=localStoragePropCollection,new Map),propInitialization=(exports.builderParamInitialization=builderParamInitialization,new Map),regularInitialization=(exports.propInitialization=propInitialization,new Map),stateInitialization=(exports.regularInitialization=regularInitialization,new Map),provideInitialization=(exports.stateInitialization=stateInitialization,new Map),privateCollection=(exports.provideInitialization=provideInitialization,new Map),isStaticViewCollection=(exports.privateCollection=privateCollection,new Map),useOSFiles=(exports.isStaticViewCollection=isStaticViewCollection,new Set),sourcemapNamesCollection=(exports.useOSFiles=useOSFiles,new Map),originalImportNamesMap=(exports.sourcemapNamesCollection=sourcemapNamesCollection,new Map);function validateUISyntax(e,t,o,r,n=null){var i,s=this;let a=[];return"moduleJson"!==process.env.compileMode&&_path.default.resolve(o)===_path.default.resolve(_main.projectConfig.projectPath||"","app.ets")||(exports.componentCollection=componentCollection=new ComponentCollection,(i=checkComponentDecorator(e,o,r,n))&&(a=a.concat(i)),checkUISyntax(o,new Set([..._component_map.INNER_COMPONENT_NAMES,...componentCollection.customComponents]),t,a,n,r),componentCollection.customComponents.forEach(function(e){return _newArrowCheck(this,s),_utils.componentInfo.componentNames.add(e)}.bind(this))),_main.projectConfig.compileMode===_pre_define.ESMODULE&&(0,_check_shared_module.collectSharedModule)(e,o,n),a}function checkComponentDecorator(e,t,o,n){var i=this;const s=[];if((n=n||_typescript.default.createSourceFile(t,e,_typescript.default.ScriptTarget.Latest,!0,_typescript.default.ScriptKind.ETS))&&n.statements&&n.statements.length){const a={entryCount:0,previewCount:0};n.statements.forEach(function(t,e,o){if(_newArrowCheck(this,i),isObservedClass(t)&&observedClassCollection.add(t.name.getText()),_typescript.default.isEnumDeclaration(t)&&t.name&&enumCollection.add(t.name.getText()),_typescript.default.isStructDeclaration(t)&&validateStructSpec(t,a,s,n),_typescript.default.isMissingDeclaration(t)){var r=_typescript.default.getAllDecorators(t);for(let e=0;e<r.length;e++)if(r[e]&&/struct/.test(r[e].getText())){(0,_utils.addLog)(_utils.LogType.ERROR,"Please use a valid decorator.",t.getStart(),s,n);break}}}.bind(this)),"rollup"===process.env.compileTool&&(0<a.entryCount?_utils.storedFileInfo.wholeFileInfo[t].hasEntry=!0:_utils.storedFileInfo.wholeFileInfo[t].hasEntry=!1),validateEntryAndPreviewCount(a,o,n.fileName,_main.projectConfig.isPreview,!!_main.projectConfig.checkEntry,s)}return s.length?s:null}function validateStructSpec(e,t,o,r){var n,i;e.name&&_typescript.default.isIdentifier(e.name)?(n=e.name.getText(),componentCollection.customComponents.add(n),(i=_typescript.default.getAllDecorators(e))&&i.length?checkDecorators(i,t,e.name,o,r,e):(0,_utils.addLog)(_utils.LogType.ERROR,`Decorator '@Component', '@ComponentV2', or '@CustomDialog' is missing for struct '${n}'.`,e.getStart(),o,r)):(0,_utils.addLog)(_utils.LogType.ERROR,"A struct must have a name.",e.getStart(),o,r)}function validateEntryAndPreviewCount(e,t,o,r,n,i){10<e.previewCount&&("?entry"===t||"true"===process.env.watchMode)&&i.push({type:_utils.LogType.ERROR,message:"A page can contain at most 10 '@Preview' decorators.",fileName:o}),1<e.entryCount&&"?entry"===t&&i.push({type:_utils.LogType.ERROR,message:"A page can't contain more than one '@Entry' decorator",fileName:o}),r&&!n&&e.previewCount<1&&1!==e.entryCount&&"?entry"===t?i.push({type:_utils.LogType.ERROR,message:"A page which is being previewed must have one and only one '@Entry' decorator, or at least one '@Preview' decorator.",fileName:o}):r&&!n||1===e.entryCount||"?entry"!==t||_main.abilityPagesFullPath.has(_path.default.resolve(o).toLowerCase())||i.push({type:_utils.LogType.ERROR,message:`A page configured in '${_main.projectConfig.pagesJsonFileName} or build-profile.json5' must have one and only one '@Entry' decorator.`+"Solutions:>Please make sure that the splash page has one and only one '@Entry' decorator.",fileName:o})}function isObservedClass(e){return!(!_typescript.default.isClassDeclaration(e)||!(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_OBSERVED_DECORATOR))}function isCustomDialogClass(e){return!(!_typescript.default.isStructDeclaration(e)||!(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_DECORATOR_CUSTOM_DIALOG))}function checkDecorators(e,o,t,r,n,i){var s=this;const a=t.getText(),l=_process_struct_componentV.default.getOrCreateStructInfo(a);let c=!1;e.forEach(function(e){_newArrowCheck(this,s);let t=e.getText().replace(/\([^\(\)]*\)/,"").trim();if(e.expression&&e.expression.expression&&_typescript.default.isIdentifier(e.expression.expression)&&(t="@"+e.expression.expression.getText()),_pre_define.INNER_COMPONENT_DECORATORS.has(t))switch(c=!0,t){case _pre_define.COMPONENT_DECORATOR_ENTRY:checkEntryComponent(i,r,n),o.entryCount++,componentCollection.entryComponent=a,componentCollection.entryComponentPos=i.getStart(),collectLocalStorageName(e);break;case _pre_define.COMPONENT_DECORATOR_PREVIEW:o.previewCount++,componentCollection.previewComponent.push(a);break;case _pre_define.COMPONENT_DECORATOR_COMPONENT_V2:l.isComponentV2=!0;break;case _pre_define.COMPONENT_DECORATOR_COMPONENT:l.isComponentV1=!0;break;case _pre_define.COMPONENT_DECORATOR_CUSTOM_DIALOG:componentCollection.customDialogs.add(a),l.isCustomDialog=!0;break;case _pre_define.COMPONENT_DECORATOR_REUSEABLE:_utils.storedFileInfo.getCurrentArkTsFile().recycleComponents.add(a),l.isReusable=!0}else validateInvalidStructDecorator(e,a,r,n)}.bind(this)),validateStruct(c,a,t,r,n,l)}function validateInvalidStructDecorator(e,t,o,r){e=(e.expression||e).pos;(0,_utils.addLog)(_utils.LogType.WARN,`The struct '${t}' use invalid decorator.`,e,o,r)}function validateStruct(e,t,o,r,n,i){e?i.isComponentV2&&(i.isComponentV1||i.isReusable||i.isCustomDialog)&&(0,_utils.addLog)(_utils.LogType.ERROR,`The struct '${t}' can not be decorated with '@ComponentV2' `+"and '@Component', '@Reusable', '@CustomDialog' at the same time.",o.pos,r,n):(0,_utils.addLog)(_utils.LogType.ERROR,`Decorator '@Component', '@ComponentV2', or '@CustomDialog' is missing for struct '${t}'.`,o.pos,r,n),_component_map.BUILDIN_STYLE_NAMES.has(t)&&!_component_map.COMPONENT_SYSTEMAPI_NAMES.has(t)&&(0,_utils.addLog)(_utils.LogType.ERROR,`The struct '${t}' cannot have the same name `+`as the built-in attribute '${t}'.`,o.pos,r,n),_component_map.INNER_COMPONENT_NAMES.has(t)&&(0,_utils.addLog)(_utils.LogType.ERROR,`The struct '${t}' cannot have the same name `+`as the built-in component '${t}'.`,o.pos,r,n)}function checkConcurrentDecorator(t,o,r){var n=this,i=_typescript.default.getAllDecorators(t);if(_main.projectConfig.compileMode===_pre_define.JSBUNDLE&&(0,_utils.addLog)(_utils.LogType.ERROR,"@Concurrent can only be used in ESMODULE compile mode.",i[0].pos,o,r),_typescript.default.isMethodDeclaration(t)&&(0,_utils.addLog)(_utils.LogType.ERROR,"@Concurrent can not be used on method. please use it on function declaration.",i[0].pos,o,r),t.asteriskToken){let e=!1;var t=_typescript.default.canHaveModifiers(t)?_typescript.default.getModifiers(t):void 0,s=function(e){return _newArrowCheck(this,n),e.kind===_typescript.default.SyntaxKind.AsyncKeyword}.bind(this),t=(e=t?t.some(s):e)?"Async generator":"Generator";(0,_utils.addLog)(_utils.LogType.ERROR,`@Concurrent can not be used on ${t} function declaration.`,i[0].pos,o,r)}}function collectLocalStorageName(e){var o=this;e&&e.expression&&_typescript.default.isCallExpression(e.expression)?e.expression.arguments&&e.expression.arguments.length&&e.expression.arguments.forEach(function(e,t){_newArrowCheck(this,o),_typescript.default.isIdentifier(e)&&0===t?(componentCollection.localStorageName=e.getText(),componentCollection.localStorageNode=e):_typescript.default.isObjectLiteralExpression(e)&&0===t?(componentCollection.localStorageName=null,componentCollection.localStorageNode=e):componentCollection.localSharedStorage=e}.bind(this)):(componentCollection.localStorageName=null,componentCollection.localStorageNode=null)}function checkUISyntax(e,t,o,r,n,i){visitAllNode(n=n||_typescript.default.createSourceFile(e,o,_typescript.default.ScriptTarget.Latest,!0,_typescript.default.ScriptKind.ETS),n,t,r,!1,!1,!1,!1,i,!1,!1)}function visitAllNode(e,t,o,r,n,i,s,a,l,c,p){var d,u=this;_typescript.default.isStructDeclaration(e)&&e.name&&_typescript.default.isIdentifier(e.name)&&(n=!0,d=e.name.escapedText.toString(),(d=_process_struct_componentV.default.getOrCreateStructInfo(d)).isComponentV2?(_process_struct_componentV.default.parseComponentProperty(e,d,r,t),a=!0):collectComponentProps(e,d)),_typescript.default.isClassDeclaration(e)&&e.name&&_typescript.default.isIdentifier(e.name)&&(i=!0,[c,s,p]=parseClassDecorator(e,t,r)),(_typescript.default.isMethodDeclaration(e)||_typescript.default.isFunctionDeclaration(e))&&(methodDecoratorCollect(e),(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_CONCURRENT_DECORATOR)&&checkConcurrentDecorator(e,r,t),validateFunction(e,t,r)),checkDecoratorCount(e,t,r),checkDecorator(t,e,r,n,i,s,a,c,p),_typescript.default.forEachChild(e,function(e){return _newArrowCheck(this,u),visitAllNode(e,t,o,r,n,i,s,a,l,c,p)}.bind(this)),p=c=s=i=n=!1}exports.originalImportNamesMap=originalImportNamesMap;const v1ComponentDecorators=["State","Prop","Link","Provide","Consume","StorageLink","StorageProp","LocalStorageLink","LocalStorageProp"],v2ComponentDecorators=["Local","Param","Event","Provider","Consumer"];function validatePropertyInStruct(t,o,r,n,i){if(t){var t=v1ComponentDecorators.includes(r),s=v2ComponentDecorators.includes(r);if(t||s){var a=new ClassDecoratorResult,l=getPropertyNodeByDecorator(o);l&&l.type&&_main.globalProgram.checker&&validatePropertyType(l.type,a);let e;t&&a.hasObservedV2?(e=`The type of the @${r} property can not be a class decorated with @ObservedV2.`,(0,_utils.addLog)(_utils.LogType.ERROR,e,o.getStart(),i,n)):s&&a.hasObserved&&(e=`The type of the @${r} property can not be a class decorated with @Observed.`,(0,_utils.addLog)(_utils.LogType.ERROR,e,o.getStart(),i,n))}}}function getPropertyNodeByDecorator(e){return _typescript.default.isDecorator(e.parent)&&_typescript.default.isPropertyDeclaration(e.parent.parent)?e.parent.parent:_typescript.default.isCallExpression(e.parent)&&_typescript.default.isDecorator(e.parent.parent)&&_typescript.default.isPropertyDeclaration(e.parent.parent.parent)?e.parent.parent.parent:void 0}function validatePropertyType(e,t){var o=this;_typescript.default.isUnionTypeNode(e)&&e.types&&e.types.length&&e.types.forEach(function(e){_newArrowCheck(this,o),validatePropertyType(e,t)}.bind(this)),_typescript.default.isTypeReferenceNode(e)&&e.typeName&&parsePropertyType(_main.globalProgram.checker.getTypeAtLocation(e.typeName),t)}function parsePropertyType(e,t){var o=this;e&&e.types&&e.types.length&&e.types.forEach(function(e){_newArrowCheck(this,o),parsePropertyType(e,t)}.bind(this)),e&&e.symbol&&e.symbol.valueDeclaration&&_typescript.default.isClassDeclaration(e.symbol.valueDeclaration)&&((e=getClassDecoratorResult(e.symbol.valueDeclaration)).hasObserved&&(t.hasObserved=e.hasObserved),e.hasObservedV2)&&(t.hasObservedV2=e.hasObservedV2)}function checkDecoratorCount(e,t,r){var n=this;if(_typescript.default.isPropertyDeclaration(e)||_typescript.default.isGetAccessor(e)||_typescript.default.isMethodDeclaration(e)){const c=_typescript.default.getAllDecorators(e);const p=["@Require","@Once"],d=["@Builder","@Styles"],u=new Map,_=new Map;let o=0;c.forEach(function(e){_newArrowCheck(this,n);var t,e=e.getText().replace(/\([^\(\)]*\)/,"");p.includes(e)||!_constant_define.default.DECORATOR_V2.includes(e)&&"@BuilderParam"!==e?d.includes(e)?(t=u.get(e)||0,u.set(e,t+1)):e===_pre_define.COMPONENT_LOCAL_BUILDER_DECORATOR&&1<c.length&&(o+=1):(t=_.get(e)||0,_.set(e,t+1))}.bind(this));var i=Array.from(_.keys()),s=Array.from(_.values()),a=Array.from(u.keys()),l=Array.from(u.values()),i=i.length+a.length,a=((0,_log_message_collection.getMessageCollection)().checkLocalBuilderDecoratorCount(e,t,o,r),1<i&&(0,_utils.addLog)(_utils.LogType.ERROR,"The member property or method can not be decorated by multiple built-in decorators.",e.getStart(),r,t),s.length&&s.some(function(e){return _newArrowCheck(this,n),1<e}.bind(this))),i=l.length&&l.some(function(e){return _newArrowCheck(this,n),1<e}.bind(this));(a||i)&&(0,_utils.addLog)(i?_utils.LogType.WARN:_utils.LogType.ERROR,"Duplicate decorators for method are not allowed.",e.getStart(),r,t)}}function methodDecoratorCollect(e){var t={decoratorName:"",componentName:""},o={isBuilder:!1,isLocalBuilder:!1};(0,_process_component_class.isBuilderOrLocalBuilder)(e,o)?o.isBuilder?(_component_map.CUSTOM_BUILDER_METHOD.add(e.name.getText()),(_typescript.default.isFunctionDeclaration(e)?_component_map.GLOBAL_CUSTOM_BUILDER_METHOD:_component_map.INNER_CUSTOM_BUILDER_METHOD).add(e.name.getText())):o.isLocalBuilder&&_component_map.INNER_CUSTOM_LOCALBUILDER_METHOD.add(e.name.getText()):_typescript.default.isFunctionDeclaration(e)&&(0,_process_ui_syntax.isExtendFunction)(e,t)?(t.decoratorName===_pre_define.CHECK_COMPONENT_EXTEND_DECORATOR&&(0,_process_ui_syntax.collectExtend)(_component_map.EXTEND_ATTRIBUTE,t.componentName,e.name.getText()),t.decoratorName===_pre_define.CHECK_COMPONENT_ANIMATABLE_EXTEND_DECORATOR&&(0,_process_ui_syntax.collectExtend)(_utils.storedFileInfo.getCurrentArkTsFile().animatableExtendAttribute,t.componentName,e.name.getText())):(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_STYLES_DECORATOR)&&collectStyles(e)}function collectStyles(e){_typescript.default.isBlock(e.body)&&e.body.statements&&((_typescript.default.isFunctionDeclaration(e)?_component_map.GLOBAL_STYLE_FUNCTION:_component_map.INNER_STYLE_FUNCTION).set(e.name.getText(),e.body),_component_map.STYLES_ATTRIBUTE.add(e.name.getText()),_component_map.BUILDIN_STYLE_NAMES.add(e.name.getText()))}function validateFunction(e,t,o){var r=this;if(_typescript.default.isFunctionDeclaration(e)){var n=_typescript.default.getAllDecorators(e);const i=new Map;n.forEach(function(e){_newArrowCheck(this,r);var e=e.getText().replace(/\([^\(\)]*\)/,"").replace(/^@/,"").trim(),t=i.get(e)||0;i.set(e,t+1)}.bind(this));n=Array.from(i.values()),n=(n.length&&n.some(function(e){return _newArrowCheck(this,r),1<e}.bind(this))&&(0,_utils.addLog)(_utils.LogType.WARN,"Duplicate decorators for function are not allowed.",e.getStart(),o,t),Array.from(i.keys()));(1<n.length||n.includes("LocalBuilder"))&&(0,_utils.addLog)(_utils.LogType.ERROR,"A function can only be decorated by one of the 'AnimatableExtend, Builder, Extend, Styles, Concurrent and Sendable'.",e.getStart(),o,t)}}function checkDecorator(e,t,o,r,n,i,s,a,l){var c;_typescript.default.isIdentifier(t)&&(_typescript.default.isDecorator(t.parent)||_typescript.default.isCallExpression(t.parent)&&_typescript.default.isDecorator(t.parent.parent))?(setLocalBuilderInFile(c=t.escapedText.toString()),validateStructDecorator(e,t,o,r,c,s),validateMethodDecorator(e,t,o,r,c),validateClassDecorator(e,t,o,n,c,i,a,l),validatePropertyInStruct(r,t,c,e,o)):_typescript.default.isDecorator(t)&&validateSingleDecorator(t,e,o,s)}function setLocalBuilderInFile(e){"LocalBuilder"===e&&(_utils.storedFileInfo.hasLocalBuilderInFile=!0)}function validateSingleDecorator(e,t,o,r){var n=e.getText().replace(/\([^\(\)]*\)/,"");n===_constant_define.default.COMPUTED_DECORATOR&&e.parent&&!_typescript.default.isGetAccessor(e.parent)?(0,_utils.addLog)(_utils.LogType.ERROR,"@Computed can only decorate 'GetAccessor'.",e.getStart(),o,t):[_constant_define.default.MONITOR_DECORATOR,_pre_define.COMPONENT_LOCAL_BUILDER_DECORATOR].includes(n)&&e.parent&&!_typescript.default.isMethodDeclaration(e.parent)?(0,_utils.addLog)(_utils.LogType.ERROR,`'${n}' can only decorate method.`,e.getStart(),o,t):isMemberForComponentV2(n,r)&&e.parent&&!_typescript.default.isPropertyDeclaration(e.parent)&&(0,_utils.addLog)(_utils.LogType.ERROR,`'${n}' can only decorate member property.`,e.getStart(),o,t)}function isMemberForComponentV2(e,t){return _constant_define.default.COMPONENT_MEMBER_DECORATOR_V2.includes(e)||t&&"@BuilderParam"===e}const classDecorators=[_pre_define.CLASS_TRACK_DECORATOR,_pre_define.CLASS_MIN_TRACK_DECORATOR,_pre_define.MIN_OBSERVED],classMemberDecorators=[_pre_define.CLASS_TRACK_DECORATOR,_pre_define.CLASS_MIN_TRACK_DECORATOR,_pre_define.TYPE,_constant_define.default.MONITOR,_constant_define.default.COMPUTED];function validTypeCallback(e){let t=!0;return _main.globalProgram.checker&&"rollup"===process.env.compileTool&&(e=getSymbolIfAliased(e)?.valueDeclaration?.getSourceFile()?.fileName,t=/@ohos.arkui.*/.test(e)),t}function isTypeFromSdkCallback(e,t,o){return!(e||t!==_pre_define.TYPE||!o)}function validateClassDecorator(e,t,o,r,n,i,s,a){var l=validTypeCallback(t);r||!classDecorators.includes(n)&&!isTypeFromSdkCallback(r,n,l)?r&&classMemberDecorators.includes(n)&&validateMemberInClass(i,n,t,o,e,s,a,l):(0,_utils.addLog)(_utils.LogType.ERROR,`The '@${n}' decorator can only be used in 'class'.`,t.pos,o,e)}function validateMemberInClass(e,t,o,r,n,i,s,a){t===_pre_define.CLASS_TRACK_DECORATOR?e&&(0,_utils.addLog)(_utils.LogType.ERROR,`The '@${t}' decorator can not be used in a 'class' decorated with ObservedV2.`,o.pos,r,n):t===_pre_define.TYPE?a&&validType(n,o,r,t,i,s):e&&isPropertyForTrace(o,t)||(a=t===_pre_define.CLASS_MIN_TRACK_DECORATOR?"variables":"method",(0,_utils.addLog)(_utils.LogType.ERROR,`The '@${t}' can decorate only member ${a} within a 'class' decorated with ObservedV2.`,o.pos,r,n))}function validType(e,t,o,r,n,i){i&&(0,_utils.addLog)(_utils.LogType.ERROR,`The '@${r}' decorator can not be used in a 'class' decorated with Sendable.`,t.pos,o,e),n&&(0,_utils.addLog)(_utils.LogType.ERROR,`The '@${r}' decorator can not be used in a 'class' decorated with Observed.`,t.pos,o,e),_typescript.default.isDecorator(t.parent?.parent)&&!_typescript.default.isPropertyDeclaration(t.parent?.parent?.parent)&&(0,_utils.addLog)(_utils.LogType.ERROR,`The '@${r}' can decorate only member variables in a 'class'.`,t.pos,o,e)}function isPropertyForTrace(e,t){return!(t===_pre_define.CLASS_MIN_TRACK_DECORATOR&&_typescript.default.isDecorator(e.parent)&&!_typescript.default.isPropertyDeclaration(e.parent.parent))}class ClassDecoratorResult{constructor(){_defineProperty(this,"hasObserved",!1),_defineProperty(this,"hasObservedV2",!1),_defineProperty(this,"hasSendable",!1)}}function parseClassDecorator(e,t,o){var r=getClassDecoratorResult(e);return validateMutilObserved(e,r,t,o),(r.hasObserved||r.hasObservedV2)&&parseInheritClass(e,r,t,o),[r.hasObserved,r.hasObservedV2,r.hasSendable]}function getClassDecoratorResult(e){var t=this;const o=new ClassDecoratorResult;return _typescript.default.getAllDecorators(e).forEach(function(e){if(_newArrowCheck(this,t),_typescript.default.isIdentifier(e.expression))switch(e.expression.escapedText.toString()){case _pre_define.MIN_OBSERVED:o.hasObservedV2=!0;break;case _pre_define.OBSERVED:o.hasObserved=!0;break;case _pre_define.SENDABLE:o.hasSendable=!0}}.bind(this)),o}function validateMutilObserved(e,t,o,r){t.hasObserved&&t.hasObservedV2&&(0,_utils.addLog)(_utils.LogType.ERROR,"A class can not be decorated by '@Observed' and '@ObservedV2' at the same time.",e.getStart(),r,o)}function parseInheritClass(e,t,o,r){if(_main.globalProgram.checker&&"rollup"===process.env.compileTool&&e.heritageClauses)for(const n of e.heritageClauses)n.token===_typescript.default.SyntaxKind.ExtendsKeyword&&n.types&&n.types.length&&getClassNode(n.types[0].expression,t,e,o,r)}function getClassNode(e,t,o,r,n){e=e&&getSymbolIfAliased(e);e&&e.valueDeclaration&&(_typescript.default.isClassDeclaration(e.valueDeclaration)?validateInheritClassDecorator(e.valueDeclaration,t,o,r,n):_typescript.default.isPropertyAssignment(e.valueDeclaration)?getClassNode(e.valueDeclaration.initializer,t,o,r,n):_typescript.default.isShorthandPropertyAssignment(e.valueDeclaration)&&parseShorthandPropertyForClass(e.valueDeclaration,t,o,r,n))}function parseShorthandPropertyForClass(e,t,o,r,n){e=_main.globalProgram.checker.getShorthandAssignmentValueSymbol(e);e&&e.valueDeclaration&&_typescript.default.isClassDeclaration(e.valueDeclaration)&&validateInheritClassDecorator(e.valueDeclaration,t,o,r,n)}function getSymbolIfAliased(e){e=_main.globalProgram.checker.getSymbolAtLocation(e);return e&&0!=(e.getFlags()&_typescript.default.SymbolFlags.Alias)?_main.globalProgram.checker.getAliasedSymbol(e):e}function validateInheritClassDecorator(e,t,o,r,n){e=getClassDecoratorResult(e);t.hasObservedV2&&e.hasObserved?(0,_utils.addLog)(_utils.LogType.ERROR,"Because the current class is decorated by '@ObservedV2', it can not inherit a class decorated by '@Observed'.",o.getStart(),n,r):t.hasObserved&&e.hasObservedV2&&(0,_utils.addLog)(_utils.LogType.ERROR,"Because the current class is decorated by '@Observed', it can not inherit a class decorated by '@ObservedV2'.",o.getStart(),n,r)}function validateStructDecorator(e,t,o,r,n,i){var s="@"+n;r?i?_constant_define.default.COMPONENT_MEMBER_DECORATOR_V1.includes(s)&&(0,_utils.addLog)(_utils.LogType.ERROR,`The '@${n}' decorator can only be used in a 'struct' decorated with '@Component'.`,t.pos,o,e):_constant_define.default.DECORATOR_V2.includes(s)&&(0,_utils.addLog)(_utils.LogType.ERROR,`The '@${n}' decorator can only be used in a 'struct' decorated with '@ComponentV2'.`,t.pos,o,e):(_pre_define.STRUCT_DECORATORS.has(s)||_constant_define.default.COMPONENT_MEMBER_DECORATOR_V2.includes(s))&&(0,_utils.addLog)(_utils.LogType.ERROR,`The '@${n}' decorator can only be used with 'struct'.`,t.pos,o,e)}function validateMethodDecorator(e,t,o,r,n){let i;(_typescript.default.isMethodDeclaration(t.parent.parent)||_typescript.default.isDecorator(t.parent.parent)&&_typescript.default.isMethodDeclaration(t.parent.parent.parent))&&(!r&&_pre_define.STRUCT_CONTEXT_METHOD_DECORATORS.has("@"+n)&&(i=`The '@${n}' decorator can only be used in 'struct'.`),i=_pre_define.CHECK_EXTEND_DECORATORS.includes(n)?`The '@${n}' decorator can not be a member property method of a 'class' or 'struct'.`:i)&&(0,_utils.addLog)(_utils.LogType.ERROR,i,t.pos,o,e)}function isSendableClassDeclaration(e){var t=this;return(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_SENDABLE_DECORATOR)||e.members&&e.members.some(function(e){if(_newArrowCheck(this,t),_typescript.default.isConstructorDeclaration(e)){if(!e.body||!e.body.statements)return!1;var e=e.body.statements;if(e&&e[0]&&_typescript.default.isExpressionStatement(e[0]))return(e=e[0].expression)&&_typescript.default.isStringLiteral(e)&&"use sendable"===e.text}return!1}.bind(this))}function checkAllNode(e,t,o,r){_typescript.default.isIdentifier(e.expression)&&(checkNoChildComponent(e,o,r),checkOneChildComponent(e,t,o,r),checkSpecificChildComponent(e,t,o,r))}function checkNoChildComponent(e,t,o){var r,n={name:null,value:null};hasChild(e,n)&&(r=e.expression.escapedText.toString(),e=e.expression.getStart(),(0,_utils.addLog)(_utils.LogType.ERROR,null===n.name?`The component '${r}' can't have any child.`:`When the component '${r}' set '${n.name}' is '${n.value}'`+", can't have any child.",e,o,t))}function hasChild(e,t){var o=e.expression;return!(!_component_map.AUTOMIC_COMPONENT.has(o.escapedText.toString())&&!judgeComponentType(o,e,t)||!getNextNode(e))}function judgeComponentType(e,t,o){return _pre_define.COMPONENT_TOGGLE===e.escapedText.toString()&&t.arguments&&t.arguments[0]&&_typescript.default.isObjectLiteralExpression(t.arguments[0])&&t.arguments[0].getText()&&judgeToggleComponentParamType(t.arguments[0].getText(),o)}function judgeToggleComponentParamType(e,t){if(-1<e.indexOf(_pre_define.RESOURCE_NAME_TYPE)){t.name=_pre_define.RESOURCE_NAME_TYPE;e=e.match(/\b(Checkbox|Switch|Button)\b/);if(e&&e.length)return t.value=e[0],t.value!==_pre_define.COMPONENT_BUTTON}return!1}function getNextNode(e){if(e.body&&_typescript.default.isBlock(e.body))return e.body}function checkOneChildComponent(e,t,o,r){var n={name:null,value:null};hasNonSingleChild(e,t,n)&&(t=e.expression.escapedText.toString(),e=e.expression.getStart(),(0,_utils.addLog)(_utils.LogType.ERROR,null===n.name?`The component '${t}' can only have a single child component.`:`When the component '${t}' set '${n.name}' is `+`'${n.value}', can only have a single child component.`,e,r,o))}function hasNonSingleChild(e,t,o){var r=e.expression,n=getNextNode(e);if(_component_map.SINGLE_CHILD_COMPONENT.has(r.escapedText.toString())||!judgeComponentType(r,e,o)&&o.value===_pre_define.COMPONENT_BUTTON){if(!n)return!1;if(n&&n.statements){r=n.statements.length;if(!r)return!1;if(3<r)return!0;if(1<getBlockChildrenCount(n,t))return!0}}return!1}function getBlockChildrenCount(t,o){let r=0;var n=t.statements.length;for(let e=0;e<n;++e){var i=t.statements[e];if(_typescript.default.isExpressionStatement(i)&&_typescript.default.isCallExpression(i.expression)&&isForEachComponent(i.expression)&&(r+=2),_typescript.default.isIfStatement(i)&&(r+=getIfChildrenCount(i,o)),_typescript.default.isExpressionStatement(i)&&_typescript.default.isEtsComponentExpression(i.expression)&&(r+=1),_typescript.default.isExpressionStatement(i)&&_typescript.default.isCallExpression(i.expression)){let e=i.expression;for(;e.expression;)(_typescript.default.isEtsComponentExpression(e)||_typescript.default.isCallExpression(e)&&isComponent(e,o))&&(r+=1),e=e.expression}if(1<r)break}return r}function isComponent(e,t){return!(!_typescript.default.isIdentifier(e.expression)||!t.has(e.expression.escapedText.toString()))}function isForEachComponent(e){return!!_typescript.default.isIdentifier(e.expression)&&((e=e.expression.escapedText.toString())===_pre_define.COMPONENT_FOREACH||e===_pre_define.COMPONENT_LAZYFOREACH)}function getIfChildrenCount(e,t){return Math.max(getStatementCount(e.thenStatement,t),getStatementCount(e.elseStatement,t))}function getStatementCount(e,t){let o=0;return e&&(_typescript.default.isBlock(e)?o=getBlockChildrenCount(e,t):_typescript.default.isIfStatement(e)?o=getIfChildrenCount(e,t):_typescript.default.isExpressionStatement(e)&&_typescript.default.isEtsComponentExpression(e.expression)&&isForEachComponent(e.expression)?o=2:_typescript.default.isExpressionStatement(e)&&_typescript.default.isEtsComponentExpression(e.expression)&&!isForEachComponent(e.expression)&&isComponent(e.expression,t)&&(o=1)),o}function checkSpecificChildComponent(e,t,o,r){var n;hasNonspecificChild(e,t)&&(t=e.expression.escapedText.toString(),e=e.expression.getStart(),n=Array.from(_component_map.SPECIFIC_CHILD_COMPONENT.get(t)).join(" and "),(0,_utils.addLog)(_utils.LogType.ERROR,`The component '${t}' can only have the child component ${n}.`,e,r,o))}function hasNonspecificChild(e,t){var o=e.expression.escapedText.toString(),e=getNextNode(e);let r=!1;if(_component_map.SPECIFIC_CHILD_COMPONENT.has(o)&&e){o=_component_map.SPECIFIC_CHILD_COMPONENT.get(o);if(r=isNonspecificChildBlock(e,o,t));}return r}function isNonspecificChildBlock(o,r,n){if(o.statements){var i=o.statements.length;for(let t=0;t<i;++t){var s=o.statements[t];if(_typescript.default.isIfStatement(s)&&isNonspecificChildIf(s,r,n))return!0;if(_typescript.default.isExpressionStatement(s)&&_typescript.default.isCallExpression(s.expression)&&isForEachComponent(s.expression)&&isNonspecificChildForEach(s.expression,r,n))return!0;if(_typescript.default.isBlock(s)&&isNonspecificChildBlock(s,r,n))return!0;if(_typescript.default.isExpressionStatement(s)){let e=s.expression;for(;e.expression;){if(_typescript.default.isEtsComponentExpression(e)&&_typescript.default.isIdentifier(e.expression)&&!isForEachComponent(e)&&isComponent(e,n)){var a=isNonspecificChildNonForEach(e,r);if(a)return a;t+1<i&&_typescript.default.isBlock(o.statements[t+1])&&++t}e=e.expression}}}}return!1}function isNonspecificChildIf(e,t,o){return isNonspecificChildIfStatement(e.thenStatement,t,o)||isNonspecificChildIfStatement(e.elseStatement,t,o)}function isNonspecificChildForEach(e,t,o){if(_typescript.default.isCallExpression(e)&&e.arguments&&1<e.arguments.length&&_typescript.default.isArrowFunction(e.arguments[1])){e=e.arguments[1].body;if(!e)return!1;if(_typescript.default.isBlock(e)&&isNonspecificChildBlock(e,t,o))return!0;if(_typescript.default.isIfStatement(e)&&isNonspecificChildIf(e,t,o))return!0;if(_typescript.default.isCallExpression(e)&&isForEachComponent(e)&&isNonspecificChildForEach(e,t,o))return!0;if(_typescript.default.isEtsComponentExpression(e)&&!isForEachComponent(e)&&isComponent(e,o)&&isNonspecificChildNonForEach(e,t))return!0}return!1}function isNonspecificChildNonForEach(e,t){return!(!_typescript.default.isIdentifier(e.expression)||t.has(e.expression.escapedText.toString()))}function isNonspecificChildIfStatement(e,t,o){return!!e&&!!(_typescript.default.isBlock(e)&&isNonspecificChildBlock(e,t,o)||_typescript.default.isIfStatement(e)&&isNonspecificChildIf(e,t,o)||_typescript.default.isExpressionStatement(e)&&_typescript.default.isEtsComponentExpression(e.expression)&&isForEachComponent(e.expression)&&isNonspecificChildForEach(e.expression,t,o)||_typescript.default.isExpressionStatement(e)&&_typescript.default.isEtsComponentExpression(e.expression)&&!isForEachComponent(e.expression)&&isComponent(e.expression,o)&&isNonspecificChildNonForEach(e.expression,t))}function collectComponentProps(e,t){var o=e.name.getText(),e=getComponentSet(e,!0);propertyCollection.set(o,e.properties),stateCollection.set(o,e.states),linkCollection.set(o,e.links),_utils.storedFileInfo.overallLinkCollection.set(o,e.links),propCollection.set(o,e.props),regularCollection.set(o,e.regulars),storagePropCollection.set(o,e.storageProps),storageLinkCollection.set(o,e.storageLinks),provideCollection.set(o,e.provides),consumeCollection.set(o,e.consumes),objectLinkCollection.set(o,e.objectLinks),_utils.storedFileInfo.overallObjectLinkCollection.set(o,e.objectLinks),localStorageLinkCollection.set(o,e.localStorageLink),localStoragePropCollection.set(o,e.localStorageProp),builderParamObjectCollection.set(o,e.builderParams),builderParamInitialization.set(o,e.builderParamData),propInitialization.set(o,e.propData),regularInitialization.set(o,e.regularInit),stateInitialization.set(o,e.stateInit),provideInitialization.set(o,e.provideInit),privateCollection.set(o,e.privateCollection),t.updatePropsDecoratorsV1.push(...e.states,...e.props,...e.provides,...e.objectLinks),t.linkDecoratorsV1.push(...e.links)}function getComponentSet(e,t=!1){var o=new IComponentSet;return traversalComponentProps(e,o,t),o}class RecordRequire{constructor(){_defineProperty(this,"hasRequire",!1),_defineProperty(this,"hasProp",!1),_defineProperty(this,"hasBuilderParam",!1),_defineProperty(this,"hasRegular",!1),_defineProperty(this,"hasState",!1),_defineProperty(this,"hasProvide",!1)}}function traversalComponentProps(e,l,c=!1){var t=this;let p=!0;if(e.members){const d=new Set;e.members.forEach(function(o){if(_newArrowCheck(this,t),_typescript.default.isPropertyDeclaration(o)&&_typescript.default.isIdentifier(o.name)){var r=o.name.getText(),n=(l.properties.add(r),_typescript.default.getAllDecorators(o)),i=getAccessQualifier(o,c);if(n&&n.length){let t=p=!1;var s=new RecordRequire;for(let e=0;e<n.length;e++){var a=n[e].getText().replace(/\(.*\)$/,"").trim();_pre_define.INNER_COMPONENT_MEMBER_DECORATORS.has(a)&&(dollarCollection.add("$"+r),collectionStates(n[e],a,r,l,s),setPrivateCollection(l,i,r,a),validateAccessQualifier(o,r,a,i,s,c,t),t=!0)}regularAndRequire(n,l,s,r,i),checkRequire(r,l,s)}else l.regulars.add(r),setPrivateCollection(l,i,r,_pre_define.COMPONENT_NON_DECORATOR)}_typescript.default.isMethodDeclaration(o)&&o.name&&_typescript.default.isIdentifier(o.name)&&(validateStateVariable(o),d.add(o.name.getText()))}.bind(this)),collectCurrentClassMethod(e,d)}isStaticViewCollection.set(e.name.getText(),p)}function collectCurrentClassMethod(e,t){var o,r=new Map,n=(r.set(e.name.getText(),t),e.getSourceFile()),n=n?n.fileName:void 0;n&&((o=classMethodCollection.get(n))?o.get(e.name.getText())||o.set(e.name.getText(),t):classMethodCollection.set(n,r))}const FORBIDDEN_PUBLIC_ACCESS=[_pre_define.COMPONENT_STORAGE_PROP_DECORATOR,_pre_define.COMPONENT_STORAGE_LINK_DECORATOR,_pre_define.COMPONENT_LOCAL_STORAGE_LINK_DECORATOR,_pre_define.COMPONENT_LOCAL_STORAGE_PROP_DECORATOR,_pre_define.COMPONENT_CONSUME_DECORATOR],FORBIDDEN_PRIVATE_ACCESS=[_pre_define.COMPONENT_LINK_DECORATOR,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR];function validateAccessQualifier(e,t,o,r,n,i=!1,s){i&&(r.hasPublic&&FORBIDDEN_PUBLIC_ACCESS.includes(o)&&_process_ui_syntax.transformLog.errors.push({type:_utils.LogType.WARN,message:`Property '${t}' can not be decorated with both ${o} and public.`,pos:e.getStart()}),r.hasPrivate)&&(FORBIDDEN_PRIVATE_ACCESS.includes(o)&&_process_ui_syntax.transformLog.errors.push({type:_utils.LogType.WARN,message:`Property '${t}' can not be decorated with both ${o} and private.`,pos:e.getStart()}),n.hasRequire)&&!s&&_process_ui_syntax.transformLog.errors.push({type:_utils.LogType.WARN,message:`Property '${t}' can not be decorated with both @Require and private.`,pos:e.getStart()})}const SUPPORT_PRIVATE_PROPS=[_pre_define.COMPONENT_NON_DECORATOR,_pre_define.COMPONENT_STATE_DECORATOR,_pre_define.COMPONENT_PROP_DECORATOR,_pre_define.COMPONENT_PROVIDE_DECORATOR,_pre_define.COMPONENT_BUILDERPARAM_DECORATOR];function setPrivateCollection(e,t,o,r){t.hasPrivate&&SUPPORT_PRIVATE_PROPS.includes(r)&&e.privateCollection.add(o)}class AccessQualifierResult{constructor(){_defineProperty(this,"hasPrivate",!1),_defineProperty(this,"hasPublic",!1)}}function getAccessQualifier(t,o=!1){var r=this,e=_typescript.default.getModifiers(t);const n=new AccessQualifierResult;return e&&e.length&&e.forEach(function(e){_newArrowCheck(this,r),e.kind===_typescript.default.SyntaxKind.PrivateKeyword&&(n.hasPrivate=!0),e.kind===_typescript.default.SyntaxKind.PublicKeyword&&(n.hasPublic=!0),o&&e.kind===_typescript.default.SyntaxKind.ProtectedKeyword&&_process_ui_syntax.transformLog.errors.push({type:_utils.LogType.WARN,message:"The member attributes of a struct can not be protected.",pos:t.getStart()})}.bind(this)),n}function regularAndRequire(e,t,o,r,n){e&&1===e.length&&e[0].getText()===_pre_define.COMPONENT_REQUIRE_DECORATOR&&(t.regulars.add(r),o.hasRegular=!0,setPrivateCollection(t,n,r,_pre_define.COMPONENT_NON_DECORATOR))}function checkRequire(e,t,o){o.hasRequire&&(setInitValue("hasProp","propData",e,t,o),setInitValue("hasBuilderParam","builderParamData",e,t,o),setInitValue("hasRegular","regularInit",e,t,o),setInitValue("hasState","stateInit",e,t,o),setInitValue("hasProvide","provideInit",e,t,o))}function setInitValue(e,t,o,r,n){n[e]&&r[t].add(o)}function collectionStates(e,t,o,r,n){switch(t){case _pre_define.COMPONENT_STATE_DECORATOR:r.states.add(o),n.hasState=!0;break;case _pre_define.COMPONENT_LINK_DECORATOR:r.links.add(o);break;case _pre_define.COMPONENT_PROP_DECORATOR:n.hasProp=!0,r.props.add(o);break;case _pre_define.COMPONENT_STORAGE_PROP_DECORATOR:r.storageProps.add(o);break;case _pre_define.COMPONENT_STORAGE_LINK_DECORATOR:r.storageLinks.add(o);break;case _pre_define.COMPONENT_PROVIDE_DECORATOR:n.hasProvide=!0,r.provides.add(o);break;case _pre_define.COMPONENT_CONSUME_DECORATOR:r.consumes.add(o);break;case _pre_define.COMPONENT_OBJECT_LINK_DECORATOR:r.objectLinks.add(o);break;case _pre_define.COMPONENT_BUILDERPARAM_DECORATOR:n.hasBuilderParam=!0,r.builderParams.add(o);break;case _pre_define.COMPONENT_LOCAL_STORAGE_LINK_DECORATOR:collectionlocalStorageParam(e,o,r.localStorageLink);break;case _pre_define.COMPONENT_LOCAL_STORAGE_PROP_DECORATOR:collectionlocalStorageParam(e,o,r.localStorageProp);break;case _pre_define.COMPONENT_REQUIRE_DECORATOR:n.hasRequire=!0}}function collectionlocalStorageParam(e,t,o){var r=new Set;e&&_typescript.default.isCallExpression(e.expression)&&e.expression.arguments&&e.expression.arguments.length&&o.set(t,r.add(e.expression.arguments[0].getText()))}function sourceReplace(e,t){return collectImportNames(e=processSystemApi(preprocessNewExtend(preprocessExtend(e)),!1,t),t),{content:e,log:[]}}function preprocessExtend(e,n){var i=this;return e.replace(/@Extend(\s+)([^\.\s]+)\.([^\(]+)\(/gm,function(e,t,o,r){return _newArrowCheck(this,i),(0,_process_ui_syntax.collectExtend)(_component_map.EXTEND_ATTRIBUTE,o,"__"+o+"__"+r),(0,_process_ui_syntax.collectExtend)(_component_map.EXTEND_ATTRIBUTE,o,r),n&&n.add(r),`@Extend(${o})${t}function __${o}__${r}(`}.bind(this))}function preprocessNewExtend(e,o){var r=this;return e.replace(/@Extend\s*\([^\)]+\)\s*function\s+([^\(\s]+)\s*\(/gm,function(e,t){return _newArrowCheck(this,r),o&&o.add(t),e}.bind(this))}function replaceSystemApi(e,t,o,r){return _pre_define.NATIVE_MODULE.has(o+"."+r)?e=`var ${t} = globalThis.requireNativeModule('${o}.${r}')`:o!==_pre_define.SYSTEM_PLUGIN&&o!==_pre_define.OHOS_PLUGIN||(e=`var ${t} = globalThis.requireNapi('${r}')`),e}function replaceLibSo(e,t,o=null){return o&&useOSFiles.add(o),_main.projectConfig.bundleName&&_main.projectConfig.moduleName?`var ${e} = globalThis.requireNapi("${t}", true, "${_main.projectConfig.bundleName}/${_main.projectConfig.moduleName}");`:`var ${e} = globalThis.requireNapi("${t}", true);`}function processSystemApi(e,a=!1,l=null,c=!1){var p=this,t=(a&&_main.projectConfig.compileMode===_pre_define.ESMODULE&&(e=e.replace(/import(?:\s*)['"]@(system|ohos)\.(\S+)['"]/g,"")),a?_main.projectConfig.compileMode===_pre_define.ESMODULE?/import\s+(.+)\s+from\s+['"]@(system|ohos)\.(\S+)['"]/g:/(import|const)\s+(.+)\s*=\s*(\_\_importDefault\()?require\(\s*['"]@(system|ohos)\.(\S+)['"]\s*\)(\))?/g:/(import|export)\s+(?:(.+)|\{([\s\S]+)\})\s+from\s+['"](\S+)['"]|import\s+(.+)\s*=\s*require\(\s*['"](\S+)['"]\s*\)/g);const d=new Set;return processInnerModule(e.replace(t,function(e,t,o,r,n,i,s){_newArrowCheck(this,p);t=a?_main.projectConfig.compileMode===_pre_define.ESMODULE?t:o:o||i;return a?(d.add(t),_main.projectConfig.compileMode!==_pre_define.ESMODULE?(collectSourcemapNames(l,t,i),replaceSystemApi(e,t,n,i)):(collectSourcemapNames(l,t,r),replaceSystemApi(e,t,o,r))):/^@(system|ohos)\./.test(i=n||s)?c?replaceSystemApi(e,t,(o=i.match(/^@(system|ohos)\.(\S+)$/))[1],o[2]):e:/^lib(\S+)\.so$/.test(i)?replaceLibSo(t,i.match(/^lib(\S+)\.so$/)[1],l):e}.bind(this)),d)}function collectSourcemapNames(e,t,o){if(null!=e){var r=e.replace(".ets",".js").replace(".ts",".js");if(sourcemapNamesCollection.has(r)){var n=sourcemapNamesCollection.get(r);if(!n.has(t))for(const a of originalImportNamesMap.entries()){var i=a[0],s=a[1];if(s==="@ohos."+o||s==="@system."+o){n.set(t.trim(),i),sourcemapNamesCollection.set(r,n),originalImportNamesMap.delete(i);break}}}}}function collectImportNames(e,t=null){var o=this,e=e.match(/(import|export)\s+(.+)\s+from\s+['"](\S+)['"]|import\s+(.+)\s*=\s*require\(\s*['"](\S+)['"]\s*\)/g);null!==e&&e.forEach(function(e){_newArrowCheck(this,o);e=e.split(" ");4!==e.length||"import"!==e[0]||"from"!==e[2]||e[3].includes(".so")||originalImportNamesMap.set(e[1],e[3].replace(/'/g,""))}.bind(this)),t&&null!==t&&(e=t.replace(".ets",".js").replace(".ts",".js"),sourcemapNamesCollection.has(e)||sourcemapNamesCollection.set(e,new Map))}function processInnerModule(o,e){var r=this;return e.forEach(function(e){_newArrowCheck(this,r);for(var t=e.trim()+".default";o.includes(t);)o=o.replace(t,e.trim())}.bind(this)),o}function resetComponentCollection(){componentCollection.entryComponent=null,componentCollection.entryComponentPos=null,componentCollection.previewComponent=[],_process_component_member.stateObjectCollection.clear(),builderParamInitialization.clear(),propInitialization.clear(),propCollection.clear(),objectLinkCollection.clear(),linkCollection.clear(),_utils.storedFileInfo.overallLinkCollection.clear(),_utils.storedFileInfo.overallObjectLinkCollection.clear(),_utils.storedFileInfo.overallBuilderParamCollection.clear(),regularInitialization.clear(),stateInitialization.clear(),provideInitialization.clear(),privateCollection.clear()}function checkEntryComponent(t,o,r){var n=_typescript.default.canHaveModifiers(t)?_typescript.default.getModifiers(t):void 0;if(n)for(let e=0;e<n.length;e++)if(n[e].kind===_typescript.default.SyntaxKind.ExportKeyword){(0,_utils.addLog)(_utils.LogType.WARN,"It's not a recommended way to export struct with @Entry decorator, which may cause ACE Engine error in component preview mode.",t.getStart(),o,r);break}}function validateStateVariable(e){var t=_typescript.default.getAllDecorators(e);if(t&&t.length)for(let e=0;e<t.length;e++){var o=t[e].getText().replace(/\(.*\)$/,"").trim();_pre_define.CARD_ENABLE_DECORATORS[o]&&(0,_process_ui_syntax.validatorCard)(_process_ui_syntax.transformLog.errors,_pre_define.CARD_LOG_TYPE_DECORATORS,t[e].getStart(),o),_pre_define.INNER_COMPONENT_MEMBER_DECORATORS.has(o)&&_process_ui_syntax.transformLog.errors.push({type:_utils.LogType.ERROR,message:`'${t[e].getText()}' can not decorate the method.`,pos:t[e].getStart()})}}function getObservedPropertyCollection(e){var t=new Set([...stateCollection.get(e),...linkCollection.get(e),...propCollection.get(e),...storageLinkCollection.get(e),...storageLinkCollection.get(e),...provideCollection.get(e),...consumeCollection.get(e),...objectLinkCollection.get(e)]);return getLocalStorageCollection(e,t),t}function getLocalStorageCollection(e,t){if(localStorageLinkCollection.get(e))for(const o of localStorageLinkCollection.get(e).keys())t.add(o);if(localStoragePropCollection.get(e))for(const r of localStoragePropCollection.get(e).keys())t.add(r)}function resetValidateUiSyntax(){observedClassCollection.clear(),enumCollection.clear(),classMethodCollection.clear(),dollarCollection.clear(),stateCollection.clear(),regularCollection.clear(),storagePropCollection.clear(),storageLinkCollection.clear(),provideCollection.clear(),consumeCollection.clear(),builderParamObjectCollection.clear(),localStorageLinkCollection.clear(),localStoragePropCollection.clear(),isStaticViewCollection.clear(),useOSFiles.clear(),sourcemapNamesCollection.clear(),originalImportNamesMap.clear()}