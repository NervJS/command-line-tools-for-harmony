"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SOURCE_FILES=void 0,exports.addLocalPackageSet=addLocalPackageSet,exports.checkerResult=exports.cache=exports.appComponentCollection=exports.allSourceFilePaths=exports.allModuleIds=void 0,exports.collectAllFiles=collectAllFiles,exports.collectFileToIgnoreDiagnostics=collectFileToIgnoreDiagnostics,exports.collectTscFiles=collectTscFiles,exports.compilerOptions=void 0,exports.createLanguageService=createLanguageService,exports.createWatchCompilerHost=createWatchCompilerHost,exports.dollarCollection=void 0,exports.emitBuildInfo=emitBuildInfo,exports.etsStandaloneChecker=etsStandaloneChecker,exports.fileHashScriptVersion=exports.fastBuildLogger=exports.extendCollection=void 0,exports.getArkTSLinterMode=getArkTSLinterMode,exports.importModuleCollection=exports.hotReloadSupportFiles=void 0,exports.incrementWatchFile=incrementWatchFile,exports.instanceInsteadThis=instanceInsteadThis,exports.isStandardMode=isStandardMode,exports.localPackageSet=exports.languageService=void 0,exports.mergeRollUpFiles=mergeRollUpFiles,exports.needReCheckForChangedDepUsers=exports.moduleResolutionHostTest=void 0,exports.printDiagnostic=printDiagnostic,exports.props=void 0,exports.readDeaclareFiles=readDeaclareFiles,exports.resetEtsCheck=resetEtsCheck,exports.resetEtsCheckTypeScript=resetEtsCheckTypeScript,exports.resolveModuleNames=resolveModuleNames,exports.resolveTypeReferenceDirectives=resolveTypeReferenceDirectives,exports.resolvedModulesCache=void 0,exports.runArkTSLinter=runArkTSLinter,exports.serviceChecker=serviceChecker,exports.warnCheckerResult=exports.targetESVersionChanged=exports.shouldResolvedFiles=void 0,exports.watchChecker=watchChecker;var _fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),ts=_interopRequireWildcard(require("typescript")),crypto=_interopRequireWildcard(require("crypto")),_main=require("../main"),_validate_ui_syntax=require("./validate_ui_syntax"),_pre_define=require("./pre_define"),_component_map=require("./component_map"),_compile_info=require("./compile_info"),_utils=require("./utils"),_process_ui_syntax=require("./process_ui_syntax"),_process_visual=require("./process_visual"),_rollupPluginEtsChecker=require("./fast_build/ets_ui/rollup-plugin-ets-checker"),_do_arkTS_linter=require("./do_arkTS_linter"),_api_check_utils=require("./fast_build/system_api/api_check_utils"),_ob_config_resolver=require("./fast_build/ark_compiler/common/ob_config_resolver"),_this2=void 0;function _getRequireWildcardCache(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(_getRequireWildcardCache=function(e){return e?r:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var r,i,o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=s?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(o,r,i):o[r]=e[r]);return o.default=e,t&&t.set(e,o),o}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}const fse=require("fs-extra"),SOURCE_FILES=new Map;exports.SOURCE_FILES=SOURCE_FILES;let localPackageSet=new Set;function readDeaclareFiles(){var t=this;const r=[];return _fs.default.readdirSync(_path.default.resolve(__dirname,"../declarations")).forEach(function(e){_newArrowCheck(this,t),/\.d\.ts$/.test(e)&&r.push(_path.default.resolve(__dirname,"../declarations",e))}.bind(this)),r}exports.localPackageSet=localPackageSet;const buildInfoWriteFile=function(e,t){_newArrowCheck(this,_this2),e.includes(_pre_define.TS_BUILD_INFO_SUFFIX)&&(e=_fs.default.openSync(e,"w"),_fs.default.writeSync(e,t,void 0,"utf8"),_fs.default.closeSync(e))}.bind(void 0),filesBuildInfo=new Map,compilerOptions=ts.readConfigFile(_path.default.resolve(__dirname,"../tsconfig.json"),ts.sys.readFile).config.compilerOptions;function setCompilerOptions(e){var t=this;const r=["*"],i=_path.default.resolve(_main.projectConfig.projectPath);"rollup"===process.env.compileTool&&e&&e.length?e.forEach(function(e){_newArrowCheck(this,t),/oh_modules$/.test(e)||/node_modules$/.test(e)||r.push(_path.default.join(_path.default.relative(i,e),"*"))}.bind(this)):_main.projectConfig.aceModuleJsonPath?(r.push("../../../../*"),r.push("../*")):(r.push("../../../../../*"),r.push("../../*"));e=_main.projectConfig.hotReload?_pre_define.HOT_RELOAD_BUILD_INFO_SUFFIX:_pre_define.TS_BUILD_INFO_SUFFIX,e=_path.default.resolve(_main.projectConfig.cachePath,"..",e);checkArkTSVersion(),Object.assign(compilerOptions,{allowJs:getArkTSLinterMode()!==_do_arkTS_linter.ArkTSLinterMode.NOT_USE,checkJs:getArkTSLinterMode()===_do_arkTS_linter.ArkTSLinterMode.NOT_USE&&void 0,emitNodeModulesFiles:!0,importsNotUsedAsValues:ts.ImportsNotUsedAsValues.Preserve,module:ts.ModuleKind.CommonJS,moduleResolution:ts.ModuleResolutionKind.NodeJs,noEmit:!0,target:convertConfigTarget(getTargetESVersion()),baseUrl:i,paths:{"*":r},lib:convertConfigLib(getTargetESVersionLib()),types:_main.projectConfig.compilerTypes,etsLoaderPath:_main.projectConfig.etsLoaderPath,needDoArkTsLinter:getArkTSLinterMode()!==_do_arkTS_linter.ArkTSLinterMode.NOT_USE,isCompatibleVersion:getArkTSLinterMode()===_do_arkTS_linter.ArkTSLinterMode.COMPATIBLE_MODE,skipTscOhModuleCheck:_main.partialUpdateConfig.skipTscOhModuleCheck,skipArkTSStaticBlocksCheck:_main.partialUpdateConfig.skipArkTSStaticBlocksCheck,incremental:!0,tsBuildInfoFile:e,tsImportSendableEnable:tsImportSendable,skipPathsInKeyForCompilationSettings:reuseLanguageServiceForDepChange,compatibleSdkVersionStage:_main.projectConfig.compatibleSdkVersionStage,compatibleSdkVersion:_main.projectConfig.compatibleSdkVersion}),_main.projectConfig.compileMode===_pre_define.ESMODULE&&Object.assign(compilerOptions,{importsNotUsedAsValues:ts.ImportsNotUsedAsValues.Remove,module:ts.ModuleKind.ES2020}),"oh_modules"===_main.projectConfig.packageDir&&Object.assign(compilerOptions,{packageManagerType:"ohpm"}),readTsBuildInfoFileInCrementalMode(e,_main.projectConfig)}function checkArkTSVersion(){var e=fastBuildLogger||_compile_info.logger;getArkTSVersion()===_do_arkTS_linter.ArkTSVersion.ArkTS_1_0&&tsImportSendable&&(e.error("[31mArkTS: ArkTSVersion1.0 does not support tsImportSendable in any condition"),tsImportSendable=!1)}function convertConfigTarget(e){return"number"==typeof e&&e in ts.ScriptTarget?e:ts.convertCompilerOptionsFromJson({target:e},"").options.target}function convertConfigLib(t){let r=!0;var i=Array.from(ts.libMap.values());for(let e=0;e<t.length;e++)if(!i.includes(t[e])){r=!1;break}return r?t:ts.convertCompilerOptionsFromJson({lib:t},"").options.lib}function readTsBuildInfoFileInCrementalMode(t,e){var r=this;if(_fs.default.existsSync(t)&&(e.compileHar||e.compileShared)){let e;try{var i=JSON.parse(_fs.default.readFileSync(t,"utf-8"));if(!(e=i.program)||!e.fileNames||!e.fileInfos)throw new Error(".tsbuildinfo content is invalid")}catch(e){return void fastBuildLogger.warn("[33mArkTS: Failed to parse .tsbuildinfo file. Error message: "+e.message.toString())}const o=_path.default.dirname(t),s=(0,_utils.isWindows)()||(0,_utils.isMac)(),n=e.fileNames;e.fileInfos.forEach(function(e,t){_newArrowCheck(this,r);e="string"==typeof e?e:e.version,t=_path.default.resolve(o,n[t]);filesBuildInfo.set(s?(0,_utils.tryToLowerCasePath)(t):t,e)}.bind(this))}}function createHash(e){var t=crypto.createHash("sha256");return t.update(e),t.digest("hex")}exports.compilerOptions=compilerOptions;const fileHashScriptVersion=function(e){if(_newArrowCheck(this,_this2),!_fs.default.existsSync(e))return"0";let t=_fs.default.readFileSync(e).toString();e=cache[_path.default.resolve(e)];return e&&!0===e.error&&e.errorCodes&&e.errorCodes.includes(2307)&&(t+=Date.now().toString()),createHash(t)}.bind(void 0),reuseLanguageServiceForDepChange=(exports.fileHashScriptVersion=fileHashScriptVersion,!0);let needReCheckForChangedDepUsers=!1;function createLanguageService(e,t,r=null,i){var o=this,t=(setCompilerOptions(t),{getScriptFileNames:function(){return _newArrowCheck(this,o),[...e,...readDeaclareFiles()]}.bind(this),getScriptVersion:fileHashScriptVersion,getScriptSnapshot:function(e){var t;if(_fs.default.existsSync(e))return/(?<!\.d)\.(ets|ts)$/.test(e)?((0,_utils.startTimeStatisticsLocation)(r?r.scriptSnapshotTime:void 0),appComponentCollection.set(_path.default.join(e),new Set),t=instanceInsteadThis(t=processContent(_fs.default.readFileSync(e).toString(),e),e,[],this.uiProps),(0,_utils.stopTimeStatisticsLocation)(r?r.scriptSnapshotTime:void 0),ts.ScriptSnapshot.fromString(t)):ts.ScriptSnapshot.fromString(_fs.default.readFileSync(e).toString())},getCurrentDirectory:function(){return _newArrowCheck(this,o),process.cwd()}.bind(this),getCompilationSettings:function(){return _newArrowCheck(this,o),compilerOptions}.bind(this),getDefaultLibFileName:function(e){return _newArrowCheck(this,o),ts.getDefaultLibFilePath(e)}.bind(this),fileExists:ts.sys.fileExists,readFile:ts.sys.readFile,readDirectory:ts.sys.readDirectory,resolveModuleNames:resolveModuleNames,resolveTypeReferenceDirectives:resolveTypeReferenceDirectives,directoryExists:ts.sys.directoryExists,getDirectories:ts.sys.getDirectories,getJsDocNodeCheckedConfig:function(e,t){return _newArrowCheck(this,o),(0,_api_check_utils.getJsDocNodeCheckConfig)(e.currentFileName,t)}.bind(this),getFileCheckedModuleInfo:function(e){return _newArrowCheck(this,o),{fileNeedCheck:!0,checkPayload:void 0,currentFileName:e}}.bind(this),getJsDocNodeConditionCheckedResult:function(e,t){return _newArrowCheck(this,o),(0,_api_check_utils.getJsDocNodeConditionCheckResult)(e,t)}.bind(this),uiProps:[],clearProps:function(){dollarCollection.clear(),extendCollection.clear(),this.uiProps.length=0},hasInvalidatedResolutions:function(e){return _newArrowCheck(this,o),reuseLanguageServiceForDepChange&&needReCheckForChangedDepUsers}.bind(this)});return"true"===process.env.watchMode?ts.createLanguageService(t,ts.createDocumentRegistry()):getOrCreateLanguageService(t,e,i)}exports.needReCheckForChangedDepUsers=needReCheckForChangedDepUsers;let targetESVersionChanged=!1;function getOrCreateLanguageService(e,t,r){var i="service",o=(0,_utils.getRollupCache)(r,_main.projectConfig,i);let s=o?.service;var n=r?.projectConfig?.pkgJsonFileHash,a=compilerOptions.target,l=o?.pkgJsonFileHash,c=o?.targetESVersion,l=n&&l&&n!==l,d=reuseLanguageServiceForDepChange?l&&!r?.depInfo?.enableIncre:l,c=c&&a&&c!==a,o=!(void 0===o?.preTsImportSendable&&!tsImportSendable)&&o?.preTsImportSendable!==tsImportSendable,d=d||c||o,d=(reuseLanguageServiceForDepChange&&l&&r?.depInfo?.enableIncre&&(exports.needReCheckForChangedDepUsers=needReCheckForChangedDepUsers=!0),!s||d?(rebuiuldProgram(c,o),s=ts.createLanguageService(e,ts.createDocumentRegistry())):(l=[...t,...readDeaclareFiles()],s.updateRootFiles(l)),{service:s,pkgJsonFileHash:n,targetESVersion:a,preTsImportSendable:tsImportSendable});return(0,_utils.setRollupCache)(r,_main.projectConfig,i,d),s}function rebuiuldProgram(e,t){e?(deleteBuildInfoCache(compilerOptions.tsBuildInfoFile),exports.targetESVersionChanged=targetESVersionChanged=!0):t&&deleteBuildInfoCache(compilerOptions.tsBuildInfoFile)}function deleteBuildInfoCache(e){var t=e+".linter";deleteFile(e),deleteFile(t)}function deleteFile(e){_fs.default.existsSync(e)&&_fs.default.unlinkSync(e)}exports.targetESVersionChanged=targetESVersionChanged;let cache={};exports.cache=cache;const hotReloadSupportFiles=new Set,shouldResolvedFiles=(exports.hotReloadSupportFiles=hotReloadSupportFiles,new Set),appComponentCollection=(exports.shouldResolvedFiles=shouldResolvedFiles,new Map),allResolvedModules=(exports.appComponentCollection=appComponentCollection,new Set),allSourceFilePaths=new Set,allModuleIds=(exports.allSourceFilePaths=allSourceFilePaths,new Set);exports.allModuleIds=allModuleIds;let props=[],fastBuildLogger=(exports.props=props,null);exports.fastBuildLogger=fastBuildLogger;const checkerResult={count:0},warnCheckerResult=(exports.checkerResult=checkerResult,{count:0});exports.warnCheckerResult=warnCheckerResult;let languageService=null,tsImportSendable=(exports.languageService=languageService,!1);function serviceChecker(e,t=null,r=null,i=null,o){var s=this;exports.fastBuildLogger=fastBuildLogger=t;let n=null;tsImportSendable=o?.projectConfig.tsImportSendable,_main.projectConfig.xtsMode||"true"===process.env.watchMode?(_main.projectConfig.hotReload&&e.forEach(function(e){_newArrowCheck(this,s),hotReloadSupportFiles.add(e)}.bind(this)),exports.languageService=languageService=createLanguageService(e,r,i),exports.props=props=languageService.getProps()):([t,a]=isJsonString(n=_path.default.resolve(_main.projectConfig.cachePath,"../.ts_checker_cache")),(t=t?a:{runtimeOS:_main.projectConfig.runtimeOS,sdkInfo:_main.projectConfig.sdkInfo,fileList:{}}).runtimeOS===_main.projectConfig.runtimeOS&&t.sdkInfo===_main.projectConfig.sdkInfo?exports.cache=cache=t.fileList:exports.cache=cache={},exports.languageService=languageService=createLanguageService(e,r,i,o));var a=ts.ArkTSLinterTimePrinter.getInstance();a.setArkTSTimePrintSwitch(!1),a.appendTime(ts.TimePhase.START),(0,_utils.startTimeStatisticsLocation)(i?i.createProgramTime:void 0),_main.globalProgram.builderProgram=languageService.getBuilderProgram(!0),_main.globalProgram.program=_main.globalProgram.builderProgram.getProgram(),exports.props=props=languageService.getProps(),a.appendTime(ts.TimePhase.GET_PROGRAM),(0,_utils.stopTimeStatisticsLocation)(i?i.createProgramTime:void 0),collectAllFiles(_main.globalProgram.program,void 0,void 0,o),collectFileToIgnoreDiagnostics(e),(0,_utils.startTimeStatisticsLocation)(i?i.runArkTSLinterTime:void 0),runArkTSLinter(),(0,_utils.stopTimeStatisticsLocation)(i?i.runArkTSLinterTime:void 0),"true"!==process.env.watchMode&&processBuildHap(n,e,i,o),!_main.globalProgram.program||"true"===process.env.watchMode||_main.projectConfig.isPreview||_main.projectConfig.hotReload||_main.projectConfig.coldReload||(_main.globalProgram.program.releaseTypeChecker(),global&&global.gc&&"function"==typeof global.gc&&global.gc())}function isJsonString(e){if(!_fs.default.existsSync(e))return[!1,void 0];try{return[!0,JSON.parse(_fs.default.readFileSync(e).toString())]}catch(e){return[!1,void 0]}}function collectAllFiles(e,t,r,i=null){e?collectTscFiles(e,i):mergeRollUpFiles(t,r)}function collectTscFiles(e,r=null){var i=this,e=e.getSourceFiles();let o=_main.projectConfig.projectRootPath;if(o){o=(0,_utils.toUnixPath)(o);const s=(0,_utils.isWindows)()||(0,_utils.isMac)();e.forEach(function(e){_newArrowCheck(this,i);var t=(0,_utils.toUnixPath)(e.fileName);_ob_config_resolver.sourceFileDependencies.set(t,e.resolvedModules),(t.startsWith(o+"/")||isOtherProjectResolvedModulesFilePaths(r,t))&&(allSourceFilePaths.add(t),allModuleIds.add(e.fileName),0<filesBuildInfo.size)&&Reflect.get(e,"version")!==filesBuildInfo.get(s?(0,_utils.tryToLowerCasePath)(t):t)&&allResolvedModules.add(t)}.bind(this))}}function isOtherProjectResolvedModulesFilePaths(e,t){if(e&&e.projectConfig&&e.projectConfig.rootPathSet){var r=e.projectConfig.rootPathSet;if(!Array.isArray(r))return!1;for(let e=0;e<r.length;e++){var i=(0,_utils.toUnixPath)(r[e])+"/";if(t.startsWith(i))return!0}}return!1}function mergeRollUpFiles(e,t){for(const r of e)_fs.default.existsSync(r)&&(allSourceFilePaths.add((0,_utils.toUnixPath)(r)),allModuleIds.add(r),addLocalPackageSet(r,t))}function addLocalPackageSet(e,t){t=t.getModuleInfo(e).meta;t.isLocalDependency&&(_main.projectConfig.useNormalizedOHMUrl&&t.pkgName&&localPackageSet.add(t.pkgName),!_main.projectConfig.useNormalizedOHMUrl)&&t.moduleName&&localPackageSet.add(t.moduleName)}function emitBuildInfo(){_main.globalProgram.builderProgram.emitBuildInfo(buildInfoWriteFile)}function processBuildHap(e,t,r,i){var o=this,s=((0,_utils.startTimeStatisticsLocation)(r?r.diagnosticTime:void 0),_main.globalProgram.builderProgram.getSyntacticDiagnostics().concat(_main.globalProgram.builderProgram.getSemanticDiagnostics()));if((0,_utils.stopTimeStatisticsLocation)(r?r.diagnosticTime:void 0),emitBuildInfo(),s.forEach(function(e){_newArrowCheck(this,o),printDiagnostic(e)}.bind(this)),_main.projectConfig.xtsMode||(fse.ensureDirSync(_main.projectConfig.cachePath),_fs.default.writeFileSync(e,JSON.stringify({runtimeOS:_main.projectConfig.runtimeOS,sdkInfo:_main.projectConfig.sdkInfo,fileList:cache},null,2))),_main.projectConfig.compileHar||_main.projectConfig.compileShared){let i=void 0,r=function(e,t,r){_newArrowCheck(this,o),i=t}.bind(this);[...allResolvedModules,...t].forEach(function(e){if(_newArrowCheck(this,o),!e.match(new RegExp(_main.projectConfig.packageDir))||!_main.projectConfig.compileHar)try{var t;/\.d\.e?ts$/.test(e)?(0,_utils.generateSourceFilesInHar)(e,_fs.default.readFileSync(e,"utf-8"),_path.default.extname(e),_main.projectConfig,_main.projectConfig.modulePathMap):/\.e?ts$/.test(e)&&(i=void 0,(t=_main.globalProgram.program.getSourceFile(e))&&_main.globalProgram.program.emit(t,r,void 0,!0,void 0,!0),i)&&(0,_utils.generateSourceFilesInHar)(e,i,".d"+_path.default.extname(e),_main.projectConfig,_main.projectConfig.modulePathMap)}catch(e){}}.bind(this)),printDeclarationDiagnostics()}}function printDeclarationDiagnostics(){var t=this;_main.globalProgram.builderProgram.getDeclarationDiagnostics().forEach(function(e){_newArrowCheck(this,t),printDiagnostic(e)}.bind(this))}function containFormError(e){return!!/can't support form application./.test(e)}let fileToIgnoreDiagnostics=void 0;function collectFileToThrowDiagnostics(e,t){var r=this,i=_path.default.resolve(e),o=(0,_utils.toUnixPath)(e);t.has(o)||(t.add(o),!/\.(c|m)?js$/.test(e)&&cache[i]&&0!==cache[i].children.length&&cache[i].children.forEach(function(e){_newArrowCheck(this,r),collectFileToThrowDiagnostics(e,t)}.bind(this)))}function collectFileToIgnoreDiagnostics(e){var i=this;if(getArkTSLinterMode()!==_do_arkTS_linter.ArkTSLinterMode.NOT_USE){if("true"===process.env.watchMode)for(var[o,s]of resolvedModulesCache)createOrUpdateCache(s,o);let t=new Set,r=(e.forEach(function(e){_newArrowCheck(this,i),/\.(c|m)?js$/.test(e)||collectFileToThrowDiagnostics(e,t)}.bind(this)),new Set);_main.globalProgram.program.getResolvedTypeReferenceDirectives().forEach(function(e){_newArrowCheck(this,i),e&&e.resolvedFileName&&r.add(e.resolvedFileName)}.bind(this)),fileToIgnoreDiagnostics=new Set,_main.globalProgram.program.getSourceFiles().forEach(function(e){_newArrowCheck(this,i),!e.fileName||isInSDK(e.fileName)&&!/\.(c|m)?js$/.test(e.fileName)||r.has(e.fileName)||fileToIgnoreDiagnostics.add((0,_utils.toUnixPath)(e.fileName))}.bind(this)),t.forEach(function(e){_newArrowCheck(this,i),fileToIgnoreDiagnostics.delete(e)}.bind(this))}}function printDiagnostic(t){if(!(_main.projectConfig.ignoreWarning||fileToIgnoreDiagnostics&&t.file&&t.file.fileName&&fileToIgnoreDiagnostics.has((0,_utils.toUnixPath)(t.file.fileName)))){var r=ts.flattenDiagnosticMessageText(t.messageText,"\n");if(validateError(r)&&("true"===process.env.watchMode||_main.projectConfig.xtsMode||updateErrorFileCache(t),!containFormError(r)||(0,_api_check_utils.isCardFile)(t.file.fileName))){var i,o,s=t.category===ts.DiagnosticCategory.Error?"ERROR":"WARN",n=fastBuildLogger||_compile_info.logger;let e;"ERROR"==s?checkerResult.count+=1:warnCheckerResult.count+=1,e=t.file?({line:i,character:o}=t.file.getLineAndCharacterOfPosition(t.start),`ArkTS:${s} File: ${t.file.fileName}:${i+1}:${o+1}
 ${r}
`):`ArkTS:${s}: `+r,t.category===ts.DiagnosticCategory.Error?n.error("[31m"+e):n.warn("[33m"+e)}}}function validateError(e){return!matchMessage(e,props,/Cannot find name\s*'(\$?\$?[_a-zA-Z0-9]+)'/)&&!matchMessage(e,props,/Property\s*'(\$?[_a-zA-Z0-9]+)' does not exist on type/)}function matchMessage(e,t,r){if(r.test(e)){e=e.match(r);if(e[1]&&t.includes(e[1]))return!0}return!1}function updateErrorFileCache(e){var t;e.file&&(t=cache[_path.default.resolve(e.file.fileName)])&&(t.error=!0,t.errorCodes||(t.errorCodes=[]),t.errorCodes.includes(e.code)||t.errorCodes.push(e.code))}function filterInput(e){var i=this;return e.filter(function(e){_newArrowCheck(this,i);var t={flag:!1},r=new Set;return checkNeedUpdateFiles(_path.default.resolve(e),t,r),t.flag||_utils.storedFileInfo.changeFiles.push(_path.default.resolve(e)),t.flag}.bind(this))}function checkNeedUpdateFiles(e,t,r){if(!r.has(e)&&(r.add(e),!t.flag)){var i=cache[e],o=_fs.default.statSync(e).mtimeMs;if(i)if(i.error||i.mtimeMs!==o)t.flag=!0;else for(let e=0;e<i.children.length;++e)_fs.default.existsSync(i.children[e])?checkNeedUpdateFiles(i.children[e],t,r):t.flag=!0;else cache[e]={mtimeMs:o,children:[],parent:[],error:!1},t.flag=!0}}const fileExistsCache=new Map,dirExistsCache=new Map,moduleResolutionHost={fileExists:function(e){_newArrowCheck(this,_this2);let t=fileExistsCache.get(e);return void 0===t&&(t=ts.sys.fileExists(e),fileExistsCache.set(e,t)),t}.bind(void 0),directoryExists:function(e){_newArrowCheck(this,_this2);let t=dirExistsCache.get(e);return void 0===t&&(t=ts.sys.directoryExists(e),dirExistsCache.set(e,t)),t}.bind(void 0),readFile(e){return ts.sys.readFile(e)},realpath(e){return ts.sys.realpath(e)},trace(e){console.info(e)}},moduleResolutionHostTest=moduleResolutionHost;function resolveTypeReferenceDirectives(e){if(0===e.length)return[];var t=[],r=new Map,i=_path.default.join(_main.projectConfig.modulePath,"build-profile.json5");for(const n of e){var o,s=(0,_utils.isString)(n)?n:n.fileName.toLowerCase();r.has(s)||((o=ts.resolveTypeReferenceDirective(s,i,compilerOptions,moduleResolutionHost))&&o.resolvedTypeReferenceDirective||_compile_info.logger.error("[31m",`ArkTS:Cannot find type definition file for: ${s}
`),o=o.resolvedTypeReferenceDirective,r.set(s,o),t.push(o))}return t}exports.moduleResolutionHostTest=moduleResolutionHostTest;const resolvedModulesCache=new Map;function resolveModuleNames(e,t){(0,_utils.startTimeStatisticsLocation)(_utils.resolveModuleNamesTime);var r=[],i=resolvedModulesCache.get(_path.default.resolve(t));if([...shouldResolvedFiles].length&&!shouldResolvedFiles.has(_path.default.resolve(t))&&i&&i.length===e.length)return(0,_utils.stopTimeStatisticsLocation)(_utils.resolveModuleNamesTime),resolvedModulesCache.get(_path.default.resolve(t));for(const f of e){var o,s,n,a,l,c,d,u=ts.resolveModuleName(f,t,compilerOptions,moduleResolutionHost);if(u.resolvedModule)u.resolvedModule.resolvedFileName&&_path.default.extname(u.resolvedModule.resolvedFileName)===_pre_define.EXTNAME_JS&&(o=u.resolvedModule.resolvedFileName.replace(_pre_define.EXTNAME_JS,_pre_define.EXTNAME_D_ETS),ts.sys.fileExists(o))?r.push(getResolveModule(o,_pre_define.EXTNAME_D_ETS)):r.push(u.resolvedModule);else if(new RegExp(`^@(${_main.sdkConfigPrefix})\\.`,"i").test(f.trim())){let t=!1;for(let e=0;e<_main.sdkConfigs.length;e++){var p=_main.sdkConfigs[e],p=(0,_api_check_utils.getRealModulePath)(p.apiPath,f,[".d.ts",".d.ets"]),h=p.modulePath,p=p.isEts;if(_main.systemModules.includes(f+(p?".d.ets":".d.ts"))&&ts.sys.fileExists(h)){r.push(getResolveModule(h,p?".d.ets":".d.ts")),t=!0;break}}t||r.push(null)}else/\.ets$/.test(f)&&!/\.d\.ets$/.test(f)?(o=_path.default.resolve(_path.default.dirname(t),f),ts.sys.fileExists(o)?r.push(getResolveModule(o,".ets")):r.push(null)):/\.ts$/.test(f)?(u=_path.default.resolve(_path.default.dirname(t),f),ts.sys.fileExists(u)?r.push(getResolveModule(u,".ts")):r.push(null)):(u=_path.default.resolve(__dirname,"../../../api",f+".d.ts"),d=_path.default.resolve(__dirname,"../../../api",f+".d.ets"),s=_path.default.resolve(__dirname,"../../../kits",f+".d.ts"),n=_path.default.resolve(__dirname,"../../../kits",f+".d.ets"),a=/\.js$/.test(f)?"":".js",a=_path.default.resolve(__dirname,"../node_modules",f+a),l=_path.default.resolve(__dirname,"../node_modules",f+"/index.js"),c=_path.default.resolve(_path.default.dirname(t),/\.d\.ets$/.test(f)?f:f+_pre_define.EXTNAME_D_ETS),ts.sys.fileExists(u)?r.push(getResolveModule(u,".d.ts")):ts.sys.fileExists(d)?r.push(getResolveModule(d,".d.ets")):ts.sys.fileExists(s)?r.push(getResolveModule(s,".d.ts")):ts.sys.fileExists(n)?r.push(getResolveModule(n,".d.ets")):ts.sys.fileExists(a)?r.push(getResolveModule(a,".js")):ts.sys.fileExists(l)?r.push(getResolveModule(l,".js")):ts.sys.fileExists(c)?r.push(getResolveModule(c,".d.ets")):0<(u=_main.projectConfig.projectPath.indexOf("src"+_path.default.sep+"main"))&&(d=_path.default.resolve(_main.projectConfig.projectPath.substring(0,u),f+_path.default.sep+"index"+_pre_define.EXTNAME_D_ETS))&&ts.sys.fileExists(d)?r.push(getResolveModule(d,".d.ets")):r.push(null));_main.projectConfig.hotReload&&r.length&&r[r.length-1]&&hotReloadSupportFiles.add(_path.default.resolve(r[r.length-1].resolvedFileName)),collectShouldPackedFiles(r)&&allResolvedModules.add(r[r.length-1].resolvedFileName)}return _main.projectConfig.xtsMode||createOrUpdateCache(r,_path.default.resolve(t)),resolvedModulesCache.set(_path.default.resolve(t),r),(0,_utils.stopTimeStatisticsLocation)(_utils.resolveModuleNamesTime),r}function collectShouldPackedFiles(e){return(_main.projectConfig.compileHar||_main.projectConfig.compileShared)&&e[e.length-1]&&e[e.length-1].resolvedFileName&&(_path.default.resolve(e[e.length-1].resolvedFileName).match(/(\.[^d]|[^\.]d|[^\.][^d])\.e?ts$/)||_path.default.resolve(e[e.length-1].resolvedFileName).match(/\.d\.e?ts$/)&&_path.default.resolve(e[e.length-1].resolvedFileName).match(new RegExp("\\"+_path.default.sep+"src\\"+_path.default.sep+"main\\"+_path.default.sep)))}function createOrUpdateCache(e,i){var o=this;const s=[];e.forEach(function(e){var t,r;_newArrowCheck(this,o),e&&e.resolvedFileName&&/\.(ets|ts)$/.test(e.resolvedFileName)&&(e=_path.default.resolve(e.resolvedFileName),t=_fs.default.statSync(e).mtimeMs,s.push(e),(r=cache[e])?(r.mtimeMs=t,r.error=!1,r.parent=r.parent||[],r.parent.push(_path.default.resolve(i)),r.parent=[...new Set(r.parent)]):cache[e]={mtimeMs:t,children:[],parent:[i],error:!1})}.bind(this)),cache[_path.default.resolve(i)]={mtimeMs:_fs.default.statSync(i).mtimeMs,children:s,parent:cache[_path.default.resolve(i)]&&cache[_path.default.resolve(i)].parent?cache[_path.default.resolve(i)].parent:[],error:!1}}function createWatchCompilerHost(e,t,r,i,o=!1,s=null){var n=this,s=(_main.projectConfig.hotReload&&e.forEach(function(e){_newArrowCheck(this,n),hotReloadSupportFiles.add(e)}.bind(this)),o&&"rollup"===process.env.compileTool||setCompilerOptions(s),_path.default.resolve(_main.projectConfig.cachePath,"..",_pre_define.WATCH_COMPILER_BUILD_INFO_SUFFIX)),s={...compilerOptions,tsBuildInfoFile:s},a=ts.createSemanticDiagnosticsBuilderProgram,e=ts.createWatchCompilerHost([...e,...readDeaclareFiles()],s,ts.sys,a,t,function(e){_newArrowCheck(this,n),[6031,6032].includes(e.code)&&!o&&(process.env.watchTs="start",i()),[6193,6194].includes(e.code)&&(o||(process.env.watchTs="end",fastBuildLogger&&(fastBuildLogger.debug(_pre_define.TS_WATCH_END_MSG),_rollupPluginEtsChecker.tsWatchEmitter.emit(_pre_define.TS_WATCH_END_MSG))),r())}.bind(this));return e.readFile=function(e){if(_newArrowCheck(this,n),_fs.default.existsSync(e))return/(?<!\.d)\.(ets|ts)$/.test(e)?instanceInsteadThis(processContent(_fs.default.readFileSync(e).toString(),e),e,[],props):_fs.default.readFileSync(e).toString()}.bind(this),e.resolveModuleNames=resolveModuleNames,e.resolveTypeReferenceDirectives=resolveTypeReferenceDirectives,e}function watchChecker(e,t=null,r=null){var i=this;exports.fastBuildLogger=fastBuildLogger=t,_main.globalProgram.watchProgram=ts.createWatchProgram(createWatchCompilerHost(e,printDiagnostic,function(){_newArrowCheck(this,i)}.bind(this),function(){_newArrowCheck(this,i)}.bind(this),!1,r))}function instanceInsteadThis(t,e,r,i){var s=this;return checkUISyntax(t,e,r,i),r.reverse().forEach(function(i){var o=this;_newArrowCheck(this,s);var e=t.substring(i.start,i.end).replace(/(\s)\$(\.)/g,function(e,t,r){return _newArrowCheck(this,o),t+i.compName+"Instance"+r}.bind(this));t=t.slice(0,i.start)+e+t.slice(i.end)}.bind(this)),t}function getResolveModule(e,t){return{resolvedFileName:e,isExternalLibraryImport:!1,extension:t}}exports.resolvedModulesCache=resolvedModulesCache;const dollarCollection=new Set,extendCollection=(exports.dollarCollection=dollarCollection,new Set),importModuleCollection=(exports.extendCollection=extendCollection,new Set);function checkUISyntax(e,t,r,i){!/\.ets$/.test(t)||"moduleJson"!==process.env.compileMode&&_path.default.resolve(t)===_path.default.resolve(_main.projectConfig.projectPath,"app.ets")||(collectComponents(t=ts.createSourceFile(t,e,ts.ScriptTarget.Latest,!0,ts.ScriptKind.ETS,compilerOptions)),collectionCustomizeStyles(t),parseAllNode(t,t,r),i.push(...dollarCollection,...extendCollection))}function collectionCustomizeStyles(e){var t=this;(ts.isFunctionDeclaration(e)||ts.isMethodDeclaration(e))&&(isUIDecorator(e,_pre_define.COMPONENT_STYLES_DECORATOR)||isUIDecorator(e,_pre_define.COMPONENT_EXTEND_DECORATOR))&&e.name&&ts.isIdentifier(e.name)&&_component_map.BUILDIN_STYLE_NAMES.add(e.name.escapedText.toString()),ts.isSourceFile(e)?e.statements.forEach(function(e){return _newArrowCheck(this,t),collectionCustomizeStyles(e)}.bind(this)):ts.isStructDeclaration(e)&&e.members.forEach(function(e){return _newArrowCheck(this,t),collectionCustomizeStyles(e)}.bind(this))}function isUIDecorator(e,t){var r=ts.getAllDecorators(e);if(r&&r.length)for(let e=0;e<r.length;e++)return r[e].getText().replace(/\(.*\)$/,"").trim()===t;return!1}function collectComponents(e){if("true"!==process.env.watchMode&&e.identifiers&&e.identifiers.size)for(const t of e.identifiers.keys())_component_map.JS_BIND_COMPONENTS.has(t)&&appComponentCollection.get(_path.default.join(e.fileName)).add(t)}function parseAllNode(e,t,r){var o=this;ts.isStructDeclaration(e)&&e.members&&e.members.forEach(function(e){if(_newArrowCheck(this,o),ts.isPropertyDeclaration(e)&&ts.isIdentifier(e.name)){var t=e.name.getText(),r=ts.getAllDecorators(e);if(r&&r.length)for(let e=0;e<r.length;e++){var i=r[e].getText().replace(/\(.*\)$/,"").trim();_pre_define.INNER_COMPONENT_MEMBER_DECORATORS.has(i)&&dollarCollection.add("$"+t)}}}.bind(this)),"true"!==process.env.watchMode&&ts.isIfStatement(e)&&appComponentCollection.get(_path.default.join(t.fileName)).add(_pre_define.COMPONENT_IF),(ts.isMethodDeclaration(e)&&e.name.getText()===_pre_define.COMPONENT_BUILD_FUNCTION||(ts.isMethodDeclaration(e)||ts.isFunctionDeclaration(e))&&(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_BUILDER_DECORATOR))&&e.body&&e.body.statements&&e.body.statements.length&&e.body.statements.forEach(function(e,t){_newArrowCheck(this,o),traverseBuild(e,t)}.bind(this)),ts.isFunctionDeclaration(e)&&(0,_utils.hasDecorator)(e,_pre_define.COMPONENT_EXTEND_DECORATOR)&&e.body&&e.body.statements&&e.body.statements.length&&!(0,_process_ui_syntax.isOriginalExtend)(e.body)&&r.push({start:e.pos,end:e.end,compName:(0,_process_ui_syntax.isExtendFunction)(e,{decoratorName:"",componentName:""})}),ts.forEachChild(e,function(e){return _newArrowCheck(this,o),parseAllNode(e,t,r)}.bind(this))}function isForeachAndLzayForEach(e){return ts.isCallExpression(e)&&e.expression&&ts.isIdentifier(e.expression)&&_pre_define.FOREACH_LAZYFOREACH.has(e.expression.escapedText.toString())&&e.arguments&&e.arguments[1]&&ts.isArrowFunction(e.arguments[1])&&e.arguments[1].body&&ts.isBlock(e.arguments[1].body)}function getComponentName(e){let t=e.expression,r;for(;t;){if(ts.isIdentifier(t)&&t.parent&&(ts.isCallExpression(t.parent)||ts.isEtsComponentExpression(t.parent))){r=t.escapedText.toString();break}t=t.expression}return r}function traverseBuild(e,t){var r=this;if(ts.isExpressionStatement(e)){var i=getComponentName(e);for(e=e.expression;e;){if(ts.isEtsComponentExpression(e)&&e.body&&ts.isBlock(e.body)&&ts.isIdentifier(e.expression)&&!_pre_define.DOLLAR_BLOCK_INTERFACE.has(e.expression.escapedText.toString())){e.body.statements.forEach(function(e,t){_newArrowCheck(this,r),traverseBuild(e,t)}.bind(this));break}if(isForeachAndLzayForEach(e)){e.arguments[1].body.statements.forEach(function(e,t){_newArrowCheck(this,r),traverseBuild(e,t)}.bind(this));break}if(loopNodeFindDoubleDollar(e,i),ts.isEtsComponentExpression(e)&&e.body&&ts.isBlock(e.body)&&ts.isIdentifier(e.expression)){e.body.statements.forEach(function(e,t){_newArrowCheck(this,r),traverseBuild(e,t)}.bind(this));break}e=e.expression}}else ts.isIfStatement(e)&&ifInnerDollarAttribute(e)}function ifInnerDollarAttribute(e){var r=this;e.thenStatement&&ts.isBlock(e.thenStatement)&&e.thenStatement.statements&&e.thenStatement.statements.forEach(function(e,t){_newArrowCheck(this,r),traverseBuild(e,t)}.bind(this)),e.elseStatement&&elseInnerDollarAttribute(e)}function elseInnerDollarAttribute(e){var r=this;ts.isIfStatement(e.elseStatement)&&e.elseStatement.thenStatement&&ts.isBlock(e.elseStatement.thenStatement)?traverseBuild(e.elseStatement,0):ts.isBlock(e.elseStatement)&&e.elseStatement.statements&&e.elseStatement.statements.forEach(function(e,t){_newArrowCheck(this,r),traverseBuild(e,t)}.bind(this))}function isPropertiesAddDoubleDollar(e){return!!(ts.isCallExpression(e)&&ts.isIdentifier(e.expression)&&e.arguments&&e.arguments.length)||!!(ts.isEtsComponentExpression(e)&&ts.isIdentifier(e.expression)&&_pre_define.DOLLAR_BLOCK_INTERFACE.has(e.expression.escapedText.toString()))}function loopNodeFindDoubleDollar(r,i){var e,o=this;ts.isCallExpression(r)&&ts.isPropertyAccessExpression(r.expression)?(e=r.arguments,isCanAddDoubleDollar(r.expression.name.getText(),i)&&e.forEach(function(e){_newArrowCheck(this,o),doubleDollarCollection(e)}.bind(this))):isPropertiesAddDoubleDollar(r)&&r.arguments.forEach(function(e){var t=this;_newArrowCheck(this,o),ts.isObjectLiteralExpression(e)&&e.properties&&e.properties.length?e.properties.forEach(function(e){_newArrowCheck(this,t),isObjectPram(e,i)&&doubleDollarCollection(e.initializer)}.bind(this)):ts.isPropertyAccessExpression(e)&&(handleComponentDollarBlock(r,i)||_pre_define.STYLE_ADD_DOUBLE_DOLLAR.has(r.expression.getText()))&&doubleDollarCollection(e)}.bind(this))}function handleComponentDollarBlock(e,t){return ts.isCallExpression(e)&&ts.isIdentifier(e.expression)&&_pre_define.DOLLAR_BLOCK_INTERFACE.has(t)&&_pre_define.PROPERTIES_ADD_DOUBLE_DOLLAR.has(t)&&_pre_define.PROPERTIES_ADD_DOUBLE_DOLLAR.get(t).has(e.expression.escapedText.toString())}function doubleDollarCollection(e){if(e.getText().startsWith(_pre_define.$$)){for(;e.expression;)e=e.expression;dollarCollection.add(e.getText())}}function isObjectPram(e,t){return ts.isPropertyAssignment(e)&&e.name&&ts.isIdentifier(e.name)&&e.initializer&&_pre_define.PROPERTIES_ADD_DOUBLE_DOLLAR.has(t)&&_pre_define.PROPERTIES_ADD_DOUBLE_DOLLAR.get(t).has(e.name.getText())}function isCanAddDoubleDollar(e,t){return _pre_define.PROPERTIES_ADD_DOUBLE_DOLLAR.has(t)&&_pre_define.PROPERTIES_ADD_DOUBLE_DOLLAR.get(t).has(e)||_pre_define.STYLE_ADD_DOUBLE_DOLLAR.has(e)}function processContent(e,t){return fastBuildLogger&&(e=(0,_process_visual.visualTransform)(e,t,fastBuildLogger)),e=(0,_validate_ui_syntax.preprocessExtend)(e,extendCollection),e=(0,_validate_ui_syntax.preprocessNewExtend)(e,extendCollection)}function judgeFileShouldResolved(e,t){var r=this;t.has(e)||(t.add(e),cache&&cache[e]&&cache[e].parent&&(cache[e].parent.forEach(function(e){_newArrowCheck(this,r),judgeFileShouldResolved(e,t)}.bind(this)),cache[e].parent=[]),cache&&cache[e]&&cache[e].children&&(cache[e].children.forEach(function(e){_newArrowCheck(this,r),judgeFileShouldResolved(e,t)}.bind(this)),cache[e].children=[]))}function incrementWatchFile(e,t){var r=this,e=[...e,...t];e.length&&shouldResolvedFiles.clear(),e.forEach(function(e){_newArrowCheck(this,r),judgeFileShouldResolved(e,shouldResolvedFiles)}.bind(this))}function runArkTSLinter(){var t=this,e=_main.globalProgram.builderProgram,r=ts.ArkTSLinterTimePrinter.getInstance(),e=(0,_do_arkTS_linter.doArkTSLinter)(getArkTSVersion(),getArkTSLinterMode(),e,printArkTSLinterDiagnostic,!_main.projectConfig.xtsMode,buildInfoWriteFile);"true"===process.env.watchMode||_main.projectConfig.xtsMode||(e.forEach(function(e){_newArrowCheck(this,t),updateErrorFileCache(e)}.bind(this)),r.appendTime(ts.TimePhase.UPDATE_ERROR_FILE)),r.printTimes(),ts.ArkTSLinterTimePrinter.destroyInstance()}function printArkTSLinterDiagnostic(e){var t;e.category===ts.DiagnosticCategory.Error&&(isInOhModuleFile(e)||isEtsDeclFileInSdk(e))?(t=e.category,e.category=ts.DiagnosticCategory.Warning,printDiagnostic(e),e.category=t):printDiagnostic(e)}function isEtsDeclFileInSdk(e){return void 0!==e.file?.fileName&&isInSDK(e.file.fileName)&&e.file.fileName.endsWith(".ets")}function isInOhModuleFile(e){return void 0!==e.file&&(-1!==e.file.fileName.indexOf("/oh_modules/")||-1!==e.file.fileName.indexOf("\\oh_modules\\"))}function isInSDK(e){var t;return void 0!==_main.projectConfig.etsLoaderPath&&void 0!==e&&(t=_path.default.resolve(_main.projectConfig.etsLoaderPath,"../../../"),_path.default.resolve(e).startsWith(t))}function getArkTSLinterMode(){return _main.partialUpdateConfig.executeArkTSLinter?_main.partialUpdateConfig.standardArkTSLinter&&isStandardMode()?_do_arkTS_linter.ArkTSLinterMode.STANDARD_MODE:_do_arkTS_linter.ArkTSLinterMode.COMPATIBLE_MODE:_do_arkTS_linter.ArkTSLinterMode.NOT_USE}function isStandardMode(){return!!(_main.projectConfig&&_main.projectConfig.compatibleSdkVersion&&10<=_main.projectConfig.compatibleSdkVersion)}function getArkTSVersion(){if("1.0"===_main.projectConfig.arkTSVersion)return _do_arkTS_linter.ArkTSVersion.ArkTS_1_0;if("1.1"!==_main.projectConfig.arkTSVersion){if(void 0!==_main.projectConfig.arkTSVersion&&(fastBuildLogger||_compile_info.logger).warn("[33mArkTS: Invalid ArkTS version\n"),"1.0"===_main.partialUpdateConfig.arkTSVersion)return _do_arkTS_linter.ArkTSVersion.ArkTS_1_0;"1.1"!==_main.partialUpdateConfig.arkTSVersion&&void 0!==_main.partialUpdateConfig.arkTSVersion&&(fastBuildLogger||_compile_info.logger).warn("[33mArkTS: Invalid ArkTS version in metadata\n")}return _do_arkTS_linter.ArkTSVersion.ArkTS_1_1}exports.importModuleCollection=importModuleCollection;var TargetESVersion=function(e){return e.ES2017="ES2017",e.ES2021="ES2021",e}(TargetESVersion||{});function getTargetESVersion(){var e=_main.projectConfig?.projectArkOption?.tscConfig?.targetESVersion;return"ES2017"===e?TargetESVersion.ES2017:("ES2021"!==e&&void 0!==e&&(fastBuildLogger||_compile_info.logger).warn("[33mArkTS: Invalid Target ES version\n"),TargetESVersion.ES2021)}const targetESVersionLib={ES2017:["ES2020"],ES2021:["ES2021"]};function getTargetESVersionLib(){var e=_main.projectConfig?.projectArkOption?.tscConfig?.targetESVersion;return"ES2017"===e?targetESVersionLib.ES2017:("ES2021"!==e&&void 0!==e&&(fastBuildLogger||_compile_info.logger).warn("[33mArkTS: Invalid Target ES version\n"),targetESVersionLib.ES2021)}function initEtsStandaloneCheckerConfig(e,t){exports.fastBuildLogger=fastBuildLogger=e,"ohpm"===t.packageManagerType?(t.packageDir="oh_modules",t.packageJson="oh-package.json5"):(t.packageDir="node_modules",t.packageJson="package.json"),t.aceModuleJsonPath&&_fs.default.existsSync(t.aceModuleJsonPath)&&(process.env.compileMode="moduleJson"),Object.assign(_main.projectConfig,t)}function resetEtsStandaloneCheckerConfig(e,t){(0,_main.resetProjectConfig)(),resetEtsCheck(),exports.fastBuildLogger=fastBuildLogger=e,process.env.compileMode=t}function etsStandaloneChecker(e,t,r){var i=this,o=fastBuildLogger,s=process.env.compileMode;initEtsStandaloneCheckerConfig(t,r);const n=[];t=[],Object.values(e).forEach(function(e){_newArrowCheck(this,i),n.push(_path.default.resolve(e))}.bind(this)),r.resolveModulePaths&&Array.isArray(r.resolveModulePaths)&&t.push(...r.resolveModulePaths),e=filterInput(n),exports.languageService=languageService=createLanguageService(e,t),r=ts.ArkTSLinterTimePrinter.getInstance(),r.setArkTSTimePrintSwitch(!1),r.appendTime(ts.TimePhase.START),_main.globalProgram.builderProgram=languageService.getBuilderProgram(!0),_main.globalProgram.program=_main.globalProgram.builderProgram.getProgram(),exports.props=props=languageService.getProps(),r.appendTime(ts.TimePhase.GET_PROGRAM),collectFileToIgnoreDiagnostics(e),runArkTSLinter(),t=_main.globalProgram.builderProgram.getSyntacticDiagnostics().concat(_main.globalProgram.builderProgram.getSemanticDiagnostics());_main.globalProgram.builderProgram.emitBuildInfo(buildInfoWriteFile),t.forEach(function(e){_newArrowCheck(this,i),printDiagnostic(e)}.bind(this)),resetEtsStandaloneCheckerConfig(o,s)}function resetEtsCheckTypeScript(){_main.globalProgram.program?_main.globalProgram.program.releaseTypeChecker():languageService&&languageService.getProgram().releaseTypeChecker(),(0,_main.resetGlobalProgram)(),exports.languageService=languageService=null}function resetEtsCheck(){exports.cache=cache={},exports.props=props=[],exports.needReCheckForChangedDepUsers=needReCheckForChangedDepUsers=!1,resetEtsCheckTypeScript(),allResolvedModules.clear(),checkerResult.count=0,warnCheckerResult.count=0,resolvedModulesCache.clear(),dollarCollection.clear(),extendCollection.clear(),allSourceFilePaths.clear(),allModuleIds.clear(),filesBuildInfo.clear(),fileExistsCache.clear(),dirExistsCache.clear(),exports.targetESVersionChanged=targetESVersionChanged=!1,fileToIgnoreDiagnostics=void 0}