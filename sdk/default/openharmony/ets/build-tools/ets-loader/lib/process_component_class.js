"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addRerenderFunc=addRerenderFunc,exports.checkContextStack=checkContextStack,exports.checkFinalizeConstruction=checkFinalizeConstruction,exports.contextStackPushOrPop=contextStackPushOrPop,exports.createParentParameter=createParentParameter,exports.createReference=createReference,exports.decoratorAssignParams=decoratorAssignParams,exports.getEntryNameFunction=getEntryNameFunction,exports.isBuilderOrLocalBuilder=isBuilderOrLocalBuilder,exports.isProperty=isProperty,exports.isRegularProperty=isRegularProperty,exports.processBuildMember=processBuildMember,exports.processComponentClass=processComponentClass,exports.processComponentMethod=processComponentMethod,exports.updateHeritageClauses=updateHeritageClauses,exports.validateBuildMethodCount=validateBuildMethodCount;var _typescript=_interopRequireDefault(require("typescript")),_pre_define=require("./pre_define"),_component_map=require("./component_map"),_validate_ui_syntax=require("./validate_ui_syntax"),_process_component_constructor=require("./process_component_constructor"),_process_component_member=require("./process_component_member"),_process_component_build=require("./process_component_build"),_utils=require("./utils"),_main=require("../main"),_process_ui_syntax=require("./process_ui_syntax"),_constant_define=_interopRequireDefault(require("./constant_define")),_process_struct_componentV=_interopRequireDefault(require("./process_struct_componentV2"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function processComponentClass(e,t,r,a){var i=_typescript.default.getAllDecorators(e),t=processMembers(e.members,e.name,t,i,r,a,checkPreview(e));return _typescript.default.factory.createClassDeclaration(_typescript.default.getModifiers(e),e.name,e.typeParameters,updateHeritageClauses(e,r),t)}function checkPreview(e){let t=!1;var r=_typescript.default.getAllDecorators(e);if(e&&r)for(let e=0;e<r.length;e++)if(r[e].getText().replace(/\([^\(\)]*\)/,"").trim()===_pre_define.COMPONENT_DECORATOR_PREVIEW){t=!0;break}return t}function processMembers(e,a,i,t,p,c,o){var n=this;const s={count:0};let _=(0,_process_component_constructor.getInitConstructor)(e,a);const d=[],f=new Map,l=[],y=[],u=[];const E=[],T={hasController:!_validate_ui_syntax.componentCollection.customDialogs.has(a.getText())},O=_typescript.default.factory.createInterfaceDeclaration(void 0,a.getText()+_pre_define.INTERFACE_NAME_SUFFIX,void 0,void 0,[]);return e.forEach(function(e){_newArrowCheck(this,n);let t;var r;_typescript.default.isPropertyDeclaration(e)&&(isStaticProperty(e)?(d.push(e),validateDecorators(e,p)):(addPropertyMember(e,d,c,a.getText(),p),r=(0,_process_component_member.processMemberVariableDecorators)(a,e,_,f,T,p,c,i,o,O),t=r.isItemUpdate()?r.getProperity():e,r.getVariableGet()&&d.push(r.getVariableGet()),r.getVariableSet()&&d.push(r.getVariableSet()),r.isCtorUpdate()&&(_=r.getCtor()),r.getUpdateParams()&&l.push(r.getUpdateParams()),r.getStateVarsParams()&&y.push(r.getStateVarsParams()),r.isDeleteParams()&&E.push(e),r.getControllerSet()&&d.push(r.getControllerSet()),processPropertyUnchanged(r,u))),(t=_typescript.default.isMethodDeclaration(e)&&e.name?processComponentMethod(e,i,p,s):t)&&d.push(t)}.bind(this)),_component_map.INTERFACE_NODE_SET.add(O),validateBuildMethodCount(s,a,p),validateHasController(a,T,p),_utils.storedFileInfo.getCurrentArkTsFile().recycleComponents.has(a.getText())&&d.unshift(addDeleteParamsFunc(E,!0)),d.unshift(addDeleteParamsFunc(E)),addIntoNewMembers(d,a,l,u,[],y),_main.partialUpdateConfig.partialUpdateMode&&(t=decoratorAssignParams(t,i,e={componentFreezeParam:void 0}),_=(0,_process_component_constructor.updateConstructor)(_,[],assignParams(a.getText()),t?decoratorComponentParam(e):[],!0)),d.unshift((0,_process_component_constructor.addConstructor)(_,f,a)),_validate_ui_syntax.componentCollection.entryComponent===a.escapedText.toString()&&_main.partialUpdateConfig.partialUpdateMode&&10<_main.projectConfig.minAPIVersion&&d.push(getEntryNameFunction(_validate_ui_syntax.componentCollection.entryComponent)),p.push(...Array.from(_process_component_member.PropMapManager.logInfoMap.values()).flat()),_process_component_member.PropMapManager.reset(),d}function decoratorAssignParams(e,t,r){var a=this;return!!(e&&Array.isArray(e)&&e.length)&&e.some(function(e){return _newArrowCheck(this,a),!!isFreezeComponents(e,t,r)}.bind(this))}function isFreezeComponents(e,r,a){let i=!1;return _typescript.default.visitNode(e,function e(t){if(_typescript.default.isPropertyAssignment(t)&&t.name&&t.name.text&&t.name.text.toString()===_pre_define.DECORATOR_COMPONENT_FREEZEWHENINACTIVE)return i=!0,a.componentFreezeParam=t.initializer,t;return _typescript.default.visitEachChild(t,e,r)}),i}function getEntryNameFunction(e){return _typescript.default.factory.createMethodDeclaration([_typescript.default.factory.createToken(_typescript.default.SyntaxKind.StaticKeyword)],void 0,_typescript.default.factory.createIdentifier(_pre_define.GET_ENTRYNAME),void 0,void 0,[],_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.StringKeyword),_typescript.default.factory.createBlock([_typescript.default.factory.createReturnStatement(_typescript.default.factory.createStringLiteral(e))],!0))}function assignParams(e){return[_typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createTypeOfExpression(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_PARAMS_LAMBDA_FUNCTION)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsEqualsEqualsToken),_typescript.default.factory.createStringLiteral(_pre_define.FUNCTION)),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_PARAMS_FUNCTION)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_PARAMS_LAMBDA_FUNCTION)))],!0))]}function decoratorComponentParam(e){return[_typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createElementAccessExpression(_typescript.default.factory.createSuper(),_typescript.default.factory.createStringLiteral(_pre_define.INIT_ALLOW_COMPONENT_FREEZE)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.AmpersandAmpersandToken),_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createTypeOfExpression(_typescript.default.factory.createElementAccessExpression(_typescript.default.factory.createSuper(),_typescript.default.factory.createStringLiteral(_pre_define.INIT_ALLOW_COMPONENT_FREEZE))),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsEqualsEqualsToken),_typescript.default.factory.createStringLiteral(_pre_define.FUNCTION))),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createElementAccessExpression(_typescript.default.factory.createSuper(),_typescript.default.factory.createStringLiteral(_pre_define.INIT_ALLOW_COMPONENT_FREEZE)),void 0,[e.componentFreezeParam]))],!0),void 0)]}function isStaticProperty(e){var t=this,e=_typescript.default.canHaveModifiers(e)?_typescript.default.getModifiers(e):void 0;return e&&e.length&&e.some(function(e){return _newArrowCheck(this,t),e.kind===_typescript.default.SyntaxKind.StaticKeyword}.bind(this))}function validateDecorators(t,r){var a=this,e=_typescript.default.getAllDecorators(t);e&&e.length&&e.map(function(e){_newArrowCheck(this,a);e=e.getText();_pre_define.INNER_COMPONENT_MEMBER_DECORATORS.has(e)&&r.push({type:_utils.LogType.ERROR,message:"The static variable of struct cannot be used together with built-in decorators.",pos:t.getStart()})}.bind(this))}function processPropertyUnchanged(e,t){_main.partialUpdateConfig.partialUpdateMode&&e.getPurgeVariableDepStatement()&&t.push(e.getPurgeVariableDepStatement())}function addIntoNewMembers(e,t,r,a,i,p){_main.partialUpdateConfig.partialUpdateMode?(e.unshift(addInitialParamsFunc(r,t),addUpdateStateVarsFunc(p,t),addPurgeVariableDepFunc(a)),e.push(addRerenderFunc(i))):e.unshift(addUpdateParamsFunc(r,t))}function isRegularProperty(e){return!e||!e.length||1===e.length&&e[0].getText()===_pre_define.COMPONENT_REQUIRE_DECORATOR}function addPropertyMember(e,t,a,i,p){var c,o=e;let n;var s=o.type,_=_typescript.default.getAllDecorators(o);if(isRegularProperty(_))n=createPropertyDeclaration(o,s,!0),t.push(n);else{for(let r=0;r<_.length;r++){let e,t=(c=_[r].getText().replace(/\(.*\)$/,"").trim(),!1);e=(_main.partialUpdateConfig.partialUpdateMode?createTypeReferencePU:createTypeReference)(c,s,p,a),c!==_pre_define.COMPONENT_LOCAL_STORAGE_LINK_DECORATOR&&c!==_pre_define.COMPONENT_LOCAL_STORAGE_PROP_DECORATOR||(t=!0);var d=createPropertyDeclaration(o,e,!1,t,i);(!n||_pre_define.INNER_COMPONENT_MEMBER_DECORATORS.has(c)&&![_pre_define.COMPONENT_WATCH_DECORATOR,_pre_define.COMPONENT_REQUIRE_DECORATOR].includes(c))&&(n=d)}n&&t.push(n)}}function createPropertyDeclaration(e,t,r,a=!1,i=null){let p="";r||(p="__");var r=_typescript.default.factory.createModifier(_typescript.default.SyntaxKind.PrivateKeyword),c=_typescript.default.canHaveModifiers(e)?_typescript.default.getModifiers(e):void 0;return _typescript.default.factory.updatePropertyDeclaration(e,_typescript.default.concatenateDecoratorsAndModifiers(void 0,c||[r]),p+e.name.getText(),e.questionToken,t,a?createLocalStroageCallExpression(e,e.name.getText(),i):void 0)}function createLocalStroageCallExpression(t,r,a){var i=_typescript.default.getAllDecorators(t);if((0,_process_component_member.isSingleKey)(t)){var p=_validate_ui_syntax.localStorageLinkCollection.get(a).get(r),a=_validate_ui_syntax.localStoragePropCollection.get(a).get(r);let e;i=[i[(0,_process_component_member.findDecoratorIndex)(i,[_pre_define.COMPONENT_LOCAL_STORAGE_LINK_DECORATOR,_pre_define.COMPONENT_LOCAL_STORAGE_PROP_DECORATOR])].expression.arguments[0],t.initializer||_typescript.default.factory.createNumericLiteral(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED),_typescript.default.factory.createThis(),_typescript.default.factory.createStringLiteral(r||_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED)];return _main.partialUpdateConfig.partialUpdateMode?(e=p&&!a?_pre_define.CREATE_LOCAL_STORAGE_LINK:_pre_define.CREATE_LOCAL_STORAGE_PROP,i.splice(-2,1)):e=p&&!a?_pre_define.COMPONENT_SET_AND_LINK:_pre_define.COMPONENT_SET_AND_PROP,_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_main.partialUpdateConfig.partialUpdateMode?_typescript.default.factory.createThis():_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_LOCALSTORAGE+"_")),_typescript.default.factory.createIdentifier(e)),[t.type],i)}}function processComponentMethod(e,t,r,a){let i=e;var p=e.name.getText(),c=[],o={isBuilder:!1,isLocalBuilder:!1};if(_validate_ui_syntax.builderParamObjectCollection.get(_validate_ui_syntax.componentCollection.currentClassName)?_utils.storedFileInfo.builderLikeCollection=new Set([..._validate_ui_syntax.builderParamObjectCollection.get(_validate_ui_syntax.componentCollection.currentClassName),..._component_map.CUSTOM_BUILDER_METHOD]):_utils.storedFileInfo.builderLikeCollection=_component_map.CUSTOM_BUILDER_METHOD,p===_pre_define.COMPONENT_BUILD_FUNCTION){_utils.storedFileInfo.processBuilder=!1,_utils.storedFileInfo.processGlobalBuilder=!1,a.count=a.count+1,e.parameters.length&&r.push({type:_utils.LogType.ERROR,message:"The 'build' method can not have arguments.",pos:e.getStart()});a=(0,_process_component_build.processComponentBuild)(e,r);i=processBuildMember(a,t,r)}else if(e.body&&_typescript.default.isBlock(e.body))if(p===_pre_define.COMPONENT_TRANSITION_FUNCTION)i=_typescript.default.factory.updateMethodDeclaration(e,_typescript.default.getModifiers(e),e.asteriskToken,e.name,e.questionToken,e.typeParameters,e.parameters,e.type,(0,_process_component_build.processComponentBlock)(e.body,!1,r,!0));else if(isBuilderOrLocalBuilder(e,o,c)){_utils.storedFileInfo.processBuilder=!0,_utils.storedFileInfo.processGlobalBuilder=!1,o.isLocalBuilder&&(_utils.storedFileInfo.processLocalBuilder=!0),_component_map.CUSTOM_BUILDER_METHOD.add(p),_component_map.INNER_CUSTOM_BUILDER_METHOD.add(p),_process_ui_syntax.builderTypeParameter.params=(0,_utils.getPossibleBuilderTypeParameter)(e.parameters);var a=_typescript.default.factory.createNodeArray(Array.from(e.parameters)),n=(o.isLocalBuilder||a.push(createParentParameter()),_main.projectConfig.optLazyForEach&&a.push((0,_process_ui_syntax.initializeMYIDS)()),_typescript.default.canHaveModifiers(e)?_typescript.default.getModifiers(e):void 0),s=(0,_process_component_build.processComponentBlock)(e.body,!1,r,!1,!0),c=(_main.partialUpdateConfig.partialUpdateMode&&o.isLocalBuilder&&e.body.statements.length&&s.statements.unshift((0,_process_ui_syntax.globalBuilderParamAssignment)()),_typescript.default.factory.updateMethodDeclaration(e,_typescript.default.concatenateDecoratorsAndModifiers((0,_utils.removeDecorator)(c,"Builder"),n),e.asteriskToken,e.name,e.questionToken,e.typeParameters,a,e.type,s));_process_ui_syntax.builderTypeParameter.params=[],i=processBuildMember(c,t,r,!0),o.isLocalBuilder&&(checkDecoratorMethod(e,n,r),i=localBuilderNode(e,i.body)),_utils.storedFileInfo.processBuilder=!1,_utils.storedFileInfo.processLocalBuilder=!1}else if((0,_utils.hasDecorator)(e,_pre_define.COMPONENT_STYLES_DECORATOR))return void(e.parameters&&0===e.parameters.length?_typescript.default.isBlock(e.body)&&e.body.statements&&e.body.statements.length&&(_component_map.INNER_STYLE_FUNCTION.set(p,e.body),_component_map.STYLES_ATTRIBUTE.add(p),_component_map.BUILDIN_STYLE_NAMES.add(p),_process_component_member.decoratorParamSet.add(_pre_define.STYLES)):r.push({type:_utils.LogType.ERROR,message:"@Styles can't have parameters.",pos:e.getStart()}));return i}function checkDecoratorMethod(t,r,a){if(r&&r.length)for(let e=0;e<r.length;e++)if(r[e].kind&&r[e].kind===_typescript.default.SyntaxKind.StaticKeyword)return void a.push({type:_utils.LogType.ERROR,message:"Static methods in custom components cannot be decorated by @LocalBuilder.",pos:t.getStart()})}function isBuilderOrLocalBuilder(e,t,r=void 0){var a=_typescript.default.getAllDecorators(e);if(a&&a.length)for(let e=0;e<a.length;e++){var i=a[e].getText().replace(/\(.*\)$/,"").replace(/\s*/g,"").trim();if([_pre_define.COMPONENT_LOCAL_BUILDER_DECORATOR,_pre_define.COMPONENT_BUILDER_DECORATOR].includes(i))return i===_pre_define.COMPONENT_BUILDER_DECORATOR?(t.isBuilder=!0,r&&r.push(...a.slice(e+1),...a.slice(0,e))):t.isLocalBuilder=!0,!0}return!1}function localBuilderNode(e,t){return _typescript.default.factory.createPropertyDeclaration(void 0,e.name,void 0,void 0,_typescript.default.factory.createArrowFunction(void 0,void 0,e.parameters||[],void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),t))}function createParentParameter(){return _typescript.default.factory.createParameterDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_PARENT),void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.NULL))}function processBuildMember(e,r,a,i=!1){return _typescript.default.visitNode(e,function e(t){isGeometryView(t)&&(t=processGeometryView(t,a));isProperty(t)&&(t=createReference(t,a,i));if(isNeedGetRawObject(t))return _typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.FOREACH_OBSERVED_OBJECT),_typescript.default.factory.createIdentifier(_pre_define.FOREACH_GET_RAW_OBJECT)),void 0,[t]);return _typescript.default.visitEachChild(t,e,r)})}function checkStateName(e){return e.expression&&!e.expression.expression&&e.name&&_typescript.default.isIdentifier(e.name)?e.name.escapedText.toString():null}function isNeedGetRawObject(e){return!isInComponentV2Context()&&_typescript.default.isPropertyAccessExpression(e)&&_typescript.default.isIdentifier(e.name)&&_process_component_member.stateObjectCollection.has(checkStateName(e))&&e.parent&&_typescript.default.isCallExpression(e.parent)&&_typescript.default.isPropertyAccessExpression(e.parent.expression)&&e!==e.parent.expression&&e.parent.expression.name.escapedText.toString()!==_pre_define.FOREACH_GET_RAW_OBJECT}function isInComponentV2Context(){return!!_validate_ui_syntax.componentCollection.currentClassName&&_process_struct_componentV.default.getOrCreateStructInfo(_validate_ui_syntax.componentCollection.currentClassName).isComponentV2}function isGeometryView(e){if(_typescript.default.isExpressionStatement(e)&&_typescript.default.isCallExpression(e.expression)){var e=e.expression,t=e.expression,e=e.arguments;if(_typescript.default.isPropertyAccessExpression(t)&&_typescript.default.isIdentifier(t.expression)&&t.expression.escapedText.toString()===_pre_define.GEOMETRY_VIEW&&_typescript.default.isIdentifier(t.name)&&t.name.escapedText.toString()===_pre_define.COMPONENT_CREATE_FUNCTION&&e&&1===e.length&&(_typescript.default.isArrowFunction(e[0])||_typescript.default.isFunctionExpression(e[0])))return!0}return!1}function processGeometryView(e,t){var r=e.expression,a=r.arguments[0];return _typescript.default.factory.updateExpressionStatement(e,_typescript.default.factory.updateCallExpression(r,r.expression,void 0,[_typescript.default.factory.createArrowFunction(void 0,void 0,a.parameters,void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),getGeometryReaderFunctionBlock(a,t))]))}function getGeometryReaderFunctionBlock(e,t){let r;return _typescript.default.isBlock(e.body)?r=e.body:_typescript.default.isArrowFunction(e)&&_typescript.default.isCallExpression(e.body)&&(r=_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(e.body)])),(0,_process_component_build.processComponentBlock)(r,!1,t)}function updateHeritageClauses(e,t,r=!1){e.heritageClauses&&!checkHeritageClauses(e)&&t.push({type:_utils.LogType.ERROR,message:"The struct component is not allowed to extends other class or implements other interface.",pos:e.heritageClauses.pos});t=[],e=createHeritageClause(r);return t.push(e),_typescript.default.factory.createNodeArray(t)}function checkHeritageClauses(e){if(1===e.heritageClauses.length&&e.heritageClauses[0].types&&1===e.heritageClauses[0].types.length){e=e.heritageClauses[0].types[0];if(e.expression&&_typescript.default.isIdentifier(e.expression)&&e.expression.escapedText.toString()===_pre_define.CUSTOM_COMPONENT)return!0}return!1}function isProperty(e){if(judgmentParentType(e)){if(e.parent.parent.expression&&_typescript.default.isIdentifier(e.parent.parent.expression)&&!_component_map.BUILDIN_STYLE_NAMES.has(e.parent.parent.expression.escapedText.toString())&&_validate_ui_syntax.componentCollection.customComponents.has(e.parent.parent.expression.escapedText.toString()))return!0;if(_typescript.default.isPropertyAccessExpression(e.parent.parent.expression)&&_typescript.default.isIdentifier(e.parent.parent.expression.expression)&&_validate_ui_syntax.componentCollection.customComponents.has(e.parent.parent.expression.name.escapedText.toString()))return!0}return!1}function judgmentParentType(e){return _typescript.default.isPropertyAssignment(e)&&e.name&&_typescript.default.isIdentifier(e.name)&&e.parent&&_typescript.default.isObjectLiteralExpression(e.parent)&&e.parent.parent&&(_typescript.default.isCallExpression(e.parent.parent)||_typescript.default.isEtsComponentExpression(e.parent.parent))}function createReference(t,e,r=!1,a=!1,i=!1){var p=getParentNode(t,_validate_ui_syntax.linkCollection).slice(1),c=t.name;let o;var n=/^\$/g;if(!i||!_typescript.default.isShorthandPropertyAssignment(t)){var s=t.initializer;let e=!1;_typescript.default.isIdentifier(s)&&s.escapedText.toString().match(n)?o=s.escapedText.toString().replace(n,""):_typescript.default.isPropertyAccessExpression(s)&&s.expression&&s.expression.kind===_typescript.default.SyntaxKind.ThisKeyword&&_typescript.default.isIdentifier(s.name)&&s.name.escapedText.toString().match(n)?o=s.name.escapedText.toString().replace(n,""):r&&_typescript.default.isPropertyAccessExpression(s)&&s.expression&&_typescript.default.isIdentifier(s.expression)&&s.expression.escapedText.toString()===_pre_define.$$&&_typescript.default.isIdentifier(s.name)&&p.includes(c.escapedText.toString())?(e=!0,o=s.name.escapedText.toString()):isMatchInitExpression(s)&&p.includes(c.escapedText.toString())&&(o=s.name.escapedText.toString().replace(n,"")),o&&(t=addDoubleUnderline(t,c,o,e,a,i))}return t}function isMatchInitExpression(e){return _typescript.default.isPropertyAccessExpression(e)&&e.expression&&e.expression.kind===_typescript.default.SyntaxKind.ThisKeyword&&_typescript.default.isIdentifier(e.name)}function addDoubleUnderline(e,t,r,a=!1,i,p){return _typescript.default.factory.updatePropertyAssignment(e,t,_typescript.default.factory.createPropertyAccessExpression(a&&_main.partialUpdateConfig.partialUpdateMode?_typescript.default.factory.createIdentifier(_pre_define.$$):_typescript.default.factory.createThis(),i||p?_typescript.default.factory.createIdentifier(r):_typescript.default.factory.createIdentifier("__"+r)))}function getParentNode(e,t){e=e.parent.parent.expression;let r=new Set,a;return _typescript.default.isIdentifier(e)?(a=e.escapedText.toString(),r=t.get(a)):_typescript.default.isPropertyAccessExpression(e)&&(a=_utils.storedFileInfo.isAsPageImport?e.getText():e.name.escapedText.toString(),r=t.get(a)),r=r||new Set,[a,...r]}function addUpdateParamsFunc(e,t){return createParamsInitBlock(_pre_define.COMPONENT_CONSTRUCTOR_UPDATE_PARAMS,e,t)}function addInitialParamsFunc(e,t){return createParamsInitBlock(_pre_define.COMPONENT_CONSTRUCTOR_INITIAL_PARAMS,e,t)}function addUpdateStateVarsFunc(e,t){return createParamsInitBlock(_pre_define.COMPONENT_UPDATE_STATE_VARS,e,t)}function addPurgeVariableDepFunc(e){return _typescript.default.factory.createMethodDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_PURGE_VARIABLE_DEP),void 0,void 0,[_typescript.default.factory.createParameterDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.RMELMTID),void 0,void 0,void 0)],void 0,_typescript.default.factory.createBlock(e,!0))}function addDeleteParamsFunc(e,t=!1){var a=this;const i=[],p=[];return e.forEach(function(e){_newArrowCheck(this,a);var t=e.name;let r;e=isRegularProperty(_typescript.default.getAllDecorators(e));_main.partialUpdateConfig.partialUpdateMode&&e||(r=createParamsWithUnderlineStatement(t)),_main.partialUpdateConfig.partialUpdateMode&&!e&&p.push(createElmtIdWithUnderlineStatement(t)),i.push(r)}.bind(this)),_main.partialUpdateConfig.partialUpdateMode&&t?createRecycleElmt(p):(e=_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.CREATE_CONSTRUCTOR_SUBSCRIBER_MANAGER),_typescript.default.factory.createIdentifier(_pre_define.CREATE_CONSTRUCTOR_GET_FUNCTION)),void 0,[]),_typescript.default.factory.createIdentifier(_pre_define.CREATE_CONSTRUCTOR_DELETE_FUNCTION)),void 0,[_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(_main.partialUpdateConfig.partialUpdateMode?_pre_define.ABOUT_TO_BE_DELETE_FUNCTION_ID__:_pre_define.ABOUT_TO_BE_DELETE_FUNCTION_ID)),void 0,[])])),i.push(e),_main.partialUpdateConfig.partialUpdateMode&&(t=createDeletedInternalStatement(),i.push(t)),createParamsInitBlock(_pre_define.COMPONENT_CONSTRUCTOR_DELETE_PARAMS,i))}function createRecycleElmt(e){return _typescript.default.factory.createMethodDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.UPDATE_RECYCLE_ELMT_ID),void 0,void 0,[_typescript.default.factory.createParameterDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.OLD_ELMT_ID)),_typescript.default.factory.createParameterDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.NEW_ELMT_ID))],void 0,_typescript.default.factory.createBlock(e,!0))}function createParamsWithUnderlineStatement(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier("__"+e.escapedText.toString())),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_DELETE_PARAMS)),void 0,[]))}function createElmtIdWithUnderlineStatement(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier("__"+e.escapedText.toString())),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_UPDATE_ELMT_ID)),void 0,[_typescript.default.factory.createIdentifier(_pre_define.OLD_ELMT_ID),_typescript.default.factory.createIdentifier(_pre_define.NEW_ELMT_ID)]))}function createDeletedInternalStatement(){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(_pre_define.ABOUTTOBEDELETEDINTERNAL)),void 0,[]))}function addRerenderFunc(e){var t=_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(_pre_define.UPDATEDIRTYELEMENTS)),void 0,[]));return e.push(t),_utils.storedFileInfo.hasLocalBuilderInFile&&(e.unshift(contextStackPushOrPop(_typescript.default.factory.createIdentifier(_pre_define.PUSH),[_typescript.default.factory.createThis()])),e.push(contextStackPushOrPop(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_POP_FUNCTION),[]))),_typescript.default.factory.createMethodDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_RERENDER_FUNCTION),void 0,void 0,[],void 0,_typescript.default.factory.createBlock(e,!0))}function createParamsInitBlock(e,t,r){return _typescript.default.factory.createMethodDeclaration(void 0,void 0,_typescript.default.factory.createIdentifier(e),void 0,void 0,[_typescript.default.factory.createParameterDeclaration(void 0,void 0,e===_pre_define.COMPONENT_CONSTRUCTOR_DELETE_PARAMS?void 0:_typescript.default.factory.createIdentifier(_pre_define.CREATE_CONSTRUCTOR_PARAMS),void 0,e===_pre_define.COMPONENT_CONSTRUCTOR_DELETE_PARAMS?void 0:_typescript.default.factory.createTypeReferenceNode(_typescript.default.factory.createIdentifier(r.getText()+_pre_define.INTERFACE_NAME_SUFFIX),void 0),void 0)],void 0,_typescript.default.factory.createBlock(t,!0))}function validateBuildMethodCount(e,t,r){1!==e.count&&r.push({type:_utils.LogType.ERROR,message:`struct '${t.getText()}' must be at least or at most one 'build' method.`+"Solutions:>A structurally modified page must have at least one and no more than one'build' method.",pos:t.getStart()})}function validateHasController(e,t,r){t.hasController||r.push({type:_utils.LogType.ERROR,message:"@CustomDialog component should have a property of the CustomDialogController type.",pos:e.pos})}function createHeritageClause(e=!1){return _main.partialUpdateConfig.partialUpdateMode?_typescript.default.factory.createHeritageClause(_typescript.default.SyntaxKind.ExtendsKeyword,[_typescript.default.factory.createExpressionWithTypeArguments(_typescript.default.factory.createIdentifier(e?_constant_define.default.STRUCT_PARENT:_pre_define.BASE_COMPONENT_NAME_PU),[])]):_typescript.default.factory.createHeritageClause(_typescript.default.SyntaxKind.ExtendsKeyword,[_typescript.default.factory.createExpressionWithTypeArguments(_typescript.default.factory.createIdentifier(_pre_define.BASE_COMPONENT_NAME),[])])}function createTypeReference(e,t,r,a){let i;switch(e){case _pre_define.COMPONENT_STATE_DECORATOR:case _pre_define.COMPONENT_PROVIDE_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode((0,_process_component_member.isSimpleType)(t,a,r)?_pre_define.OBSERVED_PROPERTY_SIMPLE:_pre_define.OBSERVED_PROPERTY_OBJECT,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_LINK_DECORATOR:case _pre_define.COMPONENT_CONSUME_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode((0,_process_component_member.isSimpleType)(t,a,r)?_pre_define.SYNCHED_PROPERTY_SIMPLE_TWO_WAY:_pre_define.SYNCHED_PROPERTY_SIMPLE_ONE_WAY,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_PROP_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode(_pre_define.SYNCHED_PROPERTY_SIMPLE_ONE_WAY,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_OBJECT_LINK_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode(_pre_define.SYNCHED_PROPERTY_NESED_OBJECT,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_STORAGE_PROP_DECORATOR:case _pre_define.COMPONENT_STORAGE_LINK_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode(_pre_define.OBSERVED_PROPERTY_ABSTRACT,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_LOCAL_STORAGE_LINK_DECORATOR:case _pre_define.COMPONENT_LOCAL_STORAGE_PROP_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode(_pre_define.OBSERVED_PROPERTY_ABSTRACT,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)])}return i}function createTypeReferencePU(e,t,r,a){let i;switch(e){case _pre_define.COMPONENT_STATE_DECORATOR:case _pre_define.COMPONENT_PROVIDE_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode((0,_process_component_member.isSimpleType)(t,a,r)?_pre_define.OBSERVED_PROPERTY_SIMPLE_PU:_pre_define.OBSERVED_PROPERTY_OBJECT_PU,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_LINK_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode((0,_process_component_member.isSimpleType)(t,a,r)?_pre_define.SYNCHED_PROPERTY_SIMPLE_TWO_WAY_PU:_pre_define.SYNCHED_PROPERTY_SIMPLE_ONE_WAY_PU,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_PROP_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode(_pre_define.SYNCHED_PROPERTY_SIMPLE_ONE_WAY_PU,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_OBJECT_LINK_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode(_pre_define.SYNCHED_PROPERTY_NESED_OBJECT_PU,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_CONSUME_DECORATOR:case _pre_define.COMPONENT_STORAGE_PROP_DECORATOR:case _pre_define.COMPONENT_STORAGE_LINK_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode(_pre_define.OBSERVED_PROPERTY_ABSTRACT_PU,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)]);break;case _pre_define.COMPONENT_LOCAL_STORAGE_LINK_DECORATOR:case _pre_define.COMPONENT_LOCAL_STORAGE_PROP_DECORATOR:i=_typescript.default.factory.createTypeReferenceNode(_pre_define.OBSERVED_PROPERTY_ABSTRACT_PU,[t||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword)])}return i}function checkFinalizeConstruction(){return _typescript.default.factory.createIfStatement(_typescript.default.factory.createPrefixUnaryExpression(_typescript.default.SyntaxKind.ExclamationToken,_typescript.default.factory.createParenthesizedExpression(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createStringLiteral(_pre_define.FINALIZE_CONSTRUCTION),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.InKeyword),_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.BASE_COMPONENT_NAME_PU),_typescript.default.factory.createIdentifier(_pre_define.PROTOTYPE))))),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.REFLECT),_typescript.default.factory.createIdentifier(_pre_define.CREATE_SET_METHOD)),void 0,[_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.BASE_COMPONENT_NAME_PU),_typescript.default.factory.createIdentifier(_pre_define.PROTOTYPE)),_typescript.default.factory.createStringLiteral(_pre_define.FINALIZE_CONSTRUCTION),_typescript.default.factory.createArrowFunction(void 0,void 0,[],void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock([],!1))]))],!0),void 0)}function checkContextStack(){return _typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.PUV2_VIEW_BASE),_typescript.default.factory.createIdentifier(_pre_define.CONTEXT_STACK)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsEqualsEqualsToken),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_IF_UNDEFINED)),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.REFLECT),_typescript.default.factory.createIdentifier(_pre_define.CREATE_SET_METHOD)),void 0,[_typescript.default.factory.createIdentifier(_pre_define.PUV2_VIEW_BASE),_typescript.default.factory.createStringLiteral(_pre_define.CONTEXT_STACK),_typescript.default.factory.createArrayLiteralExpression([],!1)]))],!0),void 0)}function contextStackPushOrPop(e,t){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.PUV2_VIEW_BASE),_typescript.default.factory.createIdentifier(_pre_define.CONTEXT_STACK)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.AmpersandAmpersandToken),_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.PUV2_VIEW_BASE),_typescript.default.factory.createIdentifier(_pre_define.CONTEXT_STACK)),e),void 0,t)))}