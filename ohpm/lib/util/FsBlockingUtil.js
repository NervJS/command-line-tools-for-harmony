"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.FsBlockingUtil=void 0;const r=e(require("graceful-fs")),t=e(require("fs-extra")),n=require("../tools/ohfs"),i=e(require("../log")),c=require("../tools/json5"),a=require("../tools/symlink/SymlinkDir"),l=require("./OsUtil"),o=require("./handleReadJsonError");exports.FsBlockingUtil={createFileSync:t.default.createFileSync,writeFileSync:function(e,t,n){if(!e||!t)return;let i=t;"string"==typeof i&&(i=i.replace(/[\r\n]+/gm,l.OsUtil.isWindows?"\r\n":"\n")),r.default.writeFileSync(e,i,n)},rmDirSync:e=>n.removeSync.sync(e),isSymbolicLink:e=>a.Symlink.isSymbolicLink(e),rmEmptyDirSync:function(e){if(!r.default.existsSync(e))return;0===r.default.readdirSync(e).length&&(r.default.rmdirSync(e),i.default.debug("",`Deleted empty directory ${e}`))},rmSync:r.default.rmSync,readdirSync:r.default.readdirSync,existsSync:r.default.existsSync,statSync:r.default.statSync,readFileSync:r.default.readFileSync,copyFileSync:r.default.copyFileSync,copySync:t.default.copySync,readlinkSync:r.default.readlinkSync,unlinkSync:r.default.unlinkSync,renameSync:r.default.renameSync,readModifyTime:function(e){const r=t.default.statSync(e);return r?r.mtimeMs.toString():""},readdirSilently:function(e){let t=[];try{t=r.default.readdirSync(e)}catch(e){if("ENOENT"===e.code)return[];throw e}return t},renameSyncIfNotExist:function(e,t){if(!r.default.existsSync(t))try{r.default.renameSync(e,t)}catch(n){if(r.default.existsSync(t))return i.default.warn("rename failed",`the targetPath: ${t} already exists`),void exports.FsBlockingUtil.rmDirNoThrowError(e);throw i.default.error("rename failed",`unknown error occurred when rename ${e} -> ${t}, error: ${n}`),n}},readJSONSync:function(e,r){try{return t.default.readJSONSync(e,r)}catch(r){const t=`${r.message} - check ${e} format.`;throw i.default.error("",t),new Error(t)}},readJSON5Sync:function(e,t=""){try{const t=r.default.readFileSync(e,"utf8");return c.JSON5.parse(t)}catch(r){(0,o.handleReadJsonError)(r,e)}},createDirIfNotExists:function(e){if(!r.default.existsSync(e))try{t.default.mkdirpSync(e)}catch(c){if(r.default.existsSync(e))return;i.default.warn("",`createDir exception: ${c}, start remove dirPath: ${e}`),n.removeSync.sync(e),t.default.mkdirpSync(e)}},rmDirNoThrowError:function(e){try{exports.FsBlockingUtil.rmDirSync(e)}catch(r){i.default.warn("",`remove directory ${e} failed. detail: ${r}`)}}};