"use strict";var e=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.fileContentHash=exports.getPkgStoreDirName=void 0;const n=t(require("../../../log")),o=t(require("crypto")),r=require("../../../common/Constants"),s=require("./isLocalDependency"),i=require("../../../common/message"),a=t(require("fs"));exports.getPkgStoreDirName=function(t,n,o){return e(this,void 0,void 0,(function*(){const e=r.Constants.compressConfig;let i;i=(0,s.isLocalDependency)(n)?`${t}@${o}`:`${t}@${n}`;const a=e.REPLACE_TARGET;return i.replace(/[/\\]/g,a).replace(/:/g,a)}))},exports.fileContentHash=function(t,r){return e(this,void 0,void 0,(function*(){const e=yield function(e,t){if(!e||!t.ALGORITHM)throw new Error(i.Messages.Path.NotFoundPathOrAlg);return new Promise((r=>{const s=o.default.createHash(t.ALGORITHM),c=a.default.createReadStream(e);c.on("data",(e=>{s.update(e)})).once("end",(()=>{s.destroy(),(!t.ENCODING||"base64"!==t.ENCODING&&"base64url"!==t.ENCODING&&"binary"!==t.ENCODING)&&(n.default.debug("encodePathWithConfig","encoding empty or invalid in Constants.compressConfig"),r(s.digest("hex"))),r(s.digest(t.ENCODING))})).on("error",(e=>{throw c.close(),new Error((0,i.format)(i.Messages.Path.PathHashFailed,{msg:(null==e?void 0:e.message)||e}))}))}))}(t,r);return n.default.debug("encodePath",`encode path: ${t} content to ${e}`),r.TO_UPPER_CASE?e.toUpperCase():e.toLowerCase()}))};