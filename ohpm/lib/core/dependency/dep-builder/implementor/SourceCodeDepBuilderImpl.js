"use strict";var e=this&&this.__awaiter||function(e,i,n,t){return new(n||(n=Promise))((function(r,o){function s(e){try{p(t.next(e))}catch(e){o(e)}}function a(e){try{p(t.throw(e))}catch(e){o(e)}}function p(e){var i;e.done?r(e.value):(i=e.value,i instanceof n?i:new n((function(e){e(i)}))).then(s,a)}p((t=t.apply(e,i||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SourceCodeDepBuilderImpl=void 0;const n=require("../../util"),t=i(require("path")),r=require("../../../../common/Constants"),o=require("../../../../common/message"),s=require("../../../../util/OsUtil"),a=require("../../../../config"),p=require("../../util/getFilePathHash");exports.SourceCodeDepBuilderImpl=class{build(i){return e(this,void 0,void 0,(function*(){if(s.OsUtil.isWindows&&t.default.parse(i.pinnedSpec).root!==t.default.parse(a.config.getProjectRoot()).root)throw new Error((0,o.format)(o.Messages.DepBuilder.CrossDriverError,{pkg:`${i.name}@${i.fetchSpec}`}));if(i.isNativeSoType&&"InterfaceHar"===i.packageType)throw new Error((0,o.format)(o.Messages.DepBuilder.InvalidInterfaceHar,{pkg:`${i.name}@${i.version}`}));let e,c;if(i.isLink)e=i.pinnedSpec,c=e;else{const o=yield(0,p.getFilePathHash)(i.pinnedSpec);e=yield(0,n.getPkgStoreDirName)(i.name,i.pinnedSpec,o),c=t.default.join(r.Constants.MyModules,i.name)}return{name:i.name,version:i.version,actualName:i.actualName,fetchSpec:i.fetchSpec,isNativeSoType:i.isNativeSoType,registryType:i.registryType,resolved:i.resolved,saveSpec:i.saveSpec,pinnedSpec:i.pinnedSpec,packageType:i.packageType,ohpaType:i.ohpaType,isShared:i.isShared,isLink:i.isLink,saveRootDir:e,pkgStoreDir:c,isRoot:i.isRoot,devDependencies:i.devDependencies,dependencies:i.dependencies,dynamicDependencies:i.dynamicDependencies}}))}};