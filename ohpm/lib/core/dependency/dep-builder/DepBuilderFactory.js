"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DepBuilderFactory=void 0;const r=require("./types"),t=require("../../../tools/ohpa/OhpaType"),n=require("./implementor/ArtifactDepBuilderImpl"),p=require("./implementor/SourceCodeDepBuilderImpl"),a=require("../util"),i=require("../dep-fetcher"),l=require("./AsyncDepNodeDataBuilder"),o=e(require("../../../log")),s=require("../../../common/message");class u{constructor(){this.implementorStrategies=new Map([[t.OhpaType.SourceCode,new p.SourceCodeDepBuilderImpl],[t.OhpaType.File,new n.ArtifactDepBuilderImpl],[t.OhpaType.Tag,new n.ArtifactDepBuilderImpl],[t.OhpaType.Range,new n.ArtifactDepBuilderImpl],[t.OhpaType.Version,new n.ArtifactDepBuilderImpl]])}static getInstance(){return this.Instance||(this.Instance=new u),this.Instance}getBuilderImpl(e){const r=this.implementorStrategies.get(e);if(!r)throw o.default.debug("ETYPE",`Unknown ohpa type: "${e}" when getBuilderImpl`),new Error((0,s.format)(s.Messages.DepBuilder.UnknownOhpaType,{ohpaType:e}));return r}getBuilder(e,t,n){switch(t){case r.BuilderType.Installed:return this.createInstalledDepBuilder();case r.BuilderType.ToBeInstalled:return this.createToBeInstalledDepBuilder(e,n);default:throw new Error((0,s.format)(s.Messages.DepBuilder.UnknownBuilderType,{builderType:t}))}}createInstalledDepBuilder(){const e=new i.OhModulesMetadataFetcher;return new l.AsyncDepNodeDataBuilder(e)}createToBeInstalledDepBuilder(e,r){const t=(0,a.parseDependency)(e,r),n=new i.InstallationMetadataFetcher;if(!n)throw o.default.error("ETYPE",`Unknown ohpa type: ${t.type}, dependency: ${e}`),new Error((0,s.format)(s.Messages.DepBuilder.UnknownOhpaType,{ohpaType:t.type}));return new l.AsyncDepNodeDataBuilder(n)}}exports.DepBuilderFactory=u;