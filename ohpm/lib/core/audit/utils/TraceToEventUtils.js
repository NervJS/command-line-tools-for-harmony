"use strict";var e=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.convertTraceToEvent=void 0;const t=require("../model/EventBean"),n=require("../../../common/message"),s=require("../types"),i=require("./getNextDevEcoVersion");exports.convertTraceToEvent=function(r,o=!1){return e(this,void 0,void 0,(function*(){if(!r)throw new Error(n.Messages.TraceWriter.TraceEmptyError);let a;return a=o?yield function(n){return e(this,void 0,void 0,(function*(){const e=new t.EventBean;e.type=s.Audit.EVENT_TYPE,e.event=n.data?n.data[s.Audit.FIELD_EVENT_CMD_NAME]:"",e.eventtime=String(n.timestamp);const r=new Map;return r.set("data",JSON.stringify(n.data,null,2)),r.set("uid",n.uid),r.set("trace_uuid",n.traceUuid),r.set("trace_sid",n.traceSid),r.set("version",yield(0,i.getNextDevEcoVersion)()),r.set("build_time",""),r.set("os_arch",s.Audit.NEXT_OS_ARCH),r.set("timestamp",n.timestamp.toString()),r.set("trace_os_name",s.Audit.NEXT_TRACE_OS_NAME),r.set("trace_os_version",n.traceOsVersion),r.set("eventVersion",s.Audit.UNKNOWN),r.set("eventID",s.Audit.UNKNOWN),r.set("sessionid",s.Audit.UNKNOWN),e.properties=r,e}))}(r):function(e){const n=new t.EventBean;n.type=s.Audit.EVENT_TYPE,n.event=e.data?e.data[s.Audit.FIELD_EVENT_CMD_NAME]:"",n.eventtime=String(e.timestamp);const i=function(e){const t=new Map,n=Object.keys(e);for(const s of n)t.set(s,e[s]);return t}(e.data);return i.set("uid",e.uid),i.set("trace_uuid",e.traceUuid),i.set("trace_sid",e.traceSid),i.set("version",e.version),i.set("build_time",""),i.set("os_arch",e.osArch),i.set("timestamp",e.timestamp.toString()),i.set("trace_os_name",e.traceOsName),i.set("trace_os_version",e.traceOsVersion),i.set("eventVersion",e.eventVersion),i.set("eventID",e.eventID),i.set("sessionid",e.sessionid),n.properties=i,n}(r),a}))};