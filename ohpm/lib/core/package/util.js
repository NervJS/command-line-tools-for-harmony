"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.output=exports.validateGroup=exports.validateNameAndGroup=exports.validateAuthorStringFun=exports.validateAuthorFun=exports.validateLicenseFun=exports.validateVersionFun=exports.validateNameFun=exports.groupReg=void 0;const t=e(require("../../log")),a=require("../../util"),n=require("../publish/fixer"),r=require("../validator/customValidateFunc/validatePackageName"),i=require("semver");function o(e){return e.name&&e.name.length>128?(s(`author name cannot contain more than 128 characters: ${e.name}`),!1):e.email&&e.email.length>64?(s(`author email cannot contain more than 64 characters: ${e.email}`),!1):e.name&&!n.REGEX_AUTHOR_NAME.test(e.name)?(s(`Invalid author name: ${e.name}`),!1):!(e.email&&!n.REGEX_EMAIL.test(e.email))||(s(`Invalid author email: ${e.email}`),!1)}function l(e){return!!/^(@(?![0-9\\_-])[a-z0-9\\_-]+(?<![\\_-])\/)?(?![0-9\\_.-])[a-z0-9\\_.-]+(?<![\\_.-])$/.test(e)||(s("name contains invalid characters"),!1)}function s(e){a.PrintUtil.print(e)}exports.groupReg=/^(?![0-9\-_])[a-z0-9\-_]{1,36}$/,exports.validateNameFun=function(e,a){try{if((0,r.validatePackageName)(e,!0),"group"===a&&e.includes("."))return s("name contains invalid characters"),!1;const t=e.startsWith("@")?e.split("/")[0]:"";if(t.length>37)return s(`group name cannot contain more than 36 characters: ${t}`),!1;return!!l(e)&&e}catch(n){"init"===a?s(`Sorry, ${n.message||n}.`):t.default.error("",`Invalid package name: ${e} - ${n.message||n}.`)}return!1},exports.validateVersionFun=function(e){return i.valid(e)?e.length<=64?e:(s(`version is empty or cannot contain more than 64 characters: ${e}`),!1):(s(`Invalid version: "${e}"`),!1)},exports.validateLicenseFun=function(e){return e.length<256?{type:!0,license:e}:(s("license cannot contain more than 256 characters."),{type:!1,license:e})},exports.validateAuthorFun=function(e){const t=e?e.split(","):[],a={name:"",email:""};return t.length&&t.forEach((e=>{if(e.toLowerCase().includes("name:")){const t=e.replace(/name:/i,"name:").indexOf("name:");a.name=e.slice(t+5).trim()}if(e.toLowerCase().includes("email:")){const t=e.replace(/email:/i,"email:").indexOf("email:");a.email=e.slice(t+6).trim()}})),!!o(a)&&a},exports.validateAuthorStringFun=function(e){const t=e?function(e){var t,a;const n=null===(t=e.match(/</g))||void 0===t?void 0:t.length,r=null===(a=e.match(/>/g))||void 0===a?void 0:a.length,i={name:"",email:""};if(e.includes("<")&&">"===e.slice(-1)){const t=e.split("<");return i.name=t[0],i.email=1===n&&1===r?t[1].slice(0,t[1].length-1):e.slice(i.name.length),i}return i.name=e,i}(e):{name:"",email:""};if(!o(t))return!1;const a=t.email?`<${t.email.trim()}>`:"";return t.name?`${t.name.trim()}${a}`:`${a}`},exports.validateNameAndGroup=l,exports.validateGroup=function(e){return!!exports.groupReg.test(e)||(s("group invalid"),!1)},exports.output=s;