"use strict";var e=this&&this.__awaiter||function(e,i,t,r){return new(t||(t=Promise))((function(n,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function u(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var i;e.done?n(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(s,u)}l((r=r.apply(e,i||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.unpublish=void 0;const i=require("../../util"),t=require("../registry/registry"),r=require("../../common/message"),n=require("../registry/publication/impl/OhpmPublication"),o=require("../registry/publication/utils/getAuthorization");exports.unpublish=function(s,u){return e(this,void 0,void 0,(function*(){const e=(new Date).getTime();let l="";const c="@"===s[0]?s.slice(1).indexOf("@")+1:s.indexOf("@");let a=c>0?s.slice(0,c):s;if(c>0&&(l=s.slice(c+1)),!l&&!u.force)throw new Error(r.Messages.UnPublish.DeleteAllVersionPkgNotForce);let h=(0,t.getPublishRegistry)();if(void 0!==u.publish_registry&&(h=u.publish_registry),null==h||!h.length)throw new Error(r.Messages.Validator.PublishRegistryError);h.endsWith("/")||(h=h.concat("/")),a=a.replace("/","%2f");const p=yield(0,o.getAuthorization)(h);yield new n.OhpmPublication(p).unpublishPackage(a,l,h),i.PrintUtil.printCostTime(e,"unpublish")}))};