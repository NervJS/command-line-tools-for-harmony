"use strict";var t=this&&this.__awaiter||function(t,r,e,a){return new(e||(e=Promise))((function(o,i){function n(t){try{u(a.next(t))}catch(t){i(t)}}function s(t){try{u(a.throw(t))}catch(t){i(t)}}function u(t){var r;t.done?o(t.value):(r=t.value,r instanceof e?r:new e((function(t){t(r)}))).then(n,s)}u((a=a.apply(t,r||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.fixAuthorField=exports.REGEX_URL=exports.REGEX_EMAIL=exports.REGEX_AUTHOR_NAME=void 0;const r=require("../../common/message"),e=require("../../common/Constants");function a(t,r){return t.includes("author.name")||t.includes("author.email")||t.includes("author.url")?t.replace("author.","").replace(e.Constants.MyPackageJson,r):t}function o(t){if("string"!=typeof t)return n(t.name,128,r.Messages.Validator.ValidAuthorNameLengthFailed),n(t.email,64,r.Messages.Validator.ValidAuthorEmailLengthFailed),n(t.url,256,r.Messages.Validator.ValidAuthorUrlLengthFailed),i(t.name,t.email,t.url),t;const e=t.match(/^([^(<]+)/),a=t.match(/\(([^)]+)\)/),o=t.match(/<([^>]+)>/),s={name:"",url:"",email:""};return e&&(n(e[0],128,r.Messages.Validator.ValidAuthorNameLengthFailed),s.name=e[0]?e[0].trim():""),o&&(n(o[1],64,r.Messages.Validator.ValidAuthorEmailLengthFailed),s.email=o[1]?o[1].trim():""),a&&(n(a[1],256,r.Messages.Validator.ValidAuthorUrlLengthFailed),s.url=a[1]?a[1].trim():""),i(e?e[0]:"",o?o[1]:"",a?a[1]:""),s}function i(t,e,a){if(t&&!exports.REGEX_AUTHOR_NAME.test(t))throw new Error((0,r.format)(r.Messages.Validator.InValidAuthorContentError,{author:"author.name"}));if(e&&!exports.REGEX_EMAIL.test(e))throw new Error((0,r.format)(r.Messages.Validator.InValidAuthorContentError,{author:"author.email"}));if(a&&!exports.REGEX_URL.test(a))throw new Error((0,r.format)(r.Messages.Validator.InValidAuthorContentError,{author:"author.url"}))}function n(t,r,e){if(t&&t.length>r)throw new Error(e);return t}exports.REGEX_AUTHOR_NAME=/^.{0,128}$/,exports.REGEX_EMAIL=/(?=^[a-zA-Z0-9_\-.]+@[a-zA-Z0-9_\-.]+$).{0,64}$/,exports.REGEX_URL=/(?=^((https|http|ftp|rtsp|mms):\/\/)?([a-zA-Z0-9\u4e00-\u9fa5\\-]+\.)+([a-zA-Z0-9\u4e00-\u9fa5\\-]+)(:[0-9]{1,5})?([\\/?].*)?$).{0,1024}$/,exports.fixAuthorField=function(e){return t(this,void 0,void 0,(function*(){return function(t,e){t.author?t.author=e(t.author):t.author="";return["maintainers","contributors"].forEach((function(o){if(Array.isArray(t[o]))try{t[o]=t[o].map(e)}catch(t){!function(t,e){if(!e||!e.message)throw e;let o="";switch(t){case"maintainers":throw o=a(e.message,"maintainers.item"),new Error((0,r.format)(r.Messages.Validator.ContributorItemError,{itemName:"maintainer",fieldName:"maintainers",errMsg:o}));case"contributors":throw o=a(e.message,"contributors.item"),new Error((0,r.format)(r.Messages.Validator.ContributorItemError,{itemName:"contributor",fieldName:"contributors",errMsg:o}));default:throw e}}(o,t)}})),t}(e,o)}))};