"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.resolveInnerPkgVersionConflict=void 0;const e=require("../locker"),n=require("../../common/message");exports.resolveInnerPkgVersionConflict=function(){const a=e.PackageLockerManager.getInstance(),s=a.getInnerDepCache();for(let e=s.cacheQueue.length-1;e>=0;e--){const i=s.cacheQueue[e],o=a.getMaxSatisfyingVersionData(i.name);if(!o)throw Error((0,n.format)(n.Messages.VersionConflick.NotFoundMaxSatisfyingVersion,{name:i.name}));const t=`${o.name}@${o.pinnedSpec}`;i.chains.some((e=>{var n,a;return(null===(a=null===(n=e.tail)||void 0===n?void 0:n.value)||void 0===a?void 0:a.nodeKey)===t}))?a.delMaxSatisfyingVersionData(i.name):s.cacheQueue.splice(e,1)}for(;s.size()>0;){const e=s.pop();for(let n=e.chains.length-1;n>=0;n--){const i=e.chains[n];if(1===i.length){const s=i.shift();a.updateMaxSatisfyingVersion(s.value.nodeData),e.chains.splice(n,1);continue}const o=i.peek();if(!o){e.chains.splice(n,1);break}const t=!s.has(o.value.nodeKey),c=a.isMaxSatisfyingVersionData(o.value.nodeData);t&&!c?e.chains.splice(n,1):t&&c&&i.shift()}e.chains.length>0&&s.push(e)}};