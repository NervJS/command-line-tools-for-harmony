"use strict";var e=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function l(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.uninstallSymlink=void 0;const t=require("../common/definitions"),n=require("../../../util"),o=require("../../../common/message"),i=require("./installModules"),r=require("../common/updatePkgJson"),s=require("../../locker"),l=require("../../dependency/util/deleteEmptyOhModulesDir"),a=require("./createRootNodesForInstallation"),u=require("./getModuleRootDirs");exports.uninstallSymlink=function(c,d,m){return e(this,void 0,void 0,(function*(){const e=(new Date).getTime(),y=Object.assign(Object.assign(Object.assign({},t.defaultInstallOptions),m),{saveDynamic:!0,saveDev:!0,saveProd:!0});if(!d)throw new Error(o.Messages.Common.PkgNotFound);const f=(0,u.getModuleRootDirs)(d,m),g=s.PackageLockerManager.getInstance();try{g.syncLoadLockers(f);const e=yield(0,a.createRootNodesForInstallation)(f,c,y),t=e.get(d);yield(0,i.installModules)(e),yield(0,r.updatePkgJson)(d,t,y),yield g.flushAllLockers()}finally{f.forEach((e=>(0,l.deleteEmptyOhModulesDir)(e)))}n.PrintUtil.printCostTime(e,"uninstall")}))};