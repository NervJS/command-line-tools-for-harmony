"use strict";var t=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),e=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var n={};if(null!=r)for(var i in r)"default"!==i&&Object.prototype.hasOwnProperty.call(r,i)&&t(n,r,i);return e(n,r),n},n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((n=n.apply(t,e||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ssri=void 0;const i=require("./SsriOption"),o=require("./IntegrityMap"),s=require("./Integrity"),a=r(require("crypto"));exports.ssri=new class{parse(t,e){return new s.Integrity(t,e)}fromData(t,e){const r=(e=i.Opts.mergeWithDefaultOpts(e)).algorithms,n=i.Opts.getOptString(e.options);return r.reduce(((r,i)=>{const o=this.createDigest(i,t),a=new s.Integrity(`${i}-${o}${n}`,e);if(a.getAlgorithm()&&a.getDigest()){const t=a.getAlgorithm();r.put(t,a)}return r}),new o.IntegrityMap)}createDigest(t,e){return a.default.createHash(t).update(e).digest("base64")}fromStream(t,e){return n(this,void 0,void 0,(function*(){const r=(e=i.Opts.mergeWithDefaultOpts(e)).algorithms,n=i.Opts.getOptString(e.options),u={};return r.forEach((t=>{u[t]=(0,a.createHash)(t)})),new Promise(((i,a)=>{t.on("data",(t=>{Object.values(u).forEach((e=>{e.update(t)}))})),t.on("end",(()=>{const t=new o.IntegrityMap;r.forEach((r=>{const i=u[r].digest("base64"),o=new s.Integrity(`${r}-${i}${n}`,e);if(o.getAlgorithm()&&o.getDigest()){const e=o.getAlgorithm();t.put(e,o)}})),i(t)})),t.on("error",(t=>{a(t)}))}))}))}};