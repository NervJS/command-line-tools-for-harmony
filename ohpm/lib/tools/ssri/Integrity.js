"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Integrity=void 0;const s=require("./SsriOption"),i=t(require("../../log"));exports.Integrity=class{constructor(t,e){this.SPEC_ALGORITHMS=["sha256","sha384","sha512"],this.SRI_REGEX=/^([a-z0-9]+)-([^?]+)([?\S*]*)$/,this.STRICT_SRI_REGEX=/^([a-z0-9]+)-([A-Za-z0-9+/=]{44,88})(\?[\x21-\x7E]*)?$/,this.BASE64_REGEX=/^[a-z0-9+/]+=?=?$/i,this.VCHAR_REGEX=/^[\x21-\x7E]+$/,this.algorithm="",this.digest="",this.options=[];const r=(e=s.Opts.mergeWithDefaultOpts(e)).strict;this.source=t.trim();const h=this.source.match(r?this.STRICT_SRI_REGEX:this.SRI_REGEX);h?r&&!this.SPEC_ALGORITHMS.some((t=>t===h[1]))||this.setIntegrityData(h):i.default.error("","")}getAlgorithm(){return this.algorithm}getDigest(){return this.digest}getOptions(){return this.options?this.options:[]}hexDigest(){return this.getDigest()&&Buffer.from(this.getDigest(),"base64").toString("hex")}toString(t){if((t=s.Opts.mergeWithDefaultOpts(t)).strict&&!(this.SPEC_ALGORITHMS.some((t=>t===this.getAlgorithm()))&&this.getDigest().match(this.BASE64_REGEX)&&this.getOptions().every((t=>t.match(this.VCHAR_REGEX)))))return"";const i=this.getOptions().length?`?${this.getOptions().join("?")}`:"";return`${this.getAlgorithm()}-${this.getDigest()}${i}`}setIntegrityData(t){this.algorithm=t[1],this.digest=t[2];const s=t[3];s&&(this.options=s.slice(1).split("?"))}};