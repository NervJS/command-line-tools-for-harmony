"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateNumberCommon=exports.validate=void 0;const e=t(require("url")),r=t(require("path")),s=require("./DefaultConfig"),n=require("../common/Constants"),i=require("../util/filePath"),o=require("../concurrent/ConcurrentExecutor"),u=require("../core/override-dependency-map/types"),a=require("../core/override-dependency-map/OverrideProjectJsonManager"),f=/^\d+$/,l=new Map;l.set(s.types.REGISTRY,p),l.set(s.types.PUBLISH_ID,(function(t,e,r){return t.set(e,String(r)),""})),l.set(s.types.CACHE,c),l.set(s.types.KEY_PATH,(function(t,e,r){const s=(0,i.resolveTildePath)(r);return c(t,e,s)})),l.set(s.types.NO_PROXY,(function(t,e,r){if(""===r)return t.set(e,r),"";if(!r||!0===r)return" - invalid no_proxy address.";return t.set(e,r),""})),l.set(s.types.HTTP_PROXY,E),l.set(s.types.HTTPS_PROXY,E),l.set(s.types.STRICT_SSL,_),l.set(s.types.LOG_LEVEL,(function(t,e,r){if(!r)return" - must be one of: error, warn, info, debug.";if(-1===s.logLevelType.indexOf(r.toLowerCase()))return" - must be one of: error, warn, info, debug.";return t.set(s.types.LOG_LEVEL,String(r.toLowerCase())),""})),l.set(s.types.PUBLISH_REGISTRY,(function(t,r,s){if(!s||""===s||!0===s)return' - full url with "http:// or "https://".';if(!s.startsWith("https://")&&!s.startsWith("http://"))return' - full url with "http:// or "https://".';const n=e.default.parse(String(s));if(!n.host)return' - full url with "http:// or "https://".';return t.set(r,n.href),""})),l.set(s.types.CA_FILES,(function(t,e,s){if(""===s)return t.set(e,s),"";if(!s||!0===s)return" - invalid CaFiles path.";if(s.endsWith(","))return" - invalid CaFiles path.";const n=s.split(",");let i=!1;if(n.forEach((t=>{t&&(r.default.isAbsolute(t)||(i=!0))})),i)return" - invalid CaFiles path.";return t.set(e,r.default.resolve(s)),""})),l.set(s.types.FETCH_TIMEOUT,(function(t,e,r){const s=d(e,r,n.FETCH_TIMEOUT_MIN,n.FETCH_TIMEOUT_MAX);if("ok"!==s)return s;return t.set(e,r),""})),l.set(s.types.LOCAL_PREFIX,(function(t,e,s){if(""===s)return" - invalid filesystem path.";let i;i=r.default.isAbsolute(s)?s:r.default.resolve(process.cwd(),s);if(i.split(r.default.sep).includes(n.Constants.MyModules))return` - cannot specify as ${n.Constants.MyModules} path.`;return t.set(e,i),""})),l.set(s.types.MAX_CONCURRENT,(function(t,e,r){const s=d(e,r,o.MAX_CONCURRENT_MIN,o.MAX_CONCURRENT_MAX);if("ok"!==s)return s;return t.set(e,r),""})),l.set(s.types.RETRY_TIMES,(function(t,e,r){const s=d(e,r,o.RETRY_TIMES_MIN,o.RETRY_TIMES_MAX);if("ok"!==s)return s;return t.set(e,r),""})),l.set(s.types.RETRY_INTERVAL,(function(t,e,r){const s=d(e,r,o.RETRY_INTERVAL_MIN,o.RETRY_INTERVAL_MAX);if("ok"!==s)return s;return t.set(e,r),""})),l.set(s.types.RESOLVE_CONFLICT,_),l.set(s.types.RESOLVE_CONFLICT_STRICT,_),l.set(s.types.ENFORCE_DEPENDENCY_KEY,_),l.set(s.types.ENSURE_DEPENDENCY_INCLUDE,_),l.set(s.types.INSTALL_ALL,_),l.set(s.types.DISALLOW_NESTED_PACKAGE,_),l.set(s.types.ODM_R2_PROJECT_ROOT,_),l.set(s.types.ENABLE_CROSS_PROCESS_LOCK,_),l.set(s.types.COMPABILITY_LOG_LEVEL,(function(t,e,r){if(!r)return" - must be one of: error, warn, info, close.";if(-1===s.logLevelType.indexOf(r.toLowerCase()))return" - must be one of: error, warn, info, close.";return t.set(s.types.COMPABILITY_LOG_LEVEL,String(r.toLowerCase())),""})),l.set(s.types.USE_STREAM_THRESHOLD_SIZE,(function(t,e,r){const s=d(e,r,n.Constants.MinPackSizeMB,n.Constants.MaxPackSizeMB);if("ok"!==s)return s;return t.set(e,r),""})),l.set(s.types.LOCKFILE_STABLE_ORDER,_),l.set(s.types.AUTO_GENERATE_CUSTOM_DEPENDENCY_FILE,_),exports.validate=function(t,e,r){if(void 0===t)return"invalid data";if(!e)return"invalid key";if(l.has(e)){const s=l.get(e);if(void 0!==s)return s(t,e,r)}return e.startsWith("@")&&e.endsWith(":registry")?p(t,e,r):a.OverrideProjectJsonManager.getInstance().isProjectPackageJsonConfig(e)?function(t,e,r){const s=a.OverrideProjectJsonManager.getInstance();if(!e||!e.trim()||!s.isProjectPackageJsonConfig(e))return` - invalid project package json key, the key must start with "${u.PREFIX_OVERRIDE_PROJECT_JSON}".`;if(!r||"string"!=typeof r)return" - invalid project package json path.";try{return s.add(e,r),t.set(e,r),""}catch(t){return` - invalid key or value, detail: ${t}.`}}(t,e,r):e.endsWith(s.AccessTokenType.READ_WRITE)?T(t,e,r):e.endsWith(s.AccessTokenType.READ)?T(t,e,r,!0):`Invalid key: ${e} - enter "${n.Constants.PM} config list -j" to get the defaults.`};function p(t,r,s){if(!s||""===s||!0===s)return' - full url with "http:// or "https://".';const n=s.split(",");let i="";for(const t of n){if(!t.startsWith("https://")&&!t.startsWith("http://"))return' - full url with "http:// or "https://".';const r=e.default.parse(String(t));if(!r.host)return' - full url with "http:// or "https://".';i=i.concat(r.href,",")}return t.set(r,i.substring(0,i.length-1)),""}function c(t,e,s){return""===s?(t.set(e,s),""):s&&!0!==s&&r.default.isAbsolute(s)?(t.set(e,r.default.resolve(s)),""):" - invalid filesystem path."}function E(t,r,s){if(""===s)return t.set(r,s),"";if(!s||!0===s||!s.startsWith("http://")&&!s.startsWith("https://"))return' - full url with "http://" or "https://".';const n=e.default.parse(String(s));return n.host?(t.set(r,n.href),""):' - full url with "http://" or "https://".'}const h=/[\u4E00-\u9FA5\uFE30-\uFFA0]/;function _(t,e,r){if(null!=r){const t=r;if(t.length>0&&'""'!==t&&"''"!==t&&h.test(t))return` - invalid ${e} value.`}return r=r instanceof Boolean?r.valueOf():"string"==typeof r?isNaN(Number(r))?!["null","false",'""'].includes(r):!!+r:!!r,t.set(e,r),""}function d(t,e,r,s){return isNaN(e)||e<0||e<r||e>s?` - invalid ${t} value, reference value: [${r}, ${s}].`:f.test(e)?"ok":` - invalid ${t} value, the value must be a integer value of [${r}, ${s}].`}function T(t,r,n,i=!1){r=e.default.parse(r).href;const o=i?s.AccessTokenType.READ:s.AccessTokenType.READ_WRITE;let u=t.get(o);if(u||(u=[]),!u.includes(r)){if(u.length===s.defaultConfig.max_auth)return` - A maximum of ${s.defaultConfig.max_auth} authentication records can be configured`;u.push(r)}return t.set(r,n),t.set(o,u),""}exports.validateNumberCommon=d;