"use strict";var e=this&&this.__awaiter||function(e,n,r,t){return new(r||(r=Promise))((function(o,i){function a(e){try{s(t.next(e))}catch(e){i(e)}}function l(e){try{s(t.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,l)}s((t=t.apply(e,n||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.uninstallCmd=void 0;const n=require("../core/install"),r=require("../common/message"),t=require("../util"),o=require("../core/scripts/ScriptRunner"),i=require("../common/GlobalState"),a=require("../core/install/common/OptionValid"),l=require("../config"),s=require("../core/parameter"),c=require("../common/Constants"),u=require("../tools/filelock"),m=require("../core/install/common/definitions");exports.uninstallCmd=function(f,p){return e(this,void 0,void 0,(function*(){i.GlobalState.command=i.CommandType.UNINSTALL,p.experimentalConcurrentlySafe=p.experimentalConcurrentlySafe||m.defaultInstallOptions.experimentalConcurrentlySafe,p.experimentalConcurrentlySafe&&i.GlobalState.installMode.push(i.ExperimentalOption.CONCURRENTLY_SAFE_INSTALL);try{if(yield u.filelock.lock(),yield s.ParameterizationManager.getInstance().isParameterFileConfiged())throw new Error((0,r.format)(r.Messages.Parameterization.ForbiddenUnInstallError,{configName:"parameterFile",ohPkgName:c.Constants.MyPackageJson}));if((0,a.validUnInstallOptions)(i.GlobalState.command,p),!f||0===f.length)throw new Error(r.Messages.Uninstall.NoPkg);for(const e of f){const n=t.PackageUtil.parse(e);if(n.version)throw new Error((0,r.format)(r.Messages.Uninstall.HasVersion,{version:n.version}))}o.ScriptRunner.runHook(o.ScriptConstants.preUninstall),yield(0,n.uninstallSymlink)(f,l.config.getRootDir(),p),o.ScriptRunner.runHook(o.ScriptConstants.postUninstall)}finally{yield u.filelock.unlock()}}))};